import{r as za,B as Ha,V as aa,a as na,b as He,c as Ge,d as je,I as va,M as Ye,S as ra,e as Ga,i as fe,L as ja,A as Za,E as Ka,T as Ja,f as ia}from"../oasis-engine-a5303d8d.js";function ga(h,t){var e=Object.keys(h);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(h);t&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(h,n).enumerable})),e.push.apply(e,a)}return e}function D(h,t){if(!(h instanceof t))throw new TypeError("Cannot call a class as a function")}function ma(h,t){for(var e=0;e<t.length;e++){var a=t[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(h,Ra(a.key),a)}}function U(h,t,e){return t&&ma(h.prototype,t),e&&ma(h,e),Object.defineProperty(h,"prototype",{writable:!1}),h}function Qa(h,t,e){return(t=Ra(t))in h?Object.defineProperty(h,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):h[t]=e,h}function vt(h,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(t&&t.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),t&&sa(h,t)}function Ze(h){return Ze=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ze(h)}function sa(h,t){return sa=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,a){return e.__proto__=a,e},sa(h,t)}function Ut(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function $a(h,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ut(h)}function gt(h){var t=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var e,a=Ze(h);if(t){var n=Ze(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return $a(this,e)}}function Ra(h){var t=function(e,a){if(typeof e!="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,a||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(e)}(h,"string");return typeof t=="symbol"?t:String(t)}function ve(h,t,e,a){e&&Object.defineProperty(h,t,{enumerable:e.enumerable,configurable:e.configurable,writable:e.writable,value:e.initializer?e.initializer.call(a):void 0})}function ge(h,t,e,a,n){var r={};return Object.keys(a).forEach(function(o){r[o]=a[o]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=e.slice().reverse().reduce(function(o,s){return s(h,t,o)||o},r),n&&r.initializer!==void 0&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),r.initializer===void 0&&(Object.defineProperty(h,t,r),r=null),r}var tn=function(){function h(){D(this,h),this.array=new Array}return U(h,[{key:"add",value:function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e}},{key:"contains",value:function(t){return this.array[0|t]!=null}},{key:"remove",value:function(t){this.array[0|t]=void 0}},{key:"clear",value:function(){this.array.length=0}}]),h}(),nt=function(){function h(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;D(this,h),this.r=t,this.g=e,this.b=a,this.a=n}return U(h,[{key:"set",value:function(t,e,a,n){return this.r=t,this.g=e,this.b=a,this.a=n,this.clamp(),this}},{key:"setFromColor",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}},{key:"setFromString",value:function(t){return t=t.charAt(0)=="#"?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(t.length!=8?255:parseInt(t.substr(6,2),16))/255,this}},{key:"add",value:function(t,e,a,n){return this.r+=t,this.g+=e,this.b+=a,this.a+=n,this.clamp(),this}},{key:"clamp",value:function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}}],[{key:"rgba8888ToColor",value:function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255}},{key:"rgb888ToColor",value:function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255}}]),h}();nt.WHITE=new nt(1,1,1,1),nt.RED=new nt(1,0,0,1),nt.GREEN=new nt(0,1,0,1),nt.BLUE=new nt(0,0,1,1),nt.MAGENTA=new nt(1,0,1,1);var P=function(){function h(){D(this,h)}return U(h,null,[{key:"clamp",value:function(t,e,a){return t<e?e:t>a?a:t}},{key:"cosDeg",value:function(t){return Math.cos(t*h.degRad)}},{key:"sinDeg",value:function(t){return Math.sin(t*h.degRad)}},{key:"signum",value:function(t){return t>0?1:t<0?-1:0}},{key:"toInt",value:function(t){return t>0?Math.floor(t):Math.ceil(t)}},{key:"cbrt",value:function(t){var e=Math.pow(Math.abs(t),.3333333333333333);return t<0?-e:e}},{key:"randomTriangular",value:function(t,e){return h.randomTriangularWith(t,e,.5*(t+e))}},{key:"randomTriangularWith",value:function(t,e,a){var n=Math.random(),r=e-t;return n<=(a-t)/r?t+Math.sqrt(n*r*(a-t)):e-Math.sqrt((1-n)*r*(e-a))}}]),h}();P.PI=3.1415927,P.PI2=2*P.PI,P.radiansToDegrees=180/P.PI,P.radDeg=P.radiansToDegrees,P.degreesToRadians=P.PI/180,P.degRad=P.degreesToRadians;var Y=function(){function h(){D(this,h)}return U(h,null,[{key:"arrayCopy",value:function(t,e,a,n,r){for(var o=e,s=n;o<e+r;o++,s++)a[s]=t[o]}},{key:"setArraySize",value:function(t,e){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=t.length;if(n==e)return t;if(t.length=e,n<e)for(var r=n;r<e;r++)t[r]=a;return t}},{key:"ensureArrayCapacity",value:function(t,e){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return t.length>=e?t:h.setArraySize(t,e,a)}},{key:"newArray",value:function(t,e){for(var a=new Array(t),n=0;n<t;n++)a[n]=e;return a}},{key:"newFloatArray",value:function(t){if(h.SUPPORTS_TYPED_ARRAYS)return new Float32Array(t);for(var e=new Array(t),a=0;a<e.length;a++)e[a]=0;return e}},{key:"newShortArray",value:function(t){if(h.SUPPORTS_TYPED_ARRAYS)return new Int16Array(t);for(var e=new Array(t),a=0;a<e.length;a++)e[a]=0;return e}},{key:"toFloatArray",value:function(t){return h.SUPPORTS_TYPED_ARRAYS?new Float32Array(t):t}},{key:"toSinglePrecision",value:function(t){return h.SUPPORTS_TYPED_ARRAYS?Math.fround(t):t}},{key:"webkit602BugfixHelper",value:function(t,e){}},{key:"contains",value:function(t,e){for(var a=0;a<t.length;a++)if(t[a]==e)return!0;return!1}}]),h}();Y.SUPPORTS_TYPED_ARRAYS=typeof Float32Array<"u";var pt,oa=function(){function h(t){D(this,h),this.items=new Array,this.instantiator=void 0,this.instantiator=t}return U(h,[{key:"obtain",value:function(){return this.items.length>0?this.items.pop():this.instantiator()}},{key:"free",value:function(t){t.reset&&t.reset(),this.items.push(t)}},{key:"freeAll",value:function(t){for(var e=0;e<t.length;e++)this.free(t[e])}},{key:"clear",value:function(){this.items.length=0}}]),h}(),la=function(){function h(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;D(this,h),this.x=t,this.y=e}return U(h,[{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"length",value:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}},{key:"normalize",value:function(){var t=this.length();return t!=0&&(this.x/=t,this.y/=t),this}}]),h}(),Ta=U(function h(t,e,a){if(D(this,h),this.index=void 0,this.name=void 0,this.parent=void 0,this.length=void 0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=pt.Normal,this.skinRequired=!1,this.color=new nt,t<0)throw new Error("index must be >= 0.");if(e==null)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=a});(function(h){h[h.Normal=0]="Normal",h[h.OnlyTranslation=1]="OnlyTranslation",h[h.NoRotationOrReflection=2]="NoRotationOrReflection",h[h.NoScale=3]="NoScale",h[h.NoScaleOrReflection=4]="NoScaleOrReflection"})(pt||(pt={}));var Xt,bt,Bt,pa=function(){function h(t,e,a){if(D(this,h),this.data=void 0,this.skeleton=void 0,this.parent=void 0,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,t==null)throw new Error("data cannot be null.");if(e==null)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=a,this.setToSetupPose()}return U(h,[{key:"isActive",value:function(){return this.active}},{key:"update",value:function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}},{key:"updateWorldTransform",value:function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}},{key:"updateWorldTransformWith",value:function(t,e,a,n,r,o,s){this.ax=t,this.ay=e,this.arotation=a,this.ascaleX=n,this.ascaleY=r,this.ashearX=o,this.ashearY=s,this.appliedValid=!0;var u=this.parent;if(u==null){var c=this.skeleton,l=a+90+s,i=c.scaleX,d=c.scaleY;return this.a=P.cosDeg(a+o)*n*i,this.b=P.cosDeg(l)*r*i,this.c=P.sinDeg(a+o)*n*d,this.d=P.sinDeg(l)*r*d,this.worldX=t*i+c.x,void(this.worldY=e*d+c.y)}var f=u.a,v=u.b,g=u.c,m=u.d;switch(this.worldX=f*t+v*e+u.worldX,this.worldY=g*t+m*e+u.worldY,this.data.transformMode){case pt.Normal:var p=a+90+s,y=P.cosDeg(a+o)*n,w=P.cosDeg(p)*r,k=P.sinDeg(a+o)*n,M=P.sinDeg(p)*r;return this.a=f*y+v*k,this.b=f*w+v*M,this.c=g*y+m*k,void(this.d=g*w+m*M);case pt.OnlyTranslation:var E=a+90+s;this.a=P.cosDeg(a+o)*n,this.b=P.cosDeg(E)*r,this.c=P.sinDeg(a+o)*n,this.d=P.sinDeg(E)*r;break;case pt.NoRotationOrReflection:var A=f*f+g*g,S=0;A>1e-4?(A=Math.abs(f*m-v*g)/A,f/=this.skeleton.scaleX,v=(g/=this.skeleton.scaleY)*A,m=f*A,S=Math.atan2(g,f)*P.radDeg):(f=0,g=0,S=90-Math.atan2(m,v)*P.radDeg);var C=a+o-S,R=a+s-S+90,I=P.cosDeg(C)*n,T=P.cosDeg(R)*r,B=P.sinDeg(C)*n,N=P.sinDeg(R)*r;this.a=f*I-v*B,this.b=f*T-v*N,this.c=g*I+m*B,this.d=g*T+m*N;break;case pt.NoScale:case pt.NoScaleOrReflection:var x=P.cosDeg(a),b=P.sinDeg(a),H=(f*x+v*b)/this.skeleton.scaleX,V=(g*x+m*b)/this.skeleton.scaleY,F=Math.sqrt(H*H+V*V);F>1e-5&&(F=1/F),H*=F,V*=F,F=Math.sqrt(H*H+V*V),this.data.transformMode==pt.NoScale&&f*m-v*g<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(F=-F);var L=Math.PI/2+Math.atan2(V,H),G=Math.cos(L)*F,j=Math.sin(L)*F,z=P.cosDeg(o)*n,q=P.cosDeg(90+s)*r,O=P.sinDeg(o)*n,X=P.sinDeg(90+s)*r;this.a=H*z+G*O,this.b=H*q+G*X,this.c=V*z+j*O,this.d=V*q+j*X}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY}},{key:"setToSetupPose",value:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}},{key:"getWorldRotationX",value:function(){return Math.atan2(this.c,this.a)*P.radDeg}},{key:"getWorldRotationY",value:function(){return Math.atan2(this.d,this.b)*P.radDeg}},{key:"getWorldScaleX",value:function(){return Math.sqrt(this.a*this.a+this.c*this.c)}},{key:"getWorldScaleY",value:function(){return Math.sqrt(this.b*this.b+this.d*this.d)}},{key:"updateAppliedTransform",value:function(){this.appliedValid=!0;var t=this.parent;if(t==null)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*P.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*P.radDeg);var e=t.a,a=t.b,n=t.c,r=t.d,o=1/(e*r-a*n),s=this.worldX-t.worldX,u=this.worldY-t.worldY;this.ax=s*r*o-u*a*o,this.ay=u*e*o-s*n*o;var c=o*r,l=o*e,i=o*a,d=o*n,f=c*this.a-i*this.c,v=c*this.b-i*this.d,g=l*this.c-d*this.a,m=l*this.d-d*this.b;if(this.ashearX=0,this.ascaleX=Math.sqrt(f*f+g*g),this.ascaleX>1e-4){var p=f*m-v*g;this.ascaleY=p/this.ascaleX,this.ashearY=Math.atan2(f*v+g*m,p)*P.radDeg,this.arotation=Math.atan2(g,f)*P.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(v*v+m*m),this.ashearY=0,this.arotation=90-Math.atan2(m,v)*P.radDeg}},{key:"worldToLocal",value:function(t){var e=this.a,a=this.b,n=this.c,r=this.d,o=1/(e*r-a*n),s=t.x-this.worldX,u=t.y-this.worldY;return t.x=s*r*o-u*a*o,t.y=u*e*o-s*n*o,t}},{key:"localToWorld",value:function(t){var e=t.x,a=t.y;return t.x=e*this.a+a*this.b+this.worldX,t.y=e*this.c+a*this.d+this.worldY,t}},{key:"worldToLocalRotation",value:function(t){var e=P.sinDeg(t),a=P.cosDeg(t);return Math.atan2(this.a*e-this.c*a,this.d*a-this.b*e)*P.radDeg+this.rotation-this.shearX}},{key:"localToWorldRotation",value:function(t){t-=this.rotation-this.shearX;var e=P.sinDeg(t),a=P.cosDeg(t);return Math.atan2(a*this.c+e*this.d,a*this.a+e*this.b)*P.radDeg}},{key:"rotateWorld",value:function(t){var e=this.a,a=this.b,n=this.c,r=this.d,o=P.cosDeg(t),s=P.sinDeg(t);this.a=o*e-s*n,this.b=o*a-s*r,this.c=s*e+o*n,this.d=s*a+o*r,this.appliedValid=!1}}]),h}(),en=function(){function h(t,e){if(D(this,h),this.data=void 0,this.bone=void 0,this.color=void 0,this.darkColor=void 0,this.attachment=void 0,this.attachmentTime=void 0,this.attachmentState=void 0,this.deform=new Array,t==null)throw new Error("data cannot be null.");if(e==null)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new nt,this.darkColor=t.darkColor==null?null:new nt,this.setToSetupPose()}return U(h,[{key:"getSkeleton",value:function(){return this.bone.skeleton}},{key:"getAttachment",value:function(){return this.attachment}},{key:"setAttachment",value:function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)}},{key:"setAttachmentTime",value:function(t){this.attachmentTime=this.bone.skeleton.time-t}},{key:"getAttachmentTime",value:function(){return this.bone.skeleton.time-this.attachmentTime}},{key:"setToSetupPose",value:function(){this.color.setFromColor(this.data.color),this.darkColor!=null&&this.darkColor.setFromColor(this.data.darkColor),this.data.attachmentName==null?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))}}]),h}(),an=function(){function h(t,e){if(D(this,h),this.data=void 0,this.bones=void 0,this.target=void 0,this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,t==null)throw new Error("data cannot be null.");if(e==null)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(var a=0;a<t.bones.length;a++)this.bones.push(e.findBone(t.bones[a].name));this.target=e.findBone(t.target.name)}return U(h,[{key:"isActive",value:function(){return this.active}},{key:"apply",value:function(){this.update()}},{key:"update",value:function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}}},{key:"apply1",value:function(t,e,a,n,r,o,s){t.appliedValid||t.updateAppliedTransform();var u=t.parent,c=u.a,l=u.b,i=u.c,d=u.d,f=-t.ashearX-t.arotation,v=0,g=0;switch(t.data.transformMode){case pt.OnlyTranslation:v=e-t.worldX,g=a-t.worldY;break;case pt.NoRotationOrReflection:var m=Math.abs(c*d-l*i)/(c*c+i*i),p=c/t.skeleton.scaleX,y=i/t.skeleton.scaleY;l=-y*m*t.skeleton.scaleX,d=p*m*t.skeleton.scaleY,f+=Math.atan2(y,p)*P.radDeg;default:var w=e-u.worldX,k=a-u.worldY,M=c*d-l*i;v=(w*d-k*l)/M-t.ax,g=(k*c-w*i)/M-t.ay}f+=Math.atan2(g,v)*P.radDeg,t.ascaleX<0&&(f+=180),f>180?f-=360:f<-180&&(f+=360);var E=t.ascaleX,A=t.ascaleY;if(n||r){switch(t.data.transformMode){case pt.NoScale:case pt.NoScaleOrReflection:v=e-t.worldX,g=a-t.worldY}var S=t.data.length*E,C=Math.sqrt(v*v+g*g);if(n&&C<S||r&&C>S&&S>1e-4){var R=(C/S-1)*s+1;E*=R,o&&(A*=R)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+f*s,E,A,t.ashearX,t.ashearY)}},{key:"apply2",value:function(t,e,a,n,r,o,s,u){if(u!=0){t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();var c=t.ax,l=t.ay,i=t.ascaleX,d=i,f=t.ascaleY,v=e.ascaleX,g=0,m=0,p=0;i<0?(i=-i,g=180,p=-1):(g=0,p=1),f<0&&(f=-f,p=-p),v<0?(v=-v,m=180):m=0;var y=e.ax,w=0,k=0,M=0,E=t.a,A=t.b,S=t.c,C=t.d,R=Math.abs(i-f)<=1e-4;R?(k=E*y+A*(w=e.ay)+t.worldX,M=S*y+C*w+t.worldY):(w=0,k=E*y+t.worldX,M=S*y+t.worldY);var I=t.parent;E=I.a,A=I.b,S=I.c;var T,B,N=1/(E*(C=I.d)-A*S),x=k-I.worldX,b=M-I.worldY,H=(x*C-b*A)*N-c,V=(b*E-x*S)*N-l,F=Math.sqrt(H*H+V*V),L=e.data.length*v;if(F<1e-4)return this.apply1(t,a,n,!1,o,!1,u),void e.updateWorldTransformWith(y,w,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);var G=((x=a-I.worldX)*C-(b=n-I.worldY)*A)*N-c,j=(b*E-x*S)*N-l,z=G*G+j*j;if(s!=0){s*=i*(v+1)/2;var q=Math.sqrt(z),O=q-F-L*i+s;if(O>0){var X=Math.min(1,O/(2*s))-1;z=(G-=(X=(O-s*(1-X*X))/q)*G)*G+(j-=X*j)*j}}t:if(R){var Q=(z-F*F-(L*=i)*L)/(2*F*L);Q<-1?Q=-1:Q>1&&(Q=1,o&&(d*=(Math.sqrt(z)/(F+L)-1)*u+1)),B=Math.acos(Q)*r,E=F+L*Q,A=L*Math.sin(B),T=Math.atan2(j*E-G*A,G*E+j*A)}else{var rt=(E=i*L)*E,J=(A=f*L)*A,tt=Math.atan2(j,G),W=-2*J*F,K=J-rt;if((C=W*W-4*K*(S=J*F*F+rt*z-rt*J))>=0){var Z=Math.sqrt(C);W<0&&(Z=-Z);var it=(Z=-(W+Z)/2)/K,et=S/Z,ht=Math.abs(it)<Math.abs(et)?it:et;if(ht*ht<=z){b=Math.sqrt(z-ht*ht)*r,T=tt-Math.atan2(b,ht),B=Math.atan2(b/f,(ht-F)/i);break t}}var ot=P.PI,lt=F-E,ut=lt*lt,$=0,ft=0,st=F+E,yt=st*st,dt=0;(S=-E*F/(rt-J))>=-1&&S<=1&&(S=Math.acos(S),(C=(x=E*Math.cos(S)+F)*x+(b=A*Math.sin(S))*b)<ut&&(ot=S,ut=C,lt=x,$=b),C>yt&&(ft=S,yt=C,st=x,dt=b)),z<=(ut+yt)/2?(T=tt-Math.atan2($*r,lt),B=ot*r):(T=tt-Math.atan2(dt*r,st),B=ft*r)}var mt=Math.atan2(w,y)*p,ct=t.arotation;(T=(T-mt)*P.radDeg+g-ct)>180?T-=360:T<-180&&(T+=360),t.updateWorldTransformWith(c,l,ct+T*u,d,t.ascaleY,0,0),ct=e.arotation,(B=((B+mt)*P.radDeg-e.ashearX)*p+m-ct)>180?B-=360:B<-180&&(B+=360),e.updateWorldTransformWith(y,w,ct+B*u,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}else e.updateWorldTransform()}}]),h}(),nn=function(){function h(t,e){if(D(this,h),this.data=void 0,this.bones=void 0,this.target=void 0,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new la,this.active=!1,t==null)throw new Error("data cannot be null.");if(e==null)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(var a=0;a<t.bones.length;a++)this.bones.push(e.findBone(t.bones[a].name));this.target=e.findBone(t.target.name)}return U(h,[{key:"isActive",value:function(){return this.active}},{key:"apply",value:function(){this.update()}},{key:"update",value:function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()}},{key:"applyAbsoluteWorld",value:function(){for(var t=this.rotateMix,e=this.translateMix,a=this.scaleMix,n=this.shearMix,r=this.target,o=r.a,s=r.b,u=r.c,c=r.d,l=o*c-s*u>0?P.degRad:-P.degRad,i=this.data.offsetRotation*l,d=this.data.offsetShearY*l,f=this.bones,v=0,g=f.length;v<g;v++){var m=f[v],p=!1;if(t!=0){var y=m.a,w=m.b,k=m.c,M=m.d,E=Math.atan2(u,o)-Math.atan2(k,y)+i;E>P.PI?E-=P.PI2:E<-P.PI&&(E+=P.PI2),E*=t;var A=Math.cos(E),S=Math.sin(E);m.a=A*y-S*k,m.b=A*w-S*M,m.c=S*y+A*k,m.d=S*w+A*M,p=!0}if(e!=0){var C=this.temp;r.localToWorld(C.set(this.data.offsetX,this.data.offsetY)),m.worldX+=(C.x-m.worldX)*e,m.worldY+=(C.y-m.worldY)*e,p=!0}if(a>0){var R=Math.sqrt(m.a*m.a+m.c*m.c),I=Math.sqrt(o*o+u*u);R>1e-5&&(R=(R+(I-R+this.data.offsetScaleX)*a)/R),m.a*=R,m.c*=R,R=Math.sqrt(m.b*m.b+m.d*m.d),I=Math.sqrt(s*s+c*c),R>1e-5&&(R=(R+(I-R+this.data.offsetScaleY)*a)/R),m.b*=R,m.d*=R,p=!0}if(n>0){var T=m.b,B=m.d,N=Math.atan2(B,T),x=Math.atan2(c,s)-Math.atan2(u,o)-(N-Math.atan2(m.c,m.a));x>P.PI?x-=P.PI2:x<-P.PI&&(x+=P.PI2),x=N+(x+d)*n;var b=Math.sqrt(T*T+B*B);m.b=Math.cos(x)*b,m.d=Math.sin(x)*b,p=!0}p&&(m.appliedValid=!1)}}},{key:"applyRelativeWorld",value:function(){for(var t=this.rotateMix,e=this.translateMix,a=this.scaleMix,n=this.shearMix,r=this.target,o=r.a,s=r.b,u=r.c,c=r.d,l=o*c-s*u>0?P.degRad:-P.degRad,i=this.data.offsetRotation*l,d=this.data.offsetShearY*l,f=this.bones,v=0,g=f.length;v<g;v++){var m=f[v],p=!1;if(t!=0){var y=m.a,w=m.b,k=m.c,M=m.d,E=Math.atan2(u,o)+i;E>P.PI?E-=P.PI2:E<-P.PI&&(E+=P.PI2),E*=t;var A=Math.cos(E),S=Math.sin(E);m.a=A*y-S*k,m.b=A*w-S*M,m.c=S*y+A*k,m.d=S*w+A*M,p=!0}if(e!=0){var C=this.temp;r.localToWorld(C.set(this.data.offsetX,this.data.offsetY)),m.worldX+=C.x*e,m.worldY+=C.y*e,p=!0}if(a>0){var R=(Math.sqrt(o*o+u*u)-1+this.data.offsetScaleX)*a+1;m.a*=R,m.c*=R,R=(Math.sqrt(s*s+c*c)-1+this.data.offsetScaleY)*a+1,m.b*=R,m.d*=R,p=!0}if(n>0){var I=Math.atan2(c,s)-Math.atan2(u,o);I>P.PI?I-=P.PI2:I<-P.PI&&(I+=P.PI2);var T=m.b,B=m.d;I=Math.atan2(B,T)+(I-P.PI/2+d)*n;var N=Math.sqrt(T*T+B*B);m.b=Math.cos(I)*N,m.d=Math.sin(I)*N,p=!0}p&&(m.appliedValid=!1)}}},{key:"applyAbsoluteLocal",value:function(){var t=this.rotateMix,e=this.translateMix,a=this.scaleMix,n=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();for(var o=this.bones,s=0,u=o.length;s<u;s++){var c=o[s];c.appliedValid||c.updateAppliedTransform();var l=c.arotation;if(t!=0){var i=r.arotation-l+this.data.offsetRotation;l+=(i-=360*(16384-(16384.499999999996-i/360|0)))*t}var d=c.ax,f=c.ay;e!=0&&(d+=(r.ax-d+this.data.offsetX)*e,f+=(r.ay-f+this.data.offsetY)*e);var v=c.ascaleX,g=c.ascaleY;a!=0&&(v>1e-5&&(v=(v+(r.ascaleX-v+this.data.offsetScaleX)*a)/v),g>1e-5&&(g=(g+(r.ascaleY-g+this.data.offsetScaleY)*a)/g));var m=c.ashearY;if(n!=0){var p=r.ashearY-m+this.data.offsetShearY;p-=360*(16384-(16384.499999999996-p/360|0)),c.shearY+=p*n}c.updateWorldTransformWith(d,f,l,v,g,c.ashearX,m)}}},{key:"applyRelativeLocal",value:function(){var t=this.rotateMix,e=this.translateMix,a=this.scaleMix,n=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();for(var o=this.bones,s=0,u=o.length;s<u;s++){var c=o[s];c.appliedValid||c.updateAppliedTransform();var l=c.arotation;t!=0&&(l+=(r.arotation+this.data.offsetRotation)*t);var i=c.ax,d=c.ay;e!=0&&(i+=(r.ax+this.data.offsetX)*e,d+=(r.ay+this.data.offsetY)*e);var f=c.ascaleX,v=c.ascaleY;a!=0&&(f>1e-5&&(f*=(r.ascaleX-1+this.data.offsetScaleX)*a+1),v>1e-5&&(v*=(r.ascaleY-1+this.data.offsetScaleY)*a+1));var g=c.ashearY;n!=0&&(g+=(r.ashearY+this.data.offsetShearY)*n),c.updateWorldTransformWith(i,d,l,f,v,c.ashearX,g)}}}]),h}(),da=U(function h(t,e,a){D(this,h),this.name=t,this.order=e,this.skinRequired=a}),Pa=function(h){vt(e,da);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a,0,!1)).bones=new Array,n.target=void 0,n.positionMode=void 0,n.spacingMode=void 0,n.rotateMode=void 0,n.offsetRotation=void 0,n.position=void 0,n.spacing=void 0,n.rotateMix=void 0,n.translateMix=void 0,n}return U(e)}();(function(h){h[h.Fixed=0]="Fixed",h[h.Percent=1]="Percent"})(Xt||(Xt={})),function(h){h[h.Length=0]="Length",h[h.Fixed=1]="Fixed",h[h.Percent=2]="Percent"}(bt||(bt={})),function(h){h[h.Tangent=0]="Tangent",h[h.Chain=1]="Chain",h[h.ChainScale=2]="ChainScale"}(Bt||(Bt={}));var Fa=U(function h(t){if(D(this,h),this.name=void 0,t==null)throw new Error("name cannot be null.");this.name=t}),Me=function(h){vt(e,Fa);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a)).id=(65535&e.nextID++)<<11,n.bones=void 0,n.vertices=void 0,n.worldVerticesLength=0,n.deformAttachment=Ut(n),n}return U(e,[{key:"computeWorldVertices",value:function(a,n,r,o,s,u){r=s+(r>>1)*u;var c=a.bone.skeleton,l=a.deform,i=this.vertices,d=this.bones;if(d!=null){for(var f=0,v=0,g=0;g<n;g+=2){var m=d[f];f+=m+1,v+=m}var p=c.bones;if(l.length==0)for(var y=s,w=3*v;y<r;y+=u){var k=0,M=0,E=d[f++];for(E+=f;f<E;f++,w+=3){var A=p[d[f]],S=i[w],C=i[w+1],R=i[w+2];k+=(S*A.a+C*A.b+A.worldX)*R,M+=(S*A.c+C*A.d+A.worldY)*R}o[y]=k,o[y+1]=M}else for(var I=l,T=s,B=3*v,N=v<<1;T<r;T+=u){var x=0,b=0,H=d[f++];for(H+=f;f<H;f++,B+=3,N+=2){var V=p[d[f]],F=i[B]+I[N],L=i[B+1]+I[N+1],G=i[B+2];x+=(F*V.a+L*V.b+V.worldX)*G,b+=(F*V.c+L*V.d+V.worldY)*G}o[T]=x,o[T+1]=b}}else{l.length>0&&(i=l);for(var j=a.bone,z=j.worldX,q=j.worldY,O=j.a,X=j.b,Q=j.c,rt=j.d,J=n,tt=s;tt<r;J+=2,tt+=u){var W=i[J],K=i[J+1];o[tt]=W*O+K*X+z,o[tt+1]=W*Q+K*rt+q}}}},{key:"copyTo",value:function(a){this.bones!=null?(a.bones=new Array(this.bones.length),Y.arrayCopy(this.bones,0,a.bones,0,this.bones.length)):a.bones=null,this.vertices!=null?(a.vertices=Y.newFloatArray(this.vertices.length),Y.arrayCopy(this.vertices,0,a.vertices,0,this.vertices.length)):a.vertices=null,a.worldVerticesLength=this.worldVerticesLength,a.deformAttachment=this.deformAttachment}}]),e}();Me.nextID=0;var Ke=function(h){vt(e,Me);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a)).lengths=void 0,n.closed=!1,n.constantSpeed=!1,n.color=new nt(1,1,1,1),n}return U(e,[{key:"copy",value:function(){var a=new e(this.name);return this.copyTo(a),a.lengths=new Array(this.lengths.length),Y.arrayCopy(this.lengths,0,a.lengths,0,this.lengths.length),a.closed=closed,a.constantSpeed=this.constantSpeed,a.color.setFromColor(this.color),a}}]),e}(),Oe=function(){function h(t,e){if(D(this,h),this.data=void 0,this.bones=void 0,this.target=void 0,this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,t==null)throw new Error("data cannot be null.");if(e==null)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(var a=0,n=t.bones.length;a<n;a++)this.bones.push(e.findBone(t.bones[a].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}return U(h,[{key:"isActive",value:function(){return this.active}},{key:"apply",value:function(){this.update()}},{key:"update",value:function(){var t=this.target.getAttachment();if(t instanceof Ke){var e=this.rotateMix,a=this.translateMix,n=e>0;if(a>0||n){var r=this.data,o=r.spacingMode==bt.Percent,s=r.rotateMode,u=s==Bt.Tangent,c=s==Bt.ChainScale,l=this.bones.length,i=u?l:l+1,d=this.bones,f=Y.setArraySize(this.spaces,i),v=null,g=this.spacing;if(c||!o){c&&(v=Y.setArraySize(this.lengths,l));for(var m=r.spacingMode==bt.Length,p=0,y=i-1;p<y;){var w=d[p],k=w.data.length;if(k<h.epsilon)c&&(v[p]=0),f[++p]=0;else if(o){if(c){var M=k*w.a,E=k*w.c,A=Math.sqrt(M*M+E*E);v[p]=A}f[++p]=g}else{var S=k*w.a,C=k*w.c,R=Math.sqrt(S*S+C*C);c&&(v[p]=R),f[++p]=(m?k+g:g)*R/k}}}else for(var I=1;I<i;I++)f[I]=g;var T=this.computeWorldPositions(t,i,u,r.positionMode==Xt.Percent,o),B=T[0],N=T[1],x=r.offsetRotation,b=!1;if(x==0)b=s==Bt.Chain;else{b=!1;var H=this.target.bone;x*=H.a*H.d-H.b*H.c>0?P.degRad:-P.degRad}for(var V=0,F=3;V<l;V++,F+=3){var L=d[V];L.worldX+=(B-L.worldX)*a,L.worldY+=(N-L.worldY)*a;var G=T[F],j=T[F+1],z=G-B,q=j-N;if(c){var O=v[V];if(O!=0){var X=(Math.sqrt(z*z+q*q)/O-1)*e+1;L.a*=X,L.c*=X}}if(B=G,N=j,n){var Q=L.a,rt=L.b,J=L.c,tt=L.d,W=0,K=0,Z=0;if(W=u?T[F-1]:f[V+1]==0?T[F+2]:Math.atan2(q,z),W-=Math.atan2(J,Q),b){K=Math.cos(W),Z=Math.sin(W);var it=L.data.length;B+=(it*(K*Q-Z*J)-z)*e,N+=(it*(Z*Q+K*J)-q)*e}else W+=x;W>P.PI?W-=P.PI2:W<-P.PI&&(W+=P.PI2),W*=e,K=Math.cos(W),Z=Math.sin(W),L.a=K*Q-Z*J,L.b=K*rt-Z*tt,L.c=Z*Q+K*J,L.d=Z*rt+K*tt}L.appliedValid=!1}}}}},{key:"computeWorldPositions",value:function(t,e,a,n,r){var o=this.target,s=this.position,u=this.spaces,c=Y.setArraySize(this.positions,3*e+2),l=null,i=t.closed,d=t.worldVerticesLength,f=d/6,v=h.NONE;if(!t.constantSpeed){var g=t.lengths,m=g[f-=i?1:2];if(n&&(s*=m),r)for(var p=1;p<e;p++)u[p]*=m;l=Y.setArraySize(this.world,8);for(var y=0,w=0,k=0;y<e;y++,w+=3){var M=u[y],E=s+=M;if(i)(E%=m)<0&&(E+=m),k=0;else{if(E<0){v!=h.BEFORE&&(v=h.BEFORE,t.computeWorldVertices(o,2,4,l,0,2)),this.addBeforePosition(E,l,0,c,w);continue}if(E>m){v!=h.AFTER&&(v=h.AFTER,t.computeWorldVertices(o,d-6,4,l,0,2)),this.addAfterPosition(E-m,l,0,c,w);continue}}for(;;k++){var A=g[k];if(!(E>A)){if(k==0)E/=A;else{var S=g[k-1];E=(E-S)/(A-S)}break}}k!=v&&(v=k,i&&k==f?(t.computeWorldVertices(o,d-4,4,l,0,2),t.computeWorldVertices(o,0,4,l,4,2)):t.computeWorldVertices(o,6*k+2,8,l,0,2)),this.addCurvePosition(E,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],c,w,a||y>0&&M==0)}return c}i?(d+=2,l=Y.setArraySize(this.world,d),t.computeWorldVertices(o,2,d-4,l,0,2),t.computeWorldVertices(o,0,2,l,d-4,2),l[d-2]=l[0],l[d-1]=l[1]):(f--,d-=4,l=Y.setArraySize(this.world,d),t.computeWorldVertices(o,2,d,l,0,2));for(var C=Y.setArraySize(this.curves,f),R=0,I=l[0],T=l[1],B=0,N=0,x=0,b=0,H=0,V=0,F=0,L=0,G=0,j=0,z=0,q=0,O=0,X=0,Q=0,rt=2;Q<f;Q++,rt+=6)B=l[rt],N=l[rt+1],x=l[rt+2],b=l[rt+3],z=2*(F=.1875*(I-2*B+x))+(G=.09375*(3*(B-x)-I+(H=l[rt+4]))),q=2*(L=.1875*(T-2*N+b))+(j=.09375*(3*(N-b)-T+(V=l[rt+5]))),O=.75*(B-I)+F+.16666667*G,X=.75*(N-T)+L+.16666667*j,R+=Math.sqrt(O*O+X*X),O+=z,X+=q,z+=G,q+=j,R+=Math.sqrt(O*O+X*X),O+=z,X+=q,R+=Math.sqrt(O*O+X*X),O+=z+G,X+=q+j,R+=Math.sqrt(O*O+X*X),C[Q]=R,I=H,T=V;if(s*=n?R:R/t.lengths[f-1],r)for(var J=1;J<e;J++)u[J]*=R;for(var tt=this.segments,W=0,K=0,Z=0,it=0,et=0;K<e;K++,Z+=3){var ht=u[K],ot=s+=ht;if(i)(ot%=R)<0&&(ot+=R),it=0;else{if(ot<0){this.addBeforePosition(ot,l,0,c,Z);continue}if(ot>R){this.addAfterPosition(ot-R,l,d-4,c,Z);continue}}for(;;it++){var lt=C[it];if(!(ot>lt)){if(it==0)ot/=lt;else{var ut=C[it-1];ot=(ot-ut)/(lt-ut)}break}}if(it!=v){v=it;var $=6*it;for(I=l[$],T=l[$+1],B=l[$+2],N=l[$+3],x=l[$+4],b=l[$+5],z=2*(F=.03*(I-2*B+x))+(G=.006*(3*(B-x)-I+(H=l[$+6]))),q=2*(L=.03*(T-2*N+b))+(j=.006*(3*(N-b)-T+(V=l[$+7]))),O=.3*(B-I)+F+.16666667*G,X=.3*(N-T)+L+.16666667*j,W=Math.sqrt(O*O+X*X),tt[0]=W,$=1;$<8;$++)O+=z,X+=q,z+=G,q+=j,W+=Math.sqrt(O*O+X*X),tt[$]=W;O+=z,X+=q,W+=Math.sqrt(O*O+X*X),tt[8]=W,O+=z+G,X+=q+j,W+=Math.sqrt(O*O+X*X),tt[9]=W,et=0}for(ot*=W;;et++){var ft=tt[et];if(!(ot>ft)){if(et==0)ot/=ft;else{var st=tt[et-1];ot=et+(ot-st)/(ft-st)}break}}this.addCurvePosition(.1*ot,I,T,B,N,x,b,H,V,c,Z,a||K>0&&ht==0)}return c}},{key:"addBeforePosition",value:function(t,e,a,n,r){var o=e[a],s=e[a+1],u=e[a+2]-o,c=e[a+3]-s,l=Math.atan2(c,u);n[r]=o+t*Math.cos(l),n[r+1]=s+t*Math.sin(l),n[r+2]=l}},{key:"addAfterPosition",value:function(t,e,a,n,r){var o=e[a+2],s=e[a+3],u=o-e[a],c=s-e[a+1],l=Math.atan2(c,u);n[r]=o+t*Math.cos(l),n[r+1]=s+t*Math.sin(l),n[r+2]=l}},{key:"addCurvePosition",value:function(t,e,a,n,r,o,s,u,c,l,i,d){if(t==0||isNaN(t))return l[i]=e,l[i+1]=a,void(l[i+2]=Math.atan2(r-a,n-e));var f=t*t,v=f*t,g=1-t,m=g*g,p=m*g,y=g*t,w=3*y,k=g*w,M=w*t,E=e*p+n*k+o*M+u*v,A=a*p+r*k+s*M+c*v;l[i]=E,l[i+1]=A,d&&(l[i+2]=t<.001?Math.atan2(r-a,n-e):Math.atan2(A-(a*m+r*y*2+s*f),E-(e*m+n*y*2+o*f)))}}]),h}();Oe.NONE=-1,Oe.BEFORE=-2,Oe.AFTER=-3,Oe.epsilon=1e-5;var at=function(h){vt(e,Fa);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a)).x=0,n.y=0,n.scaleX=1,n.scaleY=1,n.rotation=0,n.width=0,n.height=0,n.color=new nt(1,1,1,1),n.path=void 0,n.rendererObject=void 0,n.region=void 0,n.offset=Y.newFloatArray(8),n.uvs=Y.newFloatArray(8),n.tempColor=new nt(1,1,1,1),n}return U(e,[{key:"updateOffset",value:function(){var a=this.width/this.region.originalWidth*this.scaleX,n=this.height/this.region.originalHeight*this.scaleY,r=-this.width/2*this.scaleX+this.region.offsetX*a,o=-this.height/2*this.scaleY+this.region.offsetY*n,s=r+this.region.width*a,u=o+this.region.height*n,c=this.rotation*Math.PI/180,l=Math.cos(c),i=Math.sin(c),d=r*l+this.x,f=r*i,v=o*l+this.y,g=o*i,m=s*l+this.x,p=s*i,y=u*l+this.y,w=u*i,k=this.offset;k[e.OX1]=d-g,k[e.OY1]=v+f,k[e.OX2]=d-w,k[e.OY2]=y+f,k[e.OX3]=m-w,k[e.OY3]=y+p,k[e.OX4]=m-g,k[e.OY4]=v+p}},{key:"setRegion",value:function(a){this.region=a;var n=this.uvs;a.rotate?(n[2]=a.u,n[3]=a.v2,n[4]=a.u,n[5]=a.v,n[6]=a.u2,n[7]=a.v,n[0]=a.u2,n[1]=a.v2):(n[0]=a.u,n[1]=a.v2,n[2]=a.u,n[3]=a.v,n[4]=a.u2,n[5]=a.v,n[6]=a.u2,n[7]=a.v2)}},{key:"computeWorldVertices",value:function(a,n,r,o){var s=this.offset,u=a.worldX,c=a.worldY,l=a.a,i=a.b,d=a.c,f=a.d,v=0,g=0;v=s[e.OX1],g=s[e.OY1],n[r]=v*l+g*i+u,n[r+1]=v*d+g*f+c,r+=o,v=s[e.OX2],g=s[e.OY2],n[r]=v*l+g*i+u,n[r+1]=v*d+g*f+c,r+=o,v=s[e.OX3],g=s[e.OY3],n[r]=v*l+g*i+u,n[r+1]=v*d+g*f+c,r+=o,v=s[e.OX4],g=s[e.OY4],n[r]=v*l+g*i+u,n[r+1]=v*d+g*f+c}},{key:"copy",value:function(){var a=new e(this.name);return a.region=this.region,a.rendererObject=this.rendererObject,a.path=this.path,a.x=this.x,a.y=this.y,a.scaleX=this.scaleX,a.scaleY=this.scaleY,a.rotation=this.rotation,a.width=this.width,a.height=this.height,Y.arrayCopy(this.uvs,0,a.uvs,0,8),Y.arrayCopy(this.offset,0,a.offset,0,8),a.color.setFromColor(this.color),a}}]),e}();at.OX1=0,at.OY1=1,at.OX2=2,at.OY2=3,at.OX3=4,at.OY3=5,at.OX4=6,at.OY4=7,at.X1=0,at.Y1=1,at.C1R=2,at.C1G=3,at.C1B=4,at.C1A=5,at.U1=6,at.V1=7,at.X2=8,at.Y2=9,at.C2R=10,at.C2G=11,at.C2B=12,at.C2A=13,at.U2=14,at.V2=15,at.X3=16,at.Y3=17,at.C3R=18,at.C3G=19,at.C3B=20,at.C3A=21,at.U3=22,at.V3=23,at.X4=24,at.Y4=25,at.C4R=26,at.C4G=27,at.C4B=28,at.C4A=29,at.U4=30,at.V4=31;var Qt,qt,Je=function(){function h(t){D(this,h),this._image=void 0,this._image=t}return U(h,[{key:"getImage",value:function(){return this._image}}],[{key:"filterFromString",value:function(t){switch(t.toLowerCase()){case"nearest":return Qt.Nearest;case"linear":return Qt.Linear;case"mipmap":return Qt.MipMap;case"mipmapnearestnearest":return Qt.MipMapNearestNearest;case"mipmaplinearnearest":return Qt.MipMapLinearNearest;case"mipmapnearestlinear":return Qt.MipMapNearestLinear;case"mipmaplinearlinear":return Qt.MipMapLinearLinear;default:throw new Error("Unknown texture filter ".concat(t))}}},{key:"wrapFromString",value:function(t){switch(t.toLowerCase()){case"mirroredtepeat":return qt.MirroredRepeat;case"clamptoedge":return qt.ClampToEdge;case"repeat":return qt.Repeat;default:throw new Error("Unknown texture wrap ".concat(t))}}}]),h}();(function(h){h[h.Nearest=9728]="Nearest",h[h.Linear=9729]="Linear",h[h.MipMap=9987]="MipMap",h[h.MipMapNearestNearest=9984]="MipMapNearestNearest",h[h.MipMapLinearNearest=9985]="MipMapLinearNearest",h[h.MipMapNearestLinear=9986]="MipMapNearestLinear",h[h.MipMapLinearLinear=9987]="MipMapLinearLinear"})(Qt||(Qt={})),function(h){h[h.MirroredRepeat=33648]="MirroredRepeat",h[h.ClampToEdge=33071]="ClampToEdge",h[h.Repeat=10497]="Repeat"}(qt||(qt={}));var _,It,St,rn=U(function h(){D(this,h),this.renderObject=void 0,this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.rotate=!1,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0}),sn=function(h){vt(e,Je);var t=gt(e);function e(){return D(this,e),t.apply(this,arguments)}return U(e,[{key:"setFilters",value:function(a,n){}},{key:"setWraps",value:function(a,n){}},{key:"dispose",value:function(){}}]),e}(),ha=function(){function h(t,e){D(this,h),this.pages=new Array,this.regions=new Array,this.load(t,e)}return U(h,[{key:"load",value:function(t,e){if(e==null)throw new Error("textureLoader cannot be null.");for(var a=new on(t),n=new Array(4),r=null;;){var o=a.readLine();if(o==null)break;if((o=o.trim()).length==0)r=null;else if(r){var s=new Ca;s.name=o,s.page=r;var u=a.readValue();u.toLocaleLowerCase()=="true"?s.degrees=90:u.toLocaleLowerCase()=="false"?s.degrees=0:s.degrees=parseFloat(u),s.rotate=s.degrees==90,a.readTuple(n);var c=parseInt(n[0]),l=parseInt(n[1]);a.readTuple(n);var i=parseInt(n[0]),d=parseInt(n[1]);s.u=c/r.width,s.v=l/r.height,s.rotate?(s.u2=(c+d)/r.width,s.v2=(l+i)/r.height):(s.u2=(c+i)/r.width,s.v2=(l+d)/r.height),s.x=c,s.y=l,s.width=Math.abs(i),s.height=Math.abs(d),a.readTuple(n)==4&&a.readTuple(n)==4&&a.readTuple(n),s.originalWidth=parseInt(n[0]),s.originalHeight=parseInt(n[1]),a.readTuple(n),s.offsetX=parseInt(n[0]),s.offsetY=parseInt(n[1]),s.index=parseInt(a.readValue()),s.texture=r.texture,this.regions.push(s)}else{(r=new ln).name=o,a.readTuple(n)==2&&(r.width=parseInt(n[0]),r.height=parseInt(n[1]),a.readTuple(n)),a.readTuple(n),r.minFilter=Je.filterFromString(n[0]),r.magFilter=Je.filterFromString(n[1]);var f=a.readValue();r.uWrap=qt.ClampToEdge,r.vWrap=qt.ClampToEdge,f=="x"?r.uWrap=qt.Repeat:f=="y"?r.vWrap=qt.Repeat:f=="xy"&&(r.uWrap=r.vWrap=qt.Repeat),r.texture=e(o),r.texture.setFilters(r.minFilter,r.magFilter),r.texture.setWraps(r.uWrap,r.vWrap),r.width=r.texture.getImage().width,r.height=r.texture.getImage().height,this.pages.push(r)}}}},{key:"findRegion",value:function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null}},{key:"dispose",value:function(){for(var t=0;t<this.pages.length;t++)this.pages[t].texture.dispose()}}]),h}(),on=function(){function h(t){D(this,h),this.lines=void 0,this.index=0,this.lines=t.split(/\r\n|\r|\n/)}return U(h,[{key:"readLine",value:function(){return this.index>=this.lines.length?null:this.lines[this.index++]}},{key:"readValue",value:function(){var t=this.readLine(),e=t.indexOf(":");if(e==-1)throw new Error("Invalid line: "+t);return t.substring(e+1).trim()}},{key:"readTuple",value:function(t){var e=this.readLine(),a=e.indexOf(":");if(a==-1)throw new Error("Invalid line: "+e);for(var n=0,r=a+1;n<3;n++){var o=e.indexOf(",",r);if(o==-1)break;t[n]=e.substr(r,o-r).trim(),r=o+1}return t[n]=e.substring(r).trim(),n+1}}]),h}(),ln=U(function h(){D(this,h),this.name=void 0,this.minFilter=void 0,this.magFilter=void 0,this.uWrap=void 0,this.vWrap=void 0,this.texture=void 0,this.width=void 0,this.height=void 0}),Ca=function(h){vt(e,rn);var t=gt(e);function e(){var a;D(this,e);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=t.call.apply(t,[this].concat(r))).page=void 0,a.name=void 0,a.x=void 0,a.y=void 0,a.index=void 0,a.rotate=void 0,a.degrees=void 0,a.texture=void 0,a}return U(e)}(),Ue=function(h){vt(e,Me);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a)).region=void 0,n.path=void 0,n.regionUVs=void 0,n.uvs=void 0,n.triangles=void 0,n.color=new nt(1,1,1,1),n.width=void 0,n.height=void 0,n.hullLength=void 0,n.edges=void 0,n.parentMesh=void 0,n.tempColor=new nt(0,0,0,0),n}return U(e,[{key:"updateUVs",value:function(){var a=this.regionUVs;this.uvs!=null&&this.uvs.length==a.length||(this.uvs=Y.newFloatArray(a.length));var n=this.uvs,r=this.uvs.length,o=this.region.u,s=this.region.v,u=0,c=0;if(this.region instanceof Ca){var l=this.region,i=l.texture.getImage().width,d=l.texture.getImage().height;switch(l.degrees){case 90:o-=(l.originalHeight-l.offsetY-l.height)/i,s-=(l.originalWidth-l.offsetX-l.width)/d,u=l.originalHeight/i,c=l.originalWidth/d;for(var f=0;f<r;f+=2)n[f]=o+a[f+1]*u,n[f+1]=s+(1-a[f])*c;return;case 180:o-=(l.originalWidth-l.offsetX-l.width)/i,s-=l.offsetY/d,u=l.originalWidth/i,c=l.originalHeight/d;for(var v=0;v<r;v+=2)n[v]=o+(1-a[v])*u,n[v+1]=s+(1-a[v+1])*c;return;case 270:o-=l.offsetY/i,s-=l.offsetX/d,u=l.originalHeight/i,c=l.originalWidth/d;for(var g=0;g<r;g+=2)n[g]=o+(1-a[g+1])*u,n[g+1]=s+a[g]*c;return}o-=l.offsetX/i,s-=(l.originalHeight-l.offsetY-l.height)/d,u=l.originalWidth/i,c=l.originalHeight/d}else this.region==null?(o=s=0,u=c=1):(u=this.region.u2-o,c=this.region.v2-s);for(var m=0;m<r;m+=2)n[m]=o+a[m]*u,n[m+1]=s+a[m+1]*c}},{key:"getParentMesh",value:function(){return this.parentMesh}},{key:"setParentMesh",value:function(a){this.parentMesh=a,a!=null&&(this.bones=a.bones,this.vertices=a.vertices,this.worldVerticesLength=a.worldVerticesLength,this.regionUVs=a.regionUVs,this.triangles=a.triangles,this.hullLength=a.hullLength,this.worldVerticesLength=a.worldVerticesLength)}},{key:"copy",value:function(){if(this.parentMesh!=null)return this.newLinkedMesh();var a=new e(this.name);return a.region=this.region,a.path=this.path,a.color.setFromColor(this.color),this.copyTo(a),a.regionUVs=new Array(this.regionUVs.length),Y.arrayCopy(this.regionUVs,0,a.regionUVs,0,this.regionUVs.length),a.uvs=new Array(this.uvs.length),Y.arrayCopy(this.uvs,0,a.uvs,0,this.uvs.length),a.triangles=new Array(this.triangles.length),Y.arrayCopy(this.triangles,0,a.triangles,0,this.triangles.length),a.hullLength=this.hullLength,this.edges!=null&&(a.edges=new Array(this.edges.length),Y.arrayCopy(this.edges,0,a.edges,0,this.edges.length)),a.width=this.width,a.height=this.height,a}},{key:"newLinkedMesh",value:function(){var a=new e(this.name);return a.region=this.region,a.path=this.path,a.color.setFromColor(this.color),a.deformAttachment=this.deformAttachment,a.setParentMesh(this.parentMesh!=null?this.parentMesh:this),a.updateUVs(),a}}]),e}(),hn=function(){function h(t){if(D(this,h),this.data=void 0,this.bones=void 0,this.slots=void 0,this.drawOrder=void 0,this.ikConstraints=void 0,this.transformConstraints=void 0,this.pathConstraints=void 0,this._updateCache=new Array,this.updateCacheReset=new Array,this.skin=void 0,this.color=void 0,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,t==null)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(var e=0;e<t.bones.length;e++){var a=t.bones[e],n=void 0;if(a.parent==null)n=new pa(a,this,null);else{var r=this.bones[a.parent.index];n=new pa(a,this,r),r.children.push(n)}this.bones.push(n)}this.slots=new Array,this.drawOrder=new Array;for(var o=0;o<t.slots.length;o++){var s=t.slots[o],u=this.bones[s.boneData.index],c=new en(s,u);this.slots.push(c),this.drawOrder.push(c)}this.ikConstraints=new Array;for(var l=0;l<t.ikConstraints.length;l++){var i=t.ikConstraints[l];this.ikConstraints.push(new an(i,this))}this.transformConstraints=new Array;for(var d=0;d<t.transformConstraints.length;d++){var f=t.transformConstraints[d];this.transformConstraints.push(new nn(f,this))}this.pathConstraints=new Array;for(var v=0;v<t.pathConstraints.length;v++){var g=t.pathConstraints[v];this.pathConstraints.push(new Oe(g,this))}this.color=new nt(1,1,1,1),this.updateCache()}return U(h,[{key:"updateCache",value:function(){var t=this._updateCache;t.length=0,this.updateCacheReset.length=0;for(var e=this.bones,a=0,n=e.length;a<n;a++){var r=e[a];r.sorted=r.data.skinRequired,r.active=!r.sorted}if(this.skin!=null)for(var o=this.skin.bones,s=0,u=this.skin.bones.length;s<u;s++){var c=this.bones[o[s].index];do c.sorted=!1,c.active=!0,c=c.parent;while(c!=null)}var l=this.ikConstraints,i=this.transformConstraints,d=this.pathConstraints,f=l.length,v=i.length,g=d.length,m=f+v+g;t:for(var p=0;p<m;p++){for(var y=0;y<f;y++){var w=l[y];if(w.data.order==p){this.sortIkConstraint(w);continue t}}for(var k=0;k<v;k++){var M=i[k];if(M.data.order==p){this.sortTransformConstraint(M);continue t}}for(var E=0;E<g;E++){var A=d[E];if(A.data.order==p){this.sortPathConstraint(A);continue t}}}for(var S=0,C=e.length;S<C;S++)this.sortBone(e[S])}},{key:"sortIkConstraint",value:function(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin!=null&&Y.contains(this.skin.constraints,t.data,!0)),t.active){var e=t.target;this.sortBone(e);var a=t.bones,n=a[0];if(this.sortBone(n),a.length>1){var r=a[a.length-1];this._updateCache.indexOf(r)>-1||this.updateCacheReset.push(r)}this._updateCache.push(t),this.sortReset(n.children),a[a.length-1].sorted=!0}}},{key:"sortPathConstraint",value:function(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||this.skin!=null&&Y.contains(this.skin.constraints,t.data,!0)),t.active){var e=t.target,a=e.data.index,n=e.bone;this.skin!=null&&this.sortPathConstraintAttachment(this.skin,a,n),this.data.defaultSkin!=null&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,a,n);for(var r=0,o=this.data.skins.length;r<o;r++)this.sortPathConstraintAttachment(this.data.skins[r],a,n);var s=e.getAttachment();s instanceof Ke&&this.sortPathConstraintAttachmentWith(s,n);for(var u=t.bones,c=u.length,l=0;l<c;l++)this.sortBone(u[l]);this._updateCache.push(t);for(var i=0;i<c;i++)this.sortReset(u[i].children);for(var d=0;d<c;d++)u[d].sorted=!0}}},{key:"sortTransformConstraint",value:function(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin!=null&&Y.contains(this.skin.constraints,t.data,!0)),t.active){this.sortBone(t.target);var e=t.bones,a=e.length;if(t.data.local)for(var n=0;n<a;n++){var r=e[n];this.sortBone(r.parent),this._updateCache.indexOf(r)>-1||this.updateCacheReset.push(r)}else for(var o=0;o<a;o++)this.sortBone(e[o]);this._updateCache.push(t);for(var s=0;s<a;s++)this.sortReset(e[s].children);for(var u=0;u<a;u++)e[u].sorted=!0}}},{key:"sortPathConstraintAttachment",value:function(t,e,a){var n=t.attachments[e];if(n)for(var r in n)this.sortPathConstraintAttachmentWith(n[r],a)}},{key:"sortPathConstraintAttachmentWith",value:function(t,e){if(t instanceof Ke){var a=t.bones;if(a==null)this.sortBone(e);else for(var n=this.bones,r=0;r<a.length;)for(var o=a[r++],s=r+o;r<s;r++){var u=a[r];this.sortBone(n[u])}}}},{key:"sortBone",value:function(t){if(!t.sorted){var e=t.parent;e!=null&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}}},{key:"sortReset",value:function(t){for(var e=0,a=t.length;e<a;e++){var n=t[e];n.active&&(n.sorted&&this.sortReset(n.children),n.sorted=!1)}}},{key:"updateWorldTransform",value:function(){for(var t=this.updateCacheReset,e=0,a=t.length;e<a;e++){var n=t[e];n.ax=n.x,n.ay=n.y,n.arotation=n.rotation,n.ascaleX=n.scaleX,n.ascaleY=n.scaleY,n.ashearX=n.shearX,n.ashearY=n.shearY,n.appliedValid=!0}for(var r=this._updateCache,o=0,s=r.length;o<s;o++)r[o].update()}},{key:"setToSetupPose",value:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}},{key:"setBonesToSetupPose",value:function(){for(var t=this.bones,e=0,a=t.length;e<a;e++)t[e].setToSetupPose();for(var n=this.ikConstraints,r=0,o=n.length;r<o;r++){var s=n[r];s.mix=s.data.mix,s.softness=s.data.softness,s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch}for(var u=this.transformConstraints,c=0,l=u.length;c<l;c++){var i=u[c],d=i.data;i.rotateMix=d.rotateMix,i.translateMix=d.translateMix,i.scaleMix=d.scaleMix,i.shearMix=d.shearMix}for(var f=this.pathConstraints,v=0,g=f.length;v<g;v++){var m=f[v],p=m.data;m.position=p.position,m.spacing=p.spacing,m.rotateMix=p.rotateMix,m.translateMix=p.translateMix}}},{key:"setSlotsToSetupPose",value:function(){var t=this.slots;Y.arrayCopy(t,0,this.drawOrder,0,t.length);for(var e=0,a=t.length;e<a;e++)t[e].setToSetupPose()}},{key:"getRootBone",value:function(){return this.bones.length==0?null:this.bones[0]}},{key:"findBone",value:function(t){if(t==null)throw new Error("boneName cannot be null.");for(var e=this.bones,a=0,n=e.length;a<n;a++){var r=e[a];if(r.data.name==t)return r}return null}},{key:"findBoneIndex",value:function(t){if(t==null)throw new Error("boneName cannot be null.");for(var e=this.bones,a=0,n=e.length;a<n;a++)if(e[a].data.name==t)return a;return-1}},{key:"findSlot",value:function(t){if(t==null)throw new Error("slotName cannot be null.");for(var e=this.slots,a=0,n=e.length;a<n;a++){var r=e[a];if(r.data.name==t)return r}return null}},{key:"findSlotIndex",value:function(t){if(t==null)throw new Error("slotName cannot be null.");for(var e=this.slots,a=0,n=e.length;a<n;a++)if(e[a].data.name==t)return a;return-1}},{key:"setSkinByName",value:function(t){var e=this.data.findSkin(t);if(e==null)throw new Error("Skin not found: "+t);this.setSkin(e)}},{key:"setSkin",value:function(t){if(t!=this.skin){if(t!=null)if(this.skin!=null)t.attachAll(this,this.skin);else for(var e=this.slots,a=0,n=e.length;a<n;a++){var r=e[a],o=r.data.attachmentName;if(o!=null){var s=t.getAttachment(a,o);s!=null&&r.setAttachment(s)}}this.skin=t,this.updateCache()}}},{key:"getAttachmentByName",value:function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)}},{key:"getAttachment",value:function(t,e){if(e==null)throw new Error("attachmentName cannot be null.");if(this.skin!=null){var a=this.skin.getAttachment(t,e);if(a!=null)return a}return this.data.defaultSkin!=null?this.data.defaultSkin.getAttachment(t,e):null}},{key:"setAttachment",value:function(t,e){if(t==null)throw new Error("slotName cannot be null.");for(var a=this.slots,n=0,r=a.length;n<r;n++){var o=a[n];if(o.data.name==t){var s=null;if(e!=null&&(s=this.getAttachment(n,e))==null)throw new Error("Attachment not found: "+e+", for slot: "+t);return void o.setAttachment(s)}}throw new Error("Slot not found: "+t)}},{key:"findIkConstraint",value:function(t){if(t==null)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,a=0,n=e.length;a<n;a++){var r=e[a];if(r.data.name==t)return r}return null}},{key:"findTransformConstraint",value:function(t){if(t==null)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,a=0,n=e.length;a<n;a++){var r=e[a];if(r.data.name==t)return r}return null}},{key:"findPathConstraint",value:function(t){if(t==null)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,a=0,n=e.length;a<n;a++){var r=e[a];if(r.data.name==t)return r}return null}},{key:"getBounds",value:function(t,e){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Array(2);if(t==null)throw new Error("offset cannot be null.");if(e==null)throw new Error("size cannot be null.");for(var n=this.drawOrder,r=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY,c=0,l=n.length;c<l;c++){var i=n[c];if(i.bone.active){var d=0,f=null,v=i.getAttachment();if(v instanceof at)d=8,f=Y.setArraySize(a,d,0),v.computeWorldVertices(i.bone,f,0,2);else if(v instanceof Ue){var g=v;d=g.worldVerticesLength,f=Y.setArraySize(a,d,0),g.computeWorldVertices(i,0,d,f,0,2)}if(f!=null)for(var m=0,p=f.length;m<p;m+=2){var y=f[m],w=f[m+1];r=Math.min(r,y),o=Math.min(o,w),s=Math.max(s,y),u=Math.max(u,w)}}}t.set(r,o),e.set(s-r,u-o)}},{key:"update",value:function(t){this.time+=t}}]),h}(),Et=function(){function h(t,e,a){if(D(this,h),this.name=void 0,this.timelines=void 0,this.timelineIds=void 0,this.duration=void 0,t==null)throw new Error("name cannot be null.");if(e==null)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(var n=0;n<e.length;n++)this.timelineIds[e[n].getPropertyId()]=!0;this.duration=a}return U(h,[{key:"hasTimeline",value:function(t){return this.timelineIds[t]==1}},{key:"apply",value:function(t,e,a,n,r,o,s,u){if(t==null)throw new Error("skeleton cannot be null.");n&&this.duration!=0&&(a%=this.duration,e>0&&(e%=this.duration));for(var c=this.timelines,l=0,i=c.length;l<i;l++)c[l].apply(t,e,a,r,o,s,u)}}],[{key:"binarySearch",value:function(t,e){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=0,r=t.length/a-2;if(r==0)return a;for(var o=r>>>1;;){if(t[(o+1)*a]<=e?n=o+1:r=o,n==r)return(n+1)*a;o=n+r>>>1}}},{key:"linearSearch",value:function(t,e,a){for(var n=0,r=t.length-a;n<=r;n+=a)if(t[n]>e)return n;return-1}}]),h}();(function(h){h[h.setup=0]="setup",h[h.first=1]="first",h[h.replace=2]="replace",h[h.add=3]="add"})(_||(_={})),function(h){h[h.mixIn=0]="mixIn",h[h.mixOut=1]="mixOut"}(It||(It={})),function(h){h[h.rotate=0]="rotate",h[h.translate=1]="translate",h[h.scale=2]="scale",h[h.shear=3]="shear",h[h.attachment=4]="attachment",h[h.color=5]="color",h[h.deform=6]="deform",h[h.event=7]="event",h[h.drawOrder=8]="drawOrder",h[h.ikConstraint=9]="ikConstraint",h[h.transformConstraint=10]="transformConstraint",h[h.pathConstraintPosition=11]="pathConstraintPosition",h[h.pathConstraintSpacing=12]="pathConstraintSpacing",h[h.pathConstraintMix=13]="pathConstraintMix",h[h.twoColor=14]="twoColor"}(St||(St={}));var Ct=function(){function h(t){if(D(this,h),this.curves=void 0,t<=0)throw new Error("frameCount must be > 0: "+t);this.curves=Y.newFloatArray((t-1)*h.BEZIER_SIZE)}return U(h,[{key:"getFrameCount",value:function(){return this.curves.length/h.BEZIER_SIZE+1}},{key:"setLinear",value:function(t){this.curves[t*h.BEZIER_SIZE]=h.LINEAR}},{key:"setStepped",value:function(t){this.curves[t*h.BEZIER_SIZE]=h.STEPPED}},{key:"getCurveType",value:function(t){var e=t*h.BEZIER_SIZE;if(e==this.curves.length)return h.LINEAR;var a=this.curves[e];return a==h.LINEAR?h.LINEAR:a==h.STEPPED?h.STEPPED:h.BEZIER}},{key:"setCurve",value:function(t,e,a,n,r){var o=.03*(2*-e+n),s=.03*(2*-a+r),u=.006*(3*(e-n)+1),c=.006*(3*(a-r)+1),l=2*o+u,i=2*s+c,d=.3*e+o+.16666667*u,f=.3*a+s+.16666667*c,v=t*h.BEZIER_SIZE,g=this.curves;g[v++]=h.BEZIER;for(var m=d,p=f,y=v+h.BEZIER_SIZE-1;v<y;v+=2)g[v]=m,g[v+1]=p,d+=l,f+=i,l+=u,i+=c,m+=d,p+=f}},{key:"getCurvePercent",value:function(t,e){e=P.clamp(e,0,1);var a=this.curves,n=t*h.BEZIER_SIZE,r=a[n];if(r==h.LINEAR)return e;if(r==h.STEPPED)return 0;for(var o=0,s=++n,u=n+h.BEZIER_SIZE-1;n<u;n+=2)if((o=a[n])>=e){var c=void 0,l=void 0;return n==s?(c=0,l=0):(c=a[n-2],l=a[n-1]),l+(a[n+1]-l)*(e-c)/(o-c)}var i=a[n-1];return i+(1-i)*(e-o)/(1-o)}}]),h}();Ct.LINEAR=0,Ct.STEPPED=1,Ct.BEZIER=2,Ct.BEZIER_SIZE=19;var At=function(h){vt(e,Ct);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a)).boneIndex=void 0,n.frames=void 0,n.frames=Y.newFloatArray(a<<1),n}return U(e,[{key:"getPropertyId",value:function(){return(St.rotate<<24)+this.boneIndex}},{key:"setFrame",value:function(a,n,r){a<<=1,this.frames[a]=n,this.frames[a+e.ROTATION]=r}},{key:"apply",value:function(a,n,r,o,s,u,c){var l=this.frames,i=a.bones[this.boneIndex];if(i.active)if(r<l[0])switch(u){case _.setup:return void(i.rotation=i.data.rotation);case _.first:var d=i.data.rotation-i.rotation;i.rotation+=(d-360*(16384-(16384.499999999996-d/360|0)))*s}else if(r>=l[l.length-e.ENTRIES]){var f=l[l.length+e.PREV_ROTATION];switch(u){case _.setup:i.rotation=i.data.rotation+f*s;break;case _.first:case _.replace:f+=i.data.rotation-i.rotation,f-=360*(16384-(16384.499999999996-f/360|0));case _.add:i.rotation+=f*s}}else{var v=Et.binarySearch(l,r,e.ENTRIES),g=l[v+e.PREV_ROTATION],m=l[v],p=this.getCurvePercent((v>>1)-1,1-(r-m)/(l[v+e.PREV_TIME]-m)),y=l[v+e.ROTATION]-g;switch(y=g+(y-360*(16384-(16384.499999999996-y/360|0)))*p,u){case _.setup:i.rotation=i.data.rotation+(y-360*(16384-(16384.499999999996-y/360|0)))*s;break;case _.first:case _.replace:y+=i.data.rotation-i.rotation;case _.add:i.rotation+=(y-360*(16384-(16384.499999999996-y/360|0)))*s}}}}]),e}();At.ENTRIES=2,At.PREV_TIME=-2,At.PREV_ROTATION=-1,At.ROTATION=1;var _t=function(h){vt(e,Ct);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a)).boneIndex=void 0,n.frames=void 0,n.frames=Y.newFloatArray(a*e.ENTRIES),n}return U(e,[{key:"getPropertyId",value:function(){return(St.translate<<24)+this.boneIndex}},{key:"setFrame",value:function(a,n,r,o){a*=e.ENTRIES,this.frames[a]=n,this.frames[a+e.X]=r,this.frames[a+e.Y]=o}},{key:"apply",value:function(a,n,r,o,s,u,c){var l=this.frames,i=a.bones[this.boneIndex];if(i.active)if(r<l[0])switch(u){case _.setup:return i.x=i.data.x,void(i.y=i.data.y);case _.first:i.x+=(i.data.x-i.x)*s,i.y+=(i.data.y-i.y)*s}else{var d=0,f=0;if(r>=l[l.length-e.ENTRIES])d=l[l.length+e.PREV_X],f=l[l.length+e.PREV_Y];else{var v=Et.binarySearch(l,r,e.ENTRIES);d=l[v+e.PREV_X],f=l[v+e.PREV_Y];var g=l[v],m=this.getCurvePercent(v/e.ENTRIES-1,1-(r-g)/(l[v+e.PREV_TIME]-g));d+=(l[v+e.X]-d)*m,f+=(l[v+e.Y]-f)*m}switch(u){case _.setup:i.x=i.data.x+d*s,i.y=i.data.y+f*s;break;case _.first:case _.replace:i.x+=(i.data.x+d-i.x)*s,i.y+=(i.data.y+f-i.y)*s;break;case _.add:i.x+=d*s,i.y+=f*s}}}}]),e}();_t.ENTRIES=3,_t.PREV_TIME=-3,_t.PREV_X=-2,_t.PREV_Y=-1,_t.X=1,_t.Y=2;var _a=function(h){vt(e,_t);var t=gt(e);function e(a){return D(this,e),t.call(this,a)}return U(e,[{key:"getPropertyId",value:function(){return(St.scale<<24)+this.boneIndex}},{key:"apply",value:function(a,n,r,o,s,u,c){var l=this.frames,i=a.bones[this.boneIndex];if(i.active)if(r<l[0])switch(u){case _.setup:return i.scaleX=i.data.scaleX,void(i.scaleY=i.data.scaleY);case _.first:i.scaleX+=(i.data.scaleX-i.scaleX)*s,i.scaleY+=(i.data.scaleY-i.scaleY)*s}else{var d=0,f=0;if(r>=l[l.length-e.ENTRIES])d=l[l.length+e.PREV_X]*i.data.scaleX,f=l[l.length+e.PREV_Y]*i.data.scaleY;else{var v=Et.binarySearch(l,r,e.ENTRIES);d=l[v+e.PREV_X],f=l[v+e.PREV_Y];var g=l[v],m=this.getCurvePercent(v/e.ENTRIES-1,1-(r-g)/(l[v+e.PREV_TIME]-g));d=(d+(l[v+e.X]-d)*m)*i.data.scaleX,f=(f+(l[v+e.Y]-f)*m)*i.data.scaleY}if(s==1)u==_.add?(i.scaleX+=d-i.data.scaleX,i.scaleY+=f-i.data.scaleY):(i.scaleX=d,i.scaleY=f);else{var p=0,y=0;if(c==It.mixOut)switch(u){case _.setup:p=i.data.scaleX,y=i.data.scaleY,i.scaleX=p+(Math.abs(d)*P.signum(p)-p)*s,i.scaleY=y+(Math.abs(f)*P.signum(y)-y)*s;break;case _.first:case _.replace:p=i.scaleX,y=i.scaleY,i.scaleX=p+(Math.abs(d)*P.signum(p)-p)*s,i.scaleY=y+(Math.abs(f)*P.signum(y)-y)*s;break;case _.add:p=i.scaleX,y=i.scaleY,i.scaleX=p+(Math.abs(d)*P.signum(p)-i.data.scaleX)*s,i.scaleY=y+(Math.abs(f)*P.signum(y)-i.data.scaleY)*s}else switch(u){case _.setup:p=Math.abs(i.data.scaleX)*P.signum(d),y=Math.abs(i.data.scaleY)*P.signum(f),i.scaleX=p+(d-p)*s,i.scaleY=y+(f-y)*s;break;case _.first:case _.replace:p=Math.abs(i.scaleX)*P.signum(d),y=Math.abs(i.scaleY)*P.signum(f),i.scaleX=p+(d-p)*s,i.scaleY=y+(f-y)*s;break;case _.add:p=P.signum(d),y=P.signum(f),i.scaleX=Math.abs(i.scaleX)*p+(d-Math.abs(i.data.scaleX)*p)*s,i.scaleY=Math.abs(i.scaleY)*y+(f-Math.abs(i.data.scaleY)*y)*s}}}}}]),e}(),Va=function(h){vt(e,_t);var t=gt(e);function e(a){return D(this,e),t.call(this,a)}return U(e,[{key:"getPropertyId",value:function(){return(St.shear<<24)+this.boneIndex}},{key:"apply",value:function(a,n,r,o,s,u,c){var l=this.frames,i=a.bones[this.boneIndex];if(i.active)if(r<l[0])switch(u){case _.setup:return i.shearX=i.data.shearX,void(i.shearY=i.data.shearY);case _.first:i.shearX+=(i.data.shearX-i.shearX)*s,i.shearY+=(i.data.shearY-i.shearY)*s}else{var d=0,f=0;if(r>=l[l.length-e.ENTRIES])d=l[l.length+e.PREV_X],f=l[l.length+e.PREV_Y];else{var v=Et.binarySearch(l,r,e.ENTRIES);d=l[v+e.PREV_X],f=l[v+e.PREV_Y];var g=l[v],m=this.getCurvePercent(v/e.ENTRIES-1,1-(r-g)/(l[v+e.PREV_TIME]-g));d+=(l[v+e.X]-d)*m,f+=(l[v+e.Y]-f)*m}switch(u){case _.setup:i.shearX=i.data.shearX+d*s,i.shearY=i.data.shearY+f*s;break;case _.first:case _.replace:i.shearX+=(i.data.shearX+d-i.shearX)*s,i.shearY+=(i.data.shearY+f-i.shearY)*s;break;case _.add:i.shearX+=d*s,i.shearY+=f*s}}}}]),e}(),Pt=function(h){vt(e,Ct);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a)).slotIndex=void 0,n.frames=void 0,n.frames=Y.newFloatArray(a*e.ENTRIES),n}return U(e,[{key:"getPropertyId",value:function(){return(St.color<<24)+this.slotIndex}},{key:"setFrame",value:function(a,n,r,o,s,u){a*=e.ENTRIES,this.frames[a]=n,this.frames[a+e.R]=r,this.frames[a+e.G]=o,this.frames[a+e.B]=s,this.frames[a+e.A]=u}},{key:"apply",value:function(a,n,r,o,s,u,c){var l=a.slots[this.slotIndex];if(l.bone.active){var i=this.frames;if(r<i[0])switch(u){case _.setup:return void l.color.setFromColor(l.data.color);case _.first:var d=l.color,f=l.data.color;d.add((f.r-d.r)*s,(f.g-d.g)*s,(f.b-d.b)*s,(f.a-d.a)*s)}else{var v=0,g=0,m=0,p=0;if(r>=i[i.length-e.ENTRIES]){var y=i.length;v=i[y+e.PREV_R],g=i[y+e.PREV_G],m=i[y+e.PREV_B],p=i[y+e.PREV_A]}else{var w=Et.binarySearch(i,r,e.ENTRIES);v=i[w+e.PREV_R],g=i[w+e.PREV_G],m=i[w+e.PREV_B],p=i[w+e.PREV_A];var k=i[w],M=this.getCurvePercent(w/e.ENTRIES-1,1-(r-k)/(i[w+e.PREV_TIME]-k));v+=(i[w+e.R]-v)*M,g+=(i[w+e.G]-g)*M,m+=(i[w+e.B]-m)*M,p+=(i[w+e.A]-p)*M}if(s==1)l.color.set(v,g,m,p);else{var E=l.color;u==_.setup&&E.setFromColor(l.data.color),E.add((v-E.r)*s,(g-E.g)*s,(m-E.b)*s,(p-E.a)*s)}}}}}]),e}();Pt.ENTRIES=5,Pt.PREV_TIME=-5,Pt.PREV_R=-4,Pt.PREV_G=-3,Pt.PREV_B=-2,Pt.PREV_A=-1,Pt.R=1,Pt.G=2,Pt.B=3,Pt.A=4;var xt=function(h){vt(e,Ct);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a)).slotIndex=void 0,n.frames=void 0,n.frames=Y.newFloatArray(a*e.ENTRIES),n}return U(e,[{key:"getPropertyId",value:function(){return(St.twoColor<<24)+this.slotIndex}},{key:"setFrame",value:function(a,n,r,o,s,u,c,l,i){a*=e.ENTRIES,this.frames[a]=n,this.frames[a+e.R]=r,this.frames[a+e.G]=o,this.frames[a+e.B]=s,this.frames[a+e.A]=u,this.frames[a+e.R2]=c,this.frames[a+e.G2]=l,this.frames[a+e.B2]=i}},{key:"apply",value:function(a,n,r,o,s,u,c){var l=a.slots[this.slotIndex];if(l.bone.active){var i=this.frames;if(r<i[0])switch(u){case _.setup:return l.color.setFromColor(l.data.color),void l.darkColor.setFromColor(l.data.darkColor);case _.first:var d=l.color,f=l.darkColor,v=l.data.color,g=l.data.darkColor;d.add((v.r-d.r)*s,(v.g-d.g)*s,(v.b-d.b)*s,(v.a-d.a)*s),f.add((g.r-f.r)*s,(g.g-f.g)*s,(g.b-f.b)*s,0)}else{var m=0,p=0,y=0,w=0,k=0,M=0,E=0;if(r>=i[i.length-e.ENTRIES]){var A=i.length;m=i[A+e.PREV_R],p=i[A+e.PREV_G],y=i[A+e.PREV_B],w=i[A+e.PREV_A],k=i[A+e.PREV_R2],M=i[A+e.PREV_G2],E=i[A+e.PREV_B2]}else{var S=Et.binarySearch(i,r,e.ENTRIES);m=i[S+e.PREV_R],p=i[S+e.PREV_G],y=i[S+e.PREV_B],w=i[S+e.PREV_A],k=i[S+e.PREV_R2],M=i[S+e.PREV_G2],E=i[S+e.PREV_B2];var C=i[S],R=this.getCurvePercent(S/e.ENTRIES-1,1-(r-C)/(i[S+e.PREV_TIME]-C));m+=(i[S+e.R]-m)*R,p+=(i[S+e.G]-p)*R,y+=(i[S+e.B]-y)*R,w+=(i[S+e.A]-w)*R,k+=(i[S+e.R2]-k)*R,M+=(i[S+e.G2]-M)*R,E+=(i[S+e.B2]-E)*R}if(s==1)l.color.set(m,p,y,w),l.darkColor.set(k,M,E,1);else{var I=l.color,T=l.darkColor;u==_.setup&&(I.setFromColor(l.data.color),T.setFromColor(l.data.darkColor)),I.add((m-I.r)*s,(p-I.g)*s,(y-I.b)*s,(w-I.a)*s),T.add((k-T.r)*s,(M-T.g)*s,(E-T.b)*s,0)}}}}}]),e}();xt.ENTRIES=8,xt.PREV_TIME=-8,xt.PREV_R=-7,xt.PREV_G=-6,xt.PREV_B=-5,xt.PREV_A=-4,xt.PREV_R2=-3,xt.PREV_G2=-2,xt.PREV_B2=-1,xt.R=1,xt.G=2,xt.B=3,xt.A=4,xt.R2=5,xt.G2=6,xt.B2=7;var Le=function(){function h(t){D(this,h),this.slotIndex=void 0,this.frames=void 0,this.attachmentNames=void 0,this.frames=Y.newFloatArray(t),this.attachmentNames=new Array(t)}return U(h,[{key:"getPropertyId",value:function(){return(St.attachment<<24)+this.slotIndex}},{key:"getFrameCount",value:function(){return this.frames.length}},{key:"setFrame",value:function(t,e,a){this.frames[t]=e,this.attachmentNames[t]=a}},{key:"apply",value:function(t,e,a,n,r,o,s){var u=t.slots[this.slotIndex];if(u.bone.active)if(s!=It.mixOut){var c=this.frames;if(a<c[0])o!=_.setup&&o!=_.first||this.setAttachment(t,u,u.data.attachmentName);else{var l=0;l=a>=c[c.length-1]?c.length-1:Et.binarySearch(c,a,1)-1;var i=this.attachmentNames[l];t.slots[this.slotIndex].setAttachment(i==null?null:t.getAttachment(this.slotIndex,i))}}else o==_.setup&&this.setAttachment(t,u,u.data.attachmentName)}},{key:"setAttachment",value:function(t,e,a){e.attachment=a==null?null:t.getAttachment(this.slotIndex,a)}}]),h}(),ya=null,Na=function(h){vt(e,Ct);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a)).slotIndex=void 0,n.attachment=void 0,n.frames=void 0,n.frameVertices=void 0,n.frames=Y.newFloatArray(a),n.frameVertices=new Array(a),ya==null&&(ya=Y.newFloatArray(64)),n}return U(e,[{key:"getPropertyId",value:function(){return(St.deform<<27)+ +this.attachment.id+this.slotIndex}},{key:"setFrame",value:function(a,n,r){this.frames[a]=n,this.frameVertices[a]=r}},{key:"apply",value:function(a,n,r,o,s,u,c){var l=a.slots[this.slotIndex];if(l.bone.active){var i=l.getAttachment();if(i instanceof Me&&i.deformAttachment==this.attachment){var d=l.deform;d.length==0&&(u=_.setup);var f=this.frameVertices,v=f[0].length,g=this.frames;if(r<g[0]){var m=i;switch(u){case _.setup:return void(d.length=0);case _.first:if(s==1){d.length=0;break}var p=Y.setArraySize(d,v);if(m.bones==null)for(var y=m.vertices,w=0;w<v;w++)p[w]+=(y[w]-p[w])*s;else for(s=1-s,w=0;w<v;w++)p[w]*=s}}else{var k=Y.setArraySize(d,v);if(r>=g[g.length-1]){var M=f[g.length-1];if(s==1)if(u==_.add){var E=i;if(E.bones==null)for(var A=E.vertices,S=0;S<v;S++)k[S]+=M[S]-A[S];else for(var C=0;C<v;C++)k[C]+=M[C]}else Y.arrayCopy(M,0,k,0,v);else switch(u){case _.setup:var R=i;if(R.bones==null)for(var I=R.vertices,T=0;T<v;T++){var B=I[T];k[T]=B+(M[T]-B)*s}else for(var N=0;N<v;N++)k[N]=M[N]*s;break;case _.first:case _.replace:for(var x=0;x<v;x++)k[x]+=(M[x]-k[x])*s;break;case _.add:var b=i;if(b.bones==null)for(var H=b.vertices,V=0;V<v;V++)k[V]+=(M[V]-H[V])*s;else for(var F=0;F<v;F++)k[F]+=M[F]*s}}else{var L=Et.binarySearch(g,r),G=f[L-1],j=f[L],z=g[L],q=this.getCurvePercent(L-1,1-(r-z)/(g[L-1]-z));if(s==1)if(u==_.add){var O=i;if(O.bones==null)for(var X=O.vertices,Q=0;Q<v;Q++){var rt=G[Q];k[Q]+=rt+(j[Q]-rt)*q-X[Q]}else for(var J=0;J<v;J++){var tt=G[J];k[J]+=tt+(j[J]-tt)*q}}else for(var W=0;W<v;W++){var K=G[W];k[W]=K+(j[W]-K)*q}else switch(u){case _.setup:var Z=i;if(Z.bones==null)for(var it=Z.vertices,et=0;et<v;et++){var ht=G[et],ot=it[et];k[et]=ot+(ht+(j[et]-ht)*q-ot)*s}else for(var lt=0;lt<v;lt++){var ut=G[lt];k[lt]=(ut+(j[lt]-ut)*q)*s}break;case _.first:case _.replace:for(var $=0;$<v;$++){var ft=G[$];k[$]+=(ft+(j[$]-ft)*q-k[$])*s}break;case _.add:var st=i;if(st.bones==null)for(var yt=st.vertices,dt=0;dt<v;dt++){var mt=G[dt];k[dt]+=(mt+(j[dt]-mt)*q-yt[dt])*s}else for(var ct=0;ct<v;ct++){var kt=G[ct];k[ct]+=(kt+(j[ct]-kt)*q)*s}}}}}}}}]),e}(),ca=function(){function h(t){D(this,h),this.frames=void 0,this.events=void 0,this.frames=Y.newFloatArray(t),this.events=new Array(t)}return U(h,[{key:"getPropertyId",value:function(){return St.event<<24}},{key:"getFrameCount",value:function(){return this.frames.length}},{key:"setFrame",value:function(t,e){this.frames[t]=e.time,this.events[t]=e}},{key:"apply",value:function(t,e,a,n,r,o,s){if(n!=null){var u=this.frames,c=this.frames.length;if(e>a)this.apply(t,e,Number.MAX_VALUE,n,r,o,s),e=-1;else if(e>=u[c-1])return;if(!(a<u[0])){var l=0;if(e<u[0])l=0;else for(var i=u[l=Et.binarySearch(u,e)];l>0&&u[l-1]==i;)l--;for(;l<c&&a>=u[l];l++)n.push(this.events[l])}}}}]),h}(),De=function(){function h(t){D(this,h),this.frames=void 0,this.drawOrders=void 0,this.frames=Y.newFloatArray(t),this.drawOrders=new Array(t)}return U(h,[{key:"getPropertyId",value:function(){return St.drawOrder<<24}},{key:"getFrameCount",value:function(){return this.frames.length}},{key:"setFrame",value:function(t,e,a){this.frames[t]=e,this.drawOrders[t]=a}},{key:"apply",value:function(t,e,a,n,r,o,s){var u=t.drawOrder,c=t.slots;if(s!=It.mixOut){var l=this.frames;if(a<l[0])o!=_.setup&&o!=_.first||Y.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);else{var i=0;i=a>=l[l.length-1]?l.length-1:Et.binarySearch(l,a)-1;var d=this.drawOrders[i];if(d==null)Y.arrayCopy(c,0,u,0,c.length);else for(var f=0,v=d.length;f<v;f++)u[f]=c[d[f]]}}else o==_.setup&&Y.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)}}]),h}(),Mt=function(h){vt(e,Ct);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a)).ikConstraintIndex=void 0,n.frames=void 0,n.frames=Y.newFloatArray(a*e.ENTRIES),n}return U(e,[{key:"getPropertyId",value:function(){return(St.ikConstraint<<24)+this.ikConstraintIndex}},{key:"setFrame",value:function(a,n,r,o,s,u,c){a*=e.ENTRIES,this.frames[a]=n,this.frames[a+e.MIX]=r,this.frames[a+e.SOFTNESS]=o,this.frames[a+e.BEND_DIRECTION]=s,this.frames[a+e.COMPRESS]=u?1:0,this.frames[a+e.STRETCH]=c?1:0}},{key:"apply",value:function(a,n,r,o,s,u,c){var l=this.frames,i=a.ikConstraints[this.ikConstraintIndex];if(i.active)if(r<l[0])switch(u){case _.setup:return i.mix=i.data.mix,i.softness=i.data.softness,i.bendDirection=i.data.bendDirection,i.compress=i.data.compress,void(i.stretch=i.data.stretch);case _.first:i.mix+=(i.data.mix-i.mix)*s,i.softness+=(i.data.softness-i.softness)*s,i.bendDirection=i.data.bendDirection,i.compress=i.data.compress,i.stretch=i.data.stretch}else if(r>=l[l.length-e.ENTRIES])u==_.setup?(i.mix=i.data.mix+(l[l.length+e.PREV_MIX]-i.data.mix)*s,i.softness=i.data.softness+(l[l.length+e.PREV_SOFTNESS]-i.data.softness)*s,c==It.mixOut?(i.bendDirection=i.data.bendDirection,i.compress=i.data.compress,i.stretch=i.data.stretch):(i.bendDirection=l[l.length+e.PREV_BEND_DIRECTION],i.compress=l[l.length+e.PREV_COMPRESS]!=0,i.stretch=l[l.length+e.PREV_STRETCH]!=0)):(i.mix+=(l[l.length+e.PREV_MIX]-i.mix)*s,i.softness+=(l[l.length+e.PREV_SOFTNESS]-i.softness)*s,c==It.mixIn&&(i.bendDirection=l[l.length+e.PREV_BEND_DIRECTION],i.compress=l[l.length+e.PREV_COMPRESS]!=0,i.stretch=l[l.length+e.PREV_STRETCH]!=0));else{var d=Et.binarySearch(l,r,e.ENTRIES),f=l[d+e.PREV_MIX],v=l[d+e.PREV_SOFTNESS],g=l[d],m=this.getCurvePercent(d/e.ENTRIES-1,1-(r-g)/(l[d+e.PREV_TIME]-g));u==_.setup?(i.mix=i.data.mix+(f+(l[d+e.MIX]-f)*m-i.data.mix)*s,i.softness=i.data.softness+(v+(l[d+e.SOFTNESS]-v)*m-i.data.softness)*s,c==It.mixOut?(i.bendDirection=i.data.bendDirection,i.compress=i.data.compress,i.stretch=i.data.stretch):(i.bendDirection=l[d+e.PREV_BEND_DIRECTION],i.compress=l[d+e.PREV_COMPRESS]!=0,i.stretch=l[d+e.PREV_STRETCH]!=0)):(i.mix+=(f+(l[d+e.MIX]-f)*m-i.mix)*s,i.softness+=(v+(l[d+e.SOFTNESS]-v)*m-i.softness)*s,c==It.mixIn&&(i.bendDirection=l[d+e.PREV_BEND_DIRECTION],i.compress=l[d+e.PREV_COMPRESS]!=0,i.stretch=l[d+e.PREV_STRETCH]!=0))}}}]),e}();Mt.ENTRIES=6,Mt.PREV_TIME=-6,Mt.PREV_MIX=-5,Mt.PREV_SOFTNESS=-4,Mt.PREV_BEND_DIRECTION=-3,Mt.PREV_COMPRESS=-2,Mt.PREV_STRETCH=-1,Mt.MIX=1,Mt.SOFTNESS=2,Mt.BEND_DIRECTION=3,Mt.COMPRESS=4,Mt.STRETCH=5;var Ft=function(h){vt(e,Ct);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a)).transformConstraintIndex=void 0,n.frames=void 0,n.frames=Y.newFloatArray(a*e.ENTRIES),n}return U(e,[{key:"getPropertyId",value:function(){return(St.transformConstraint<<24)+this.transformConstraintIndex}},{key:"setFrame",value:function(a,n,r,o,s,u){a*=e.ENTRIES,this.frames[a]=n,this.frames[a+e.ROTATE]=r,this.frames[a+e.TRANSLATE]=o,this.frames[a+e.SCALE]=s,this.frames[a+e.SHEAR]=u}},{key:"apply",value:function(a,n,r,o,s,u,c){var l=this.frames,i=a.transformConstraints[this.transformConstraintIndex];if(i.active)if(r<l[0]){var d=i.data;switch(u){case _.setup:return i.rotateMix=d.rotateMix,i.translateMix=d.translateMix,i.scaleMix=d.scaleMix,void(i.shearMix=d.shearMix);case _.first:i.rotateMix+=(d.rotateMix-i.rotateMix)*s,i.translateMix+=(d.translateMix-i.translateMix)*s,i.scaleMix+=(d.scaleMix-i.scaleMix)*s,i.shearMix+=(d.shearMix-i.shearMix)*s}}else{var f=0,v=0,g=0,m=0;if(r>=l[l.length-e.ENTRIES]){var p=l.length;f=l[p+e.PREV_ROTATE],v=l[p+e.PREV_TRANSLATE],g=l[p+e.PREV_SCALE],m=l[p+e.PREV_SHEAR]}else{var y=Et.binarySearch(l,r,e.ENTRIES);f=l[y+e.PREV_ROTATE],v=l[y+e.PREV_TRANSLATE],g=l[y+e.PREV_SCALE],m=l[y+e.PREV_SHEAR];var w=l[y],k=this.getCurvePercent(y/e.ENTRIES-1,1-(r-w)/(l[y+e.PREV_TIME]-w));f+=(l[y+e.ROTATE]-f)*k,v+=(l[y+e.TRANSLATE]-v)*k,g+=(l[y+e.SCALE]-g)*k,m+=(l[y+e.SHEAR]-m)*k}if(u==_.setup){var M=i.data;i.rotateMix=M.rotateMix+(f-M.rotateMix)*s,i.translateMix=M.translateMix+(v-M.translateMix)*s,i.scaleMix=M.scaleMix+(g-M.scaleMix)*s,i.shearMix=M.shearMix+(m-M.shearMix)*s}else i.rotateMix+=(f-i.rotateMix)*s,i.translateMix+=(v-i.translateMix)*s,i.scaleMix+=(g-i.scaleMix)*s,i.shearMix+=(m-i.shearMix)*s}}}]),e}();Ft.ENTRIES=5,Ft.PREV_TIME=-5,Ft.PREV_ROTATE=-4,Ft.PREV_TRANSLATE=-3,Ft.PREV_SCALE=-2,Ft.PREV_SHEAR=-1,Ft.ROTATE=1,Ft.TRANSLATE=2,Ft.SCALE=3,Ft.SHEAR=4;var te=function(h){vt(e,Ct);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a)).pathConstraintIndex=void 0,n.frames=void 0,n.frames=Y.newFloatArray(a*e.ENTRIES),n}return U(e,[{key:"getPropertyId",value:function(){return(St.pathConstraintPosition<<24)+this.pathConstraintIndex}},{key:"setFrame",value:function(a,n,r){a*=e.ENTRIES,this.frames[a]=n,this.frames[a+e.VALUE]=r}},{key:"apply",value:function(a,n,r,o,s,u,c){var l=this.frames,i=a.pathConstraints[this.pathConstraintIndex];if(i.active)if(r<l[0])switch(u){case _.setup:return void(i.position=i.data.position);case _.first:i.position+=(i.data.position-i.position)*s}else{var d=0;if(r>=l[l.length-e.ENTRIES])d=l[l.length+e.PREV_VALUE];else{var f=Et.binarySearch(l,r,e.ENTRIES);d=l[f+e.PREV_VALUE];var v=l[f],g=this.getCurvePercent(f/e.ENTRIES-1,1-(r-v)/(l[f+e.PREV_TIME]-v));d+=(l[f+e.VALUE]-d)*g}u==_.setup?i.position=i.data.position+(d-i.data.position)*s:i.position+=(d-i.position)*s}}}]),e}();te.ENTRIES=2,te.PREV_TIME=-2,te.PREV_VALUE=-1,te.VALUE=1;var La=function(h){vt(e,te);var t=gt(e);function e(a){return D(this,e),t.call(this,a)}return U(e,[{key:"getPropertyId",value:function(){return(St.pathConstraintSpacing<<24)+this.pathConstraintIndex}},{key:"apply",value:function(a,n,r,o,s,u,c){var l=this.frames,i=a.pathConstraints[this.pathConstraintIndex];if(i.active)if(r<l[0])switch(u){case _.setup:return void(i.spacing=i.data.spacing);case _.first:i.spacing+=(i.data.spacing-i.spacing)*s}else{var d=0;if(r>=l[l.length-e.ENTRIES])d=l[l.length+e.PREV_VALUE];else{var f=Et.binarySearch(l,r,e.ENTRIES);d=l[f+e.PREV_VALUE];var v=l[f],g=this.getCurvePercent(f/e.ENTRIES-1,1-(r-v)/(l[f+e.PREV_TIME]-v));d+=(l[f+e.VALUE]-d)*g}u==_.setup?i.spacing=i.data.spacing+(d-i.data.spacing)*s:i.spacing+=(d-i.spacing)*s}}}]),e}(),Wt=function(h){vt(e,Ct);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a)).pathConstraintIndex=void 0,n.frames=void 0,n.frames=Y.newFloatArray(a*e.ENTRIES),n}return U(e,[{key:"getPropertyId",value:function(){return(St.pathConstraintMix<<24)+this.pathConstraintIndex}},{key:"setFrame",value:function(a,n,r,o){a*=e.ENTRIES,this.frames[a]=n,this.frames[a+e.ROTATE]=r,this.frames[a+e.TRANSLATE]=o}},{key:"apply",value:function(a,n,r,o,s,u,c){var l=this.frames,i=a.pathConstraints[this.pathConstraintIndex];if(i.active)if(r<l[0])switch(u){case _.setup:return i.rotateMix=i.data.rotateMix,void(i.translateMix=i.data.translateMix);case _.first:i.rotateMix+=(i.data.rotateMix-i.rotateMix)*s,i.translateMix+=(i.data.translateMix-i.translateMix)*s}else{var d=0,f=0;if(r>=l[l.length-e.ENTRIES])d=l[l.length+e.PREV_ROTATE],f=l[l.length+e.PREV_TRANSLATE];else{var v=Et.binarySearch(l,r,e.ENTRIES);d=l[v+e.PREV_ROTATE],f=l[v+e.PREV_TRANSLATE];var g=l[v],m=this.getCurvePercent(v/e.ENTRIES-1,1-(r-g)/(l[v+e.PREV_TIME]-g));d+=(l[v+e.ROTATE]-d)*m,f+=(l[v+e.TRANSLATE]-f)*m}u==_.setup?(i.rotateMix=i.data.rotateMix+(d-i.data.rotateMix)*s,i.translateMix=i.data.translateMix+(f-i.data.translateMix)*s):(i.rotateMix+=(d-i.rotateMix)*s,i.translateMix+=(f-i.translateMix)*s)}}}]),e}();Wt.ENTRIES=3,Wt.PREV_TIME=-3,Wt.PREV_ROTATE=-2,Wt.PREV_TRANSLATE=-1,Wt.ROTATE=1,Wt.TRANSLATE=2;var Jt=function(){function h(t){D(this,h),this.data=void 0,this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new dn(this),this.propertyIDs=new tn,this.animationsChanged=!1,this.trackEntryPool=new oa(function(){return new un}),this.data=t}return U(h,[{key:"update",value:function(t){t*=this.timeScale;for(var e=this.tracks,a=0,n=e.length;a<n;a++){var r=e[a];if(r!=null){r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast;var o=t*r.timeScale;if(r.delay>0){if(r.delay-=o,r.delay>0)continue;o=-r.delay,r.delay=0}var s=r.next;if(s!=null){var u=r.trackLast-s.delay;if(u>=0){for(s.delay=0,s.trackTime+=r.timeScale==0?0:(u/r.timeScale+t)*s.timeScale,r.trackTime+=o,this.setCurrent(a,s,!0);s.mixingFrom!=null;)s.mixTime+=t,s=s.mixingFrom;continue}}else if(r.trackLast>=r.trackEnd&&r.mixingFrom==null){e[a]=null,this.queue.end(r),this.disposeNext(r);continue}if(r.mixingFrom!=null&&this.updateMixingFrom(r,t)){var c=r.mixingFrom;for(r.mixingFrom=null,c!=null&&(c.mixingTo=null);c!=null;)this.queue.end(c),c=c.mixingFrom}r.trackTime+=o}}this.queue.drain()}},{key:"updateMixingFrom",value:function(t,e){var a=t.mixingFrom;if(a==null)return!0;var n=this.updateMixingFrom(a,e);return a.animationLast=a.nextAnimationLast,a.trackLast=a.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(a.totalAlpha!=0&&t.mixDuration!=0||(t.mixingFrom=a.mixingFrom,a.mixingFrom!=null&&(a.mixingFrom.mixingTo=t),t.interruptAlpha=a.interruptAlpha,this.queue.end(a)),n):(a.trackTime+=e*a.timeScale,t.mixTime+=e,!1)}},{key:"apply",value:function(t){if(t==null)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var e=this.events,a=this.tracks,n=!1,r=0,o=a.length;r<o;r++){var s=a[r];if(!(s==null||s.delay>0)){n=!0;var u=r==0?_.first:s.mixBlend,c=s.alpha;s.mixingFrom!=null?c*=this.applyMixingFrom(s,t,u):s.trackTime>=s.trackEnd&&s.next==null&&(c=0);var l=s.animationLast,i=s.getAnimationTime(),d=s.animation.timelines.length,f=s.animation.timelines;if(r==0&&c==1||u==_.add)for(var v=0;v<d;v++){Y.webkit602BugfixHelper(c,u);var g=f[v];g instanceof Le?this.applyAttachmentTimeline(g,t,i,u,!0):g.apply(t,l,i,e,c,u,It.mixIn)}else{var m=s.timelineMode,p=s.timelinesRotation.length==0;p&&Y.setArraySize(s.timelinesRotation,d<<1,null);for(var y=s.timelinesRotation,w=0;w<d;w++){var k=f[w],M=m[w]==h.SUBSEQUENT?u:_.setup;k instanceof At?this.applyRotateTimeline(k,t,i,c,M,y,w<<1,p):k instanceof Le?this.applyAttachmentTimeline(k,t,i,u,!0):(Y.webkit602BugfixHelper(c,u),k.apply(t,l,i,e,c,M,It.mixIn))}}this.queueEvents(s,i),e.length=0,s.nextAnimationLast=i,s.nextTrackLast=s.trackTime}}for(var E=this.unkeyedState+h.SETUP,A=t.slots,S=0,C=t.slots.length;S<C;S++){var R=A[S];if(R.attachmentState==E){var I=R.data.attachmentName;R.attachment=I==null?null:t.getAttachment(R.data.index,I)}}return this.unkeyedState+=2,this.queue.drain(),n}},{key:"applyMixingFrom",value:function(t,e,a){var n=t.mixingFrom;n.mixingFrom!=null&&this.applyMixingFrom(n,e,a);var r=0;t.mixDuration==0?(r=1,a==_.first&&(a=_.setup)):((r=t.mixTime/t.mixDuration)>1&&(r=1),a!=_.first&&(a=n.mixBlend));var o=r<n.eventThreshold?this.events:null,s=r<n.attachmentThreshold,u=r<n.drawOrderThreshold,c=n.animationLast,l=n.getAnimationTime(),i=n.animation.timelines.length,d=n.animation.timelines,f=n.alpha*t.interruptAlpha,v=f*(1-r);if(a==_.add)for(var g=0;g<i;g++)d[g].apply(e,c,l,o,v,a,It.mixOut);else{var m=n.timelineMode,p=n.timelineHoldMix,y=n.timelinesRotation.length==0;y&&Y.setArraySize(n.timelinesRotation,i<<1,null);var w=n.timelinesRotation;n.totalAlpha=0;for(var k=0;k<i;k++){var M=d[k],E=It.mixOut,A=void 0,S=0;switch(m[k]){case h.SUBSEQUENT:if(!u&&M instanceof De)continue;A=a,S=v;break;case h.FIRST:A=_.setup,S=v;break;case h.HOLD_SUBSEQUENT:A=a,S=f;break;case h.HOLD_FIRST:A=_.setup,S=f;break;default:A=_.setup;var C=p[k];S=f*Math.max(0,1-C.mixTime/C.mixDuration)}n.totalAlpha+=S,M instanceof At?this.applyRotateTimeline(M,e,l,S,A,w,k<<1,y):M instanceof Le?this.applyAttachmentTimeline(M,e,l,A,s):(Y.webkit602BugfixHelper(S,a),u&&M instanceof De&&A==_.setup&&(E=It.mixIn),M.apply(e,c,l,o,S,A,E))}}return t.mixDuration>0&&this.queueEvents(n,l),this.events.length=0,n.nextAnimationLast=l,n.nextTrackLast=n.trackTime,r}},{key:"applyAttachmentTimeline",value:function(t,e,a,n,r){var o=e.slots[t.slotIndex];if(o.bone.active){var s,u=t.frames;a<u[0]?n!=_.setup&&n!=_.first||this.setAttachment(e,o,o.data.attachmentName,r):(s=a>=u[u.length-1]?u.length-1:Et.binarySearch(u,a)-1,this.setAttachment(e,o,t.attachmentNames[s],r)),o.attachmentState<=this.unkeyedState&&(o.attachmentState=this.unkeyedState+h.SETUP)}}},{key:"setAttachment",value:function(t,e,a,n){e.attachment=a==null?null:t.getAttachment(e.data.index,a),n&&(e.attachmentState=this.unkeyedState+h.CURRENT)}},{key:"applyRotateTimeline",value:function(t,e,a,n,r,o,s,u){if(u&&(o[s]=0),n!=1){var c=t,l=c.frames,i=e.bones[c.boneIndex];if(i.active){var d=0,f=0;if(a<l[0])switch(r){case _.setup:i.rotation=i.data.rotation;default:return;case _.first:d=i.rotation,f=i.data.rotation}else if(d=r==_.setup?i.data.rotation:i.rotation,a>=l[l.length-At.ENTRIES])f=i.data.rotation+l[l.length+At.PREV_ROTATION];else{var v=Et.binarySearch(l,a,At.ENTRIES),g=l[v+At.PREV_ROTATION],m=l[v],p=c.getCurvePercent((v>>1)-1,1-(a-m)/(l[v+At.PREV_TIME]-m));f=l[v+At.ROTATION]-g,f=g+(f-=360*(16384-(16384.499999999996-f/360|0)))*p+i.data.rotation,f-=360*(16384-(16384.499999999996-f/360|0))}var y=0,w=f-d;if((w-=360*(16384-(16384.499999999996-w/360|0)))==0)y=o[s];else{var k=0,M=0;u?(k=0,M=w):(k=o[s],M=o[s+1]);var E=w>0,A=k>=0;P.signum(M)!=P.signum(w)&&Math.abs(M)<=90&&(Math.abs(k)>180&&(k+=360*P.signum(k)),A=E),y=w+k-k%360,A!=E&&(y+=360*P.signum(k)),o[s]=y}o[s+1]=w,d+=y*n,i.rotation=d-360*(16384-(16384.499999999996-d/360|0))}}else t.apply(e,0,a,null,1,r,It.mixIn)}},{key:"queueEvents",value:function(t,e){for(var a=t.animationStart,n=t.animationEnd,r=n-a,o=t.trackLast%r,s=this.events,u=0,c=s.length;u<c;u++){var l=s[u];if(l.time<o)break;l.time>n||this.queue.event(t,l)}for((t.loop?r==0||o>t.trackTime%r:e>=n&&t.animationLast<n)&&this.queue.complete(t);u<c;u++)s[u].time<a||this.queue.event(t,s[u])}},{key:"clearTracks",value:function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,a=this.tracks.length;e<a;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}},{key:"clearTrack",value:function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];if(e!=null){this.queue.end(e),this.disposeNext(e);for(var a=e;;){var n=a.mixingFrom;if(n==null)break;this.queue.end(n),a.mixingFrom=null,a.mixingTo=null,a=n}this.tracks[e.trackIndex]=null,this.queue.drain()}}}},{key:"setCurrent",value:function(t,e,a){var n=this.expandToIndex(t);this.tracks[t]=e,n!=null&&(a&&this.queue.interrupt(n),e.mixingFrom=n,n.mixingTo=e,e.mixTime=0,n.mixingFrom!=null&&n.mixDuration>0&&(e.interruptAlpha*=Math.min(1,n.mixTime/n.mixDuration)),n.timelinesRotation.length=0),this.queue.start(e)}},{key:"setAnimation",value:function(t,e,a){var n=this.data.skeletonData.findAnimation(e);if(n==null)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,n,a)}},{key:"setAnimationWith",value:function(t,e,a){if(e==null)throw new Error("animation cannot be null.");var n=!0,r=this.expandToIndex(t);r!=null&&(r.nextTrackLast==-1?(this.tracks[t]=r.mixingFrom,this.queue.interrupt(r),this.queue.end(r),this.disposeNext(r),r=r.mixingFrom,n=!1):this.disposeNext(r));var o=this.trackEntry(t,e,a,r);return this.setCurrent(t,o,n),this.queue.drain(),o}},{key:"addAnimation",value:function(t,e,a,n){var r=this.data.skeletonData.findAnimation(e);if(r==null)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,r,a,n)}},{key:"addAnimationWith",value:function(t,e,a,n){if(e==null)throw new Error("animation cannot be null.");var r=this.expandToIndex(t);if(r!=null)for(;r.next!=null;)r=r.next;var o=this.trackEntry(t,e,a,r);if(r==null)this.setCurrent(t,o,!0),this.queue.drain();else if(r.next=o,n<=0){var s=r.animationEnd-r.animationStart;s!=0?(r.loop?n+=s*(1+(r.trackTime/s|0)):n+=Math.max(s,r.trackTime),n-=this.data.getMix(r.animation,e)):n=r.trackTime}return o.delay=n,o}},{key:"setEmptyAnimation",value:function(t,e){var a=this.setAnimationWith(t,h.emptyAnimation,!1);return a.mixDuration=e,a.trackEnd=e,a}},{key:"addEmptyAnimation",value:function(t,e,a){a<=0&&(a-=e);var n=this.addAnimationWith(t,h.emptyAnimation,!1,a);return n.mixDuration=e,n.trackEnd=e,n}},{key:"setEmptyAnimations",value:function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var a=0,n=this.tracks.length;a<n;a++){var r=this.tracks[a];r!=null&&this.setEmptyAnimation(r.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}},{key:"expandToIndex",value:function(t){return t<this.tracks.length?this.tracks[t]:(Y.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}},{key:"trackEntry",value:function(t,e,a,n){var r=this.trackEntryPool.obtain();return r.trackIndex=t,r.animation=e,r.loop=a,r.holdPrevious=!1,r.eventThreshold=0,r.attachmentThreshold=0,r.drawOrderThreshold=0,r.animationStart=0,r.animationEnd=e.duration,r.animationLast=-1,r.nextAnimationLast=-1,r.delay=0,r.trackTime=0,r.trackLast=-1,r.nextTrackLast=-1,r.trackEnd=Number.MAX_VALUE,r.timeScale=1,r.alpha=1,r.interruptAlpha=1,r.mixTime=0,r.mixDuration=n==null?0:this.data.getMix(n.animation,e),r.mixBlend=_.replace,r}},{key:"disposeNext",value:function(t){for(var e=t.next;e!=null;)this.queue.dispose(e),e=e.next;t.next=null}},{key:"_animationsChanged",value:function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var t=0,e=this.tracks.length;t<e;t++){var a=this.tracks[t];if(a!=null){for(;a.mixingFrom!=null;)a=a.mixingFrom;do a.mixingFrom!=null&&a.mixBlend==_.add||this.computeHold(a),a=a.mixingTo;while(a!=null)}}}},{key:"computeHold",value:function(t){var e=t.mixingTo,a=t.animation.timelines,n=t.animation.timelines.length,r=Y.setArraySize(t.timelineMode,n);t.timelineHoldMix.length=0;var o=Y.setArraySize(t.timelineHoldMix,n),s=this.propertyIDs;if(e!=null&&e.holdPrevious)for(var u=0;u<n;u++)r[u]=s.add(a[u].getPropertyId())?h.HOLD_FIRST:h.HOLD_SUBSEQUENT;else t:for(var c=0;c<n;c++){var l=a[c],i=l.getPropertyId();if(s.add(i))if(e==null||l instanceof Le||l instanceof De||l instanceof ca||!e.animation.hasTimeline(i))r[c]=h.FIRST;else{for(var d=e.mixingTo;d!=null;d=d.mixingTo)if(!d.animation.hasTimeline(i)){if(t.mixDuration>0){r[c]=h.HOLD_MIX,o[c]=d;continue t}break}r[c]=h.HOLD_FIRST}else r[c]=h.SUBSEQUENT}}},{key:"getCurrent",value:function(t){return t>=this.tracks.length?null:this.tracks[t]}},{key:"addListener",value:function(t){if(t==null)throw new Error("listener cannot be null.");this.listeners.push(t)}},{key:"removeListener",value:function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}},{key:"clearListeners",value:function(){this.listeners.length=0}},{key:"clearListenerNotifications",value:function(){this.queue.clear()}}]),h}();Jt.emptyAnimation=new Et("<empty>",[],0),Jt.SUBSEQUENT=0,Jt.FIRST=1,Jt.HOLD_SUBSEQUENT=2,Jt.HOLD_FIRST=3,Jt.HOLD_MIX=4,Jt.SETUP=1,Jt.CURRENT=2;var Tt,un=function(){function h(){D(this,h),this.animation=void 0,this.next=void 0,this.mixingFrom=void 0,this.mixingTo=void 0,this.listener=void 0,this.trackIndex=void 0,this.loop=void 0,this.holdPrevious=void 0,this.eventThreshold=void 0,this.attachmentThreshold=void 0,this.drawOrderThreshold=void 0,this.animationStart=void 0,this.animationEnd=void 0,this.animationLast=void 0,this.nextAnimationLast=void 0,this.delay=void 0,this.trackTime=void 0,this.trackLast=void 0,this.nextTrackLast=void 0,this.trackEnd=void 0,this.timeScale=void 0,this.alpha=void 0,this.mixTime=void 0,this.mixDuration=void 0,this.interruptAlpha=void 0,this.totalAlpha=void 0,this.mixBlend=_.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}return U(h,[{key:"reset",value:function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}},{key:"getAnimationTime",value:function(){if(this.loop){var t=this.animationEnd-this.animationStart;return t==0?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}},{key:"setAnimationLast",value:function(t){this.animationLast=t,this.nextAnimationLast=t}},{key:"isComplete",value:function(){return this.trackTime>=this.animationEnd-this.animationStart}},{key:"resetRotationDirections",value:function(){this.timelinesRotation.length=0}}]),h}(),dn=function(){function h(t){D(this,h),this.objects=[],this.drainDisabled=!1,this.animState=void 0,this.animState=t}return U(h,[{key:"start",value:function(t){this.objects.push(Tt.start),this.objects.push(t),this.animState.animationsChanged=!0}},{key:"interrupt",value:function(t){this.objects.push(Tt.interrupt),this.objects.push(t)}},{key:"end",value:function(t){this.objects.push(Tt.end),this.objects.push(t),this.animState.animationsChanged=!0}},{key:"dispose",value:function(t){this.objects.push(Tt.dispose),this.objects.push(t)}},{key:"complete",value:function(t){this.objects.push(Tt.complete),this.objects.push(t)}},{key:"event",value:function(t){function e(a,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,e){this.objects.push(Tt.event),this.objects.push(t),this.objects.push(e)})},{key:"drain",value:function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,a=0;a<t.length;a+=2){var n=t[a],r=t[a+1];switch(n){case Tt.start:r.listener!=null&&r.listener.start&&r.listener.start(r);for(var o=0;o<e.length;o++)e[o].start&&e[o].start(r);break;case Tt.interrupt:r.listener!=null&&r.listener.interrupt&&r.listener.interrupt(r);for(var s=0;s<e.length;s++)e[s].interrupt&&e[s].interrupt(r);break;case Tt.end:r.listener!=null&&r.listener.end&&r.listener.end(r);for(var u=0;u<e.length;u++)e[u].end&&e[u].end(r);case Tt.dispose:r.listener!=null&&r.listener.dispose&&r.listener.dispose(r);for(var c=0;c<e.length;c++)e[c].dispose&&e[c].dispose(r);this.animState.trackEntryPool.free(r);break;case Tt.complete:r.listener!=null&&r.listener.complete&&r.listener.complete(r);for(var l=0;l<e.length;l++)e[l].complete&&e[l].complete(r);break;case Tt.event:var i=t[2+a++];r.listener!=null&&r.listener.event&&r.listener.event(r,i);for(var d=0;d<e.length;d++)e[d].event&&e[d].event(r,i)}}this.clear(),this.drainDisabled=!1}}},{key:"clear",value:function(){this.objects.length=0}}]),h}();(function(h){h[h.start=0]="start",h[h.interrupt=1]="interrupt",h[h.end=2]="end",h[h.dispose=3]="dispose",h[h.complete=4]="complete",h[h.event=5]="event"})(Tt||(Tt={}));var Dt,ka,wa,xa,Ea,ba,Sa,Ma,Aa,cn=function(){function h(t){if(D(this,h),this.skeletonData=void 0,this.animationToMixTime={},this.defaultMix=0,t==null)throw new Error("skeletonData cannot be null.");this.skeletonData=t}return U(h,[{key:"setMix",value:function(t,e,a){var n=this.skeletonData.findAnimation(t);if(n==null)throw new Error("Animation not found: "+t);var r=this.skeletonData.findAnimation(e);if(r==null)throw new Error("Animation not found: "+e);this.setMixWith(n,r,a)}},{key:"setMixWith",value:function(t,e,a){if(t==null)throw new Error("from cannot be null.");if(e==null)throw new Error("to cannot be null.");var n=t.name+"."+e.name;this.animationToMixTime[n]=a}},{key:"getMix",value:function(t,e){var a=t.name+"."+e.name,n=this.animationToMixTime[a];return n===void 0?this.defaultMix:n}}]),h}(),Xa=function(h){vt(e,Me);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a)).endSlot=void 0,n.color=new nt(.2275,.2275,.8078,1),n}return U(e,[{key:"copy",value:function(){var a=new e(this.name);return this.copyTo(a),a.endSlot=this.endSlot,a.color.setFromColor(this.color),a}}]),e}(),fn=function(){function h(){D(this,h),this.convexPolygons=new Array,this.convexPolygonsIndices=new Array,this.indicesArray=new Array,this.isConcaveArray=new Array,this.triangles=new Array,this.polygonPool=new oa(function(){return new Array}),this.polygonIndicesPool=new oa(function(){return new Array})}return U(h,[{key:"triangulate",value:function(t){var e=t,a=t.length>>1,n=this.indicesArray;n.length=0;for(var r=0;r<a;r++)n[r]=r;var o=this.isConcaveArray;o.length=0;for(var s=0,u=a;s<u;++s)o[s]=h.isConcave(s,a,e,n);var c=this.triangles;for(c.length=0;a>3;){for(var l=a-1,i=0,d=1;;){t:if(!o[i]){for(var f=n[l]<<1,v=n[i]<<1,g=n[d]<<1,m=e[f],p=e[f+1],y=e[v],w=e[v+1],k=e[g],M=e[g+1],E=(d+1)%a;E!=l;E=(E+1)%a)if(o[E]){var A=n[E]<<1,S=e[A],C=e[A+1];if(h.positiveArea(k,M,m,p,S,C)&&h.positiveArea(m,p,y,w,S,C)&&h.positiveArea(y,w,k,M,S,C))break t}break}if(d==0){do{if(!o[i])break;i--}while(i>0);break}l=i,i=d,d=(d+1)%a}c.push(n[(a+i-1)%a]),c.push(n[i]),c.push(n[(i+1)%a]),n.splice(i,1),o.splice(i,1);var R=(--a+i-1)%a,I=i==a?0:i;o[R]=h.isConcave(R,a,e,n),o[I]=h.isConcave(I,a,e,n)}return a==3&&(c.push(n[2]),c.push(n[0]),c.push(n[1])),c}},{key:"decompose",value:function(t,e){var a=t,n=this.convexPolygons;this.polygonPool.freeAll(n),n.length=0;var r=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(r),r.length=0;var o=this.polygonIndicesPool.obtain();o.length=0;var s=this.polygonPool.obtain();s.length=0;for(var u=-1,c=0,l=0,i=e.length;l<i;l+=3){var d=e[l]<<1,f=e[l+1]<<1,v=e[l+2]<<1,g=a[d],m=a[d+1],p=a[f],y=a[f+1],w=a[v],k=a[v+1],M=!1;if(u==d){var E=s.length-4,A=h.winding(s[E],s[E+1],s[E+2],s[E+3],w,k),S=h.winding(w,k,s[0],s[1],s[2],s[3]);A==c&&S==c&&(s.push(w),s.push(k),o.push(v),M=!0)}M||(s.length>0?(n.push(s),r.push(o)):(this.polygonPool.free(s),this.polygonIndicesPool.free(o)),(s=this.polygonPool.obtain()).length=0,s.push(g),s.push(m),s.push(p),s.push(y),s.push(w),s.push(k),(o=this.polygonIndicesPool.obtain()).length=0,o.push(d),o.push(f),o.push(v),c=h.winding(g,m,p,y,w,k),u=d)}s.length>0&&(n.push(s),r.push(o));for(var C=0,R=n.length;C<R;C++)if((o=r[C]).length!=0){for(var I=o[0],T=o[o.length-1],B=(s=n[C]).length-4,N=s[B],x=s[B+1],b=s[B+2],H=s[B+3],V=s[0],F=s[1],L=s[2],G=s[3],j=h.winding(N,x,b,H,V,F),z=0;z<R;z++)if(z!=C){var q=r[z];if(q.length==3){var O=q[0],X=q[1],Q=q[2],rt=n[z],J=rt[rt.length-2],tt=rt[rt.length-1];if(O==I&&X==T){var W=h.winding(N,x,b,H,J,tt),K=h.winding(J,tt,V,F,L,G);W==j&&K==j&&(rt.length=0,q.length=0,s.push(J),s.push(tt),o.push(Q),N=b,x=H,b=J,H=tt,z=0)}}}}for(var Z=n.length-1;Z>=0;Z--)(s=n[Z]).length==0&&(n.splice(Z,1),this.polygonPool.free(s),o=r[Z],r.splice(Z,1),this.polygonIndicesPool.free(o));return n}}],[{key:"isConcave",value:function(t,e,a,n){var r=n[(e+t-1)%e]<<1,o=n[t]<<1,s=n[(t+1)%e]<<1;return!this.positiveArea(a[r],a[r+1],a[o],a[o+1],a[s],a[s+1])}},{key:"positiveArea",value:function(t,e,a,n,r,o){return t*(o-n)+a*(e-o)+r*(n-e)>=0}},{key:"winding",value:function(t,e,a,n,r,o){var s=a-t,u=n-e;return r*u-o*s+s*e-t*u>=0?1:-1}}]),h}(),vn=function(){function h(){D(this,h),this.triangulator=new fn,this.clippingPolygon=new Array,this.clipOutput=new Array,this.clippedVertices=new Array,this.clippedTriangles=new Array,this.scratch=new Array,this.clipAttachment=void 0,this.clippingPolygons=void 0}return U(h,[{key:"clipStart",value:function(t,e){if(this.clipAttachment!=null)return 0;this.clipAttachment=e;var a=e.worldVerticesLength,n=Y.setArraySize(this.clippingPolygon,a);e.computeWorldVertices(t,0,a,n,0,2);var r=this.clippingPolygon;h.makeClockwise(r);for(var o=this.clippingPolygons=this.triangulator.decompose(r,this.triangulator.triangulate(r)),s=0,u=o.length;s<u;s++){var c=o[s];h.makeClockwise(c),c.push(c[0]),c.push(c[1])}return o.length}},{key:"clipEndWithSlot",value:function(t){this.clipAttachment!=null&&this.clipAttachment.endSlot==t.data&&this.clipEnd()}},{key:"clipEnd",value:function(){this.clipAttachment!=null&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)}},{key:"isClipping",value:function(){return this.clipAttachment!=null}},{key:"clipTriangles",value:function(t,e,a,n,r,o,s,u){var c=this.clipOutput,l=this.clippedVertices,i=this.clippedTriangles,d=this.clippingPolygons,f=this.clippingPolygons.length,v=u?12:8,g=0;l.length=0,i.length=0;t:for(var m=0;m<n;m+=3)for(var p=a[m]<<1,y=t[p],w=t[p+1],k=r[p],M=r[p+1],E=t[p=a[m+1]<<1],A=t[p+1],S=r[p],C=r[p+1],R=t[p=a[m+2]<<1],I=t[p+1],T=r[p],B=r[p+1],N=0;N<f;N++){var x=l.length;if(!this.clip(y,w,E,A,R,I,d[N],c)){var b=Y.setArraySize(l,x+3*v);b[x]=y,b[x+1]=w,b[x+2]=o.r,b[x+3]=o.g,b[x+4]=o.b,b[x+5]=o.a,u?(b[x+6]=k,b[x+7]=M,b[x+8]=s.r,b[x+9]=s.g,b[x+10]=s.b,b[x+11]=s.a,b[x+12]=E,b[x+13]=A,b[x+14]=o.r,b[x+15]=o.g,b[x+16]=o.b,b[x+17]=o.a,b[x+18]=S,b[x+19]=C,b[x+20]=s.r,b[x+21]=s.g,b[x+22]=s.b,b[x+23]=s.a,b[x+24]=R,b[x+25]=I,b[x+26]=o.r,b[x+27]=o.g,b[x+28]=o.b,b[x+29]=o.a,b[x+30]=T,b[x+31]=B,b[x+32]=s.r,b[x+33]=s.g,b[x+34]=s.b,b[x+35]=s.a):(b[x+6]=k,b[x+7]=M,b[x+8]=E,b[x+9]=A,b[x+10]=o.r,b[x+11]=o.g,b[x+12]=o.b,b[x+13]=o.a,b[x+14]=S,b[x+15]=C,b[x+16]=R,b[x+17]=I,b[x+18]=o.r,b[x+19]=o.g,b[x+20]=o.b,b[x+21]=o.a,b[x+22]=T,b[x+23]=B),x=i.length;var H=Y.setArraySize(i,x+3);H[x]=g,H[x+1]=g+1,H[x+2]=g+2,g+=3;continue t}var V=c.length;if(V!=0){for(var F=A-I,L=R-E,G=y-R,j=I-w,z=1/(F*G+L*(w-I)),q=V>>1,O=this.clipOutput,X=Y.setArraySize(l,x+q*v),Q=0;Q<V;Q+=2){var rt=O[Q],J=O[Q+1];X[x]=rt,X[x+1]=J,X[x+2]=o.r,X[x+3]=o.g,X[x+4]=o.b,X[x+5]=o.a;var tt=rt-R,W=J-I,K=(F*tt+L*W)*z,Z=(j*tt+G*W)*z,it=1-K-Z;X[x+6]=k*K+S*Z+T*it,X[x+7]=M*K+C*Z+B*it,u&&(X[x+8]=s.r,X[x+9]=s.g,X[x+10]=s.b,X[x+11]=s.a),x+=v}x=i.length;var et=Y.setArraySize(i,x+3*(q-2));q--;for(var ht=1;ht<q;ht++)et[x]=g,et[x+1]=g+ht,et[x+2]=g+ht+1,x+=3;g+=q+1}}}},{key:"clip",value:function(t,e,a,n,r,o,s,u){var c=u,l=!1,i=null;s.length%4>=2?(i=u,u=this.scratch):i=this.scratch,i.length=0,i.push(t),i.push(e),i.push(a),i.push(n),i.push(r),i.push(o),i.push(t),i.push(e),u.length=0;for(var d=s,f=s.length-4,v=0;;v+=2){for(var g=d[v],m=d[v+1],p=d[v+2],y=d[v+3],w=g-p,k=m-y,M=i,E=i.length-2,A=u.length,S=0;S<E;S+=2){var C=M[S],R=M[S+1],I=M[S+2],T=M[S+3],B=w*(T-y)-k*(I-p)>0;if(w*(R-y)-k*(C-p)>0){if(B){u.push(I),u.push(T);continue}var N=T-R,x=I-C,b=N*(p-g)-x*(y-m);if(Math.abs(b)>1e-6){var H=(x*(m-R)-N*(g-C))/b;u.push(g+(p-g)*H),u.push(m+(y-m)*H)}else u.push(g),u.push(m)}else if(B){var V=T-R,F=I-C,L=V*(p-g)-F*(y-m);if(Math.abs(L)>1e-6){var G=(F*(m-R)-V*(g-C))/L;u.push(g+(p-g)*G),u.push(m+(y-m)*G)}else u.push(g),u.push(m);u.push(I),u.push(T)}l=!0}if(A==u.length)return c.length=0,!0;if(u.push(u[0]),u.push(u[1]),v==f)break;var j=u;(u=i).length=0,i=j}if(c!=u){c.length=0;for(var z=0,q=u.length-2;z<q;z++)c[z]=u[z]}else c.length=c.length-2;return l}}],[{key:"makeClockwise",value:function(t){for(var e=t,a=t.length,n=e[a-2]*e[1]-e[0]*e[a-1],r=0,o=0,s=0,u=0,c=a-3;u<c;u+=2)r=e[u],o=e[u+1],s=e[u+2],n+=r*e[u+3]-s*o;if(!(n<0))for(var l=0,i=a-2,d=a>>1;l<d;l+=2){var f=e[l],v=e[l+1],g=i-l;e[l]=e[g],e[l+1]=e[g+1],e[g]=f,e[g+1]=v}}}]),h}(),gn=function(){function h(){D(this,h),this._mesh=void 0,this._indexBuffer=void 0,this._vertexBuffer=void 0}return U(h,[{key:"mesh",get:function(){return this._mesh}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"vertexBuffer",get:function(){return this._vertexBuffer}},{key:"initialize",value:function(t,e){var a=this._mesh=new Ha(t),n=[new aa("POSITION",0,na.Vector3,0),new aa("COLOR_0",12,na.Vector4,0),new aa("TEXCOORD_0",28,na.Vector2,0)],r=4*Se.VERTEX_STRIDE,o=r*e,s=new He(t,Ge.VertexBuffer,o,je.Dynamic),u=new He(t,Ge.IndexBuffer,2*e,je.Dynamic);this._indexBuffer=u,this._vertexBuffer=s,a.setVertexBufferBinding(s,r),a.setIndexBufferBinding(u,va.UInt16),a.setVertexElements(n),a.addSubMesh(0,e)}},{key:"changeBuffer",value:function(t,e){var a=4*Se.VERTEX_STRIDE,n=a*e,r=new He(t,Ge.VertexBuffer,n,je.Dynamic),o=new He(t,Ge.IndexBuffer,2*e,je.Dynamic),s=this._mesh;this._indexBuffer=o,this._vertexBuffer=r,s.setVertexBufferBinding(r,a),s.setIndexBufferBinding(o,va.UInt16)}}]),h}(),Se=function(){function h(t,e){D(this,h),this._setting=void 0,this._engine=void 0,this._entity=void 0,this._clipper=new vn,this._spineMesh=new gn,this._vertexCount=void 0,this._vertices=void 0,this._verticesWithZ=void 0,this._indices=void 0,this._needResize=!1,this._meshRenderer=void 0,this._subMeshItems=[],this.separateSlots=[],this._engine=t,this._entity=e}return U(h,[{key:"mesh",get:function(){return this._spineMesh.mesh}},{key:"subMeshItems",get:function(){return this._subMeshItems}},{key:"initialize",value:function(t,e){if(t){var a=this._entity.getComponent(Ye);if(a){this._meshRenderer=a,e&&(this._setting=e);for(var n=t.defaultSkin.attachments,r=0,o=h.QUAD_TRIANGLES.length,s=0,u=n.length;s<u;s++){var c=n[s];for(var l in c){var i=c[l];if(i)if(i instanceof at)r+=o;else{if(!(i instanceof Ue))continue;r+=i.triangles.length}}}this._vertexCount=r,this._prepareBufferData(this._vertexCount);var d=this._spineMesh;d.initialize(this._engine,this._vertexCount),a.mesh=d.mesh}else console.warn("You need add MeshRenderer component to entity first")}}},{key:"buildMesh",value:function(t){var e=this._setting||{},a=e.useClipping,n=a===void 0||a,r=e.zSpacing,o=r===void 0?.01:r,s=0,u=0;this._subMeshItems.length=0;for(var c,l,i=this._meshRenderer,d=t.drawOrder,f=d.length,v=this._clipper,g=this._spineMesh,m=g.mesh,p=this._subMeshItems,y=this._vertices,w=0,k=0,M=0;M<f;M+=1){var E=d[M];if(E.bone.active){var A=E.getAttachment(),S=null,C=null,R=o*M,I=0,T=v.isClipping()?2:h.VERTEX_SIZE;if(A instanceof at){var B=A;S=B.color,y=this._vertices,I=4*T,B.computeWorldVertices(E.bone,y,0,T),c=h.QUAD_TRIANGLES,l=B.uvs,C=B.region.renderObject.texture}else if(A instanceof Ue){var N=A;S=N.color,y=this._vertices,(I=(N.worldVerticesLength>>1)*T)>y.length&&(y=this._vertices=new Float32Array(I)),N.computeWorldVertices(E,0,N.worldVerticesLength,y,0,T),c=N.triangles,l=N.uvs,C=N.region.renderObject.texture}else if(A instanceof Xa){if(n){var x=A;v.clipStart(E,x);continue}}else if(n){v.clipEndWithSlot(E);continue}if(C!=null){var b=void 0,H=void 0,V=void 0,F=void 0,L=E.bone.skeleton.color,G=E.color,j=L.a*G.a*S.a,z=h.tempColor;if(z.set(L.r*G.r*S.r,L.g*G.g*S.g,L.b*G.b*S.b,j),v.isClipping()){v.clipTriangles(y,I,c,c.length,l,z,null,!1);var q=v.clippedVertices,O=v.clippedTriangles;b=q,H=q.length,V=O,F=O.length}else{for(var X=y,Q=2,rt=0,J=I;Q<J;Q+=T,rt+=2)X[Q]=z.r,X[Q+1]=z.g,X[Q+2]=z.b,X[Q+3]=z.a,X[Q+4]=l[rt],X[Q+5]=l[rt+1];b=y,H=I,V=c,F=c.length}for(var tt=s/h.VERTEX_STRIDE,W=this._verticesWithZ,K=s,Z=0;Z<H;)W[K++]=b[Z++],W[K++]=b[Z++],W[K++]=R,W[K++]=b[Z++],W[K++]=b[Z++],W[K++]=b[Z++],W[K++]=b[Z++],W[K++]=b[Z++],W[K++]=b[Z++];s=K;var it=this._indices;for(K=u,Z=0;Z<F;K++,Z++)it[K]=V[Z]+tt;var et=E.data.name;if(this.separateSlots.includes(et)){var ht=new ra(u,F);if(p.push({name:et,subMesh:ht}),k>0){var ot=new ra(w,k);p.push({name:"default",subMesh:ot}),k=0}w=u+F}else k+=F;u+=F;for(var lt=i.getMaterials(),ut=lt.length,$=0;$<ut;$+=1){var ft=lt[$];ft.shaderData.getTexture("u_cusTomTexture")||ft.shaderData.setTexture("u_cusTomTexture",C.texture)}}v.clipEndWithSlot(E)}else v.clipEndWithSlot(E)}if(v.clipEnd(),k>0){var st=new ra(w,k);p.push({name:"default",subMesh:st}),k=0}if(p.sort(function(mt,ct){return mt.subMesh.start-ct.subMesh.start}),u>0&&u!==this._vertexCount&&u>this._vertexCount)return this._vertexCount=u,this._prepareBufferData(this._vertexCount),void(this._needResize=!0);m.clearSubMesh();for(var yt=p.length,dt=0;dt<yt;dt+=1)m.addSubMesh(p[dt].subMesh);this._needResize&&(g.vertexBuffer.resize(this._verticesWithZ.byteLength),g.indexBuffer.resize(this._indices.byteLength),this._needResize=!1),g.vertexBuffer.setData(this._verticesWithZ),g.indexBuffer.setData(this._indices)}},{key:"addSeparateSlot",value:function(t){this.separateSlots.push(t)}},{key:"_prepareBufferData",value:function(t){this._vertices=new Float32Array(t*h.VERTEX_SIZE),this._verticesWithZ=new Float32Array(t*h.VERTEX_STRIDE),this._indices=new Uint16Array(t)}}]),h}();Se.QUAD_TRIANGLES=[0,1,2,2,3,0],Se.VERTEX_SIZE=8,Se.VERTEX_STRIDE=9,Se.tempColor=new nt;var zt,mn=(Dt=function(h){vt(e,Ga);var t=gt(e);function e(a){var n;return D(this,e),ve(n=t.call(this,a),"_skeletonData",ka,Ut(n)),ve(n,"_skeleton",wa,Ut(n)),ve(n,"_state",xa,Ut(n)),ve(n,"_tempOffset",Ea,Ut(n)),ve(n,"_tempSize",ba,Ut(n)),ve(n,"_tempArray",Sa,Ut(n)),ve(n,"_meshGenerator",Ma,Ut(n)),ve(n,"setting",Aa,Ut(n)),n.autoUpdate=!0,n.autoUpdateBounds=!1,n._meshGenerator=new Se(n.engine,a),n}return U(e,[{key:"skeletonData",get:function(){return this._skeletonData}},{key:"skeleton",get:function(){return this._skeleton}},{key:"state",get:function(){return this._state}},{key:"mesh",get:function(){return this._meshGenerator.mesh}},{key:"scale",set:function(a){this._skeleton&&(this._skeleton.scaleX=a,this._skeleton.scaleY=a)}},{key:"setSkeletonData",value:function(a,n){a||console.error("SkeletonData is undefined"),this.setting=n,this._skeletonData=a,this._skeleton=new hn(a);var r=new cn(a);this._state=new Jt(r),this._meshGenerator.initialize(a,this.setting)}},{key:"addSeparateSlot",value:function(a){this.skeleton||console.error("Skeleton not found!");var n=this.entity.getComponent(Ye);if(n||console.warn("You need add MeshRenderer component to entity first"),this.skeleton.findSlot(a)){this._meshGenerator.addSeparateSlot(a);var r=this.engine._spriteDefaultMaterial.clone(),o=this.engine._spriteDefaultMaterial.clone(),s=n.materialCount;n.setMaterial(s,r),n.setMaterial(s+1,o)}else console.warn("Slot: ".concat(a," not find."))}},{key:"hackSeparateSlotTexture",value:function(a,n){this._meshGenerator.buildMesh(this._skeleton);var r=this._meshGenerator,o=r.separateSlots,s=r.subMeshItems;if(o.length!==0)if(o.includes(a)){var u=this.entity.getComponent(Ye),c=s.findIndex(function(l){return l.name===a});u.getMaterial(c).shaderData.setTexture("u_cusTomTexture",n)}else console.warn("Slot ".concat(a," is not separated. You should use addSeparateSlot to separate it"));else console.warn("You need add separate slot")}},{key:"onUpdate",value:function(a){this.autoUpdate&&this.updateState(.001*a)}},{key:"updateState",value:function(a){if(this._skeleton&&this.state){var n=this._state,r=this._skeleton;n.update(a),n.apply(r),r.updateWorldTransform(),this.updateGeometry()}}},{key:"updateGeometry",value:function(){this._skeleton&&(this._meshGenerator.buildMesh(this._skeleton),this.autoUpdateBounds&&this.updateBounds())}},{key:"updateBounds",value:function(){var a,n=this.entity.getComponent(Ye).bounds,r=this._tempOffset,o=this._tempSize,s=this._tempArray,u=((a=this.setting)===null||a===void 0?void 0:a.zSpacing)||.01,c=this._skeleton;c.getBounds(r,o,s);var l=c.drawOrder;n.min.set(r.x,r.y,0),n.max.set(r.x+o.x,r.y+o.y,l.length*u)}},{key:"_cloneTo",value:function(a){a.setSkeletonData(this.skeletonData);var n=function(r){for(var o=1;o<arguments.length;o++){var s=arguments[o]!=null?arguments[o]:{};o%2?ga(Object(s),!0).forEach(function(u){Qa(r,u,s[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(s)):ga(Object(s)).forEach(function(u){Object.defineProperty(r,u,Object.getOwnPropertyDescriptor(s,u))})}return r}({},this.setting);a.setting=n}},{key:"_disposeCurrentSkeleton",value:function(){this._skeletonData=null,this._skeleton=null,this._state=null}},{key:"onDestroy",value:function(){this._disposeCurrentSkeleton(),this._meshGenerator=null,this.setting=null}}]),e}(),ka=ge(Dt.prototype,"_skeletonData",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wa=ge(Dt.prototype,"_skeleton",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xa=ge(Dt.prototype,"_state",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ea=ge(Dt.prototype,"_tempOffset",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new la}}),ba=ge(Dt.prototype,"_tempSize",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new la}}),Sa=ge(Dt.prototype,"_tempArray",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[0,0]}}),Ma=ge(Dt.prototype,"_meshGenerator",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aa=ge(Dt.prototype,"setting",[fe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dt),pn=function(){function h(t,e){D(this,h),this.pathPrefix=void 0,this.textureLoader=void 0,this.assets={},this.errors={},this.toLoad=0,this.loaded=0,this.rawDataUris={},this.onLoadComplete=void 0,this.pathPrefix=t||"",this.textureLoader=e}return U(h,[{key:"downloadText",value:function(t,e,a){var n=new XMLHttpRequest;n.overrideMimeType("text/html"),this.rawDataUris[t]&&(t=this.rawDataUris[t]),n.open("GET",t,!0),n.onload=function(){n.status==200?e(n.responseText):a(n.status,n.responseText)},n.onerror=function(){a(n.status,n.responseText)},n.send()}},{key:"downloadBinary",value:function(t,e,a){var n=new XMLHttpRequest;this.rawDataUris[t]&&(t=this.rawDataUris[t]),n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){n.status==200?e(new Uint8Array(n.response)):a(n.status,n.responseText)},n.onerror=function(){a(n.status,n.responseText)},n.send()}},{key:"setRawDataURI",value:function(t,e){this.rawDataUris[this.pathPrefix+t]=e}},{key:"loadBinary",value:function(t){var e=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;t=this.pathPrefix+t,this.toLoad++,this.downloadBinary(t,function(r){e.assets[t]=r,a&&a(t,r),e.onLoad(),e.loaded++},function(r,o){e.errors[t]="Couldn't load binary ".concat(t,": status ").concat(status,", ").concat(o),n&&n(t,"Couldn't load binary ".concat(t,": status ").concat(status,", ").concat(o)),e.onLoad(),e.loaded++})}},{key:"loadText",value:function(t){var e=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;t=this.pathPrefix+t,this.toLoad++,this.downloadText(t,function(r){e.assets[t]=r,a&&a(t,r),e.onLoad(),e.loaded++},function(r,o){e.errors[t]="Couldn't load text ".concat(t,": status ").concat(status,", ").concat(o),n&&n(t,"Couldn't load text ".concat(t,": status ").concat(status,", ").concat(o)),e.onLoad(),e.loaded++})}},{key:"loadImage",value:function(t){var e=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,r=t=this.pathPrefix+t;this.toLoad++;var o=new Image;o.crossOrigin="anonymous",o.onload=function(s){e.assets[r]=o,e.onLoad(),e.loaded++,a&&a(t,o)},o.onerror=function(s){e.errors[t]="Couldn't load image ".concat(t),e.onLoad(),e.loaded++,n&&n(t,"Couldn't load image ".concat(t))},this.rawDataUris[t]&&(t=this.rawDataUris[t]),o.src=t}},{key:"loadTexture",value:function(t){var e=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,r=t=this.pathPrefix+t;this.toLoad++;var o=new Image;o.crossOrigin="anonymous",o.onload=function(s){var u=e.textureLoader(o);e.assets[r]=u,e.onLoad(),e.loaded++,a&&a(t,u)},o.onerror=function(s){e.errors[t]="Couldn't load image ".concat(t),e.onLoad(),e.loaded++,n&&n(t,"Couldn't load image ".concat(t))},this.rawDataUris[t]&&(t=this.rawDataUris[t]),o.src=t}},{key:"loadTextureAtlas",value:function(t){var e=this,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,r=t.lastIndexOf("/")>=0?t.substring(0,t.lastIndexOf("/")):"";t=this.pathPrefix+t,this.toLoad++,this.downloadText(t,function(o){var s={count:0},u=new Array;try{new ha(o,function(f){u.push(r==""?f:r+"/"+f);var v=document.createElement("img");return v.width=16,v.height=16,new sn(v)})}catch(f){var c=f;return e.errors[t]="Couldn't load texture atlas ".concat(t,": ").concat(c.message),n&&n(t,"Couldn't load texture atlas ".concat(t,": ").concat(c.message)),e.onLoad(),void e.loaded++}for(var l=function(){var f=d[i],v=!1;e.loadTexture(f,function(g,m){if(s.count++,s.count==u.length)if(v)console.log(3),e.errors[t]="Couldn't load texture atlas page ".concat(g,"} of atlas ").concat(t),n&&n(t,"Couldn't load texture atlas page ".concat(g," of atlas ").concat(t)),e.onLoad(),e.loaded++;else try{var p=new ha(o,function(w){return e.get(r==""?w:r+"/"+w)});e.assets[t]=p,a&&a(t,p),e.onLoad(),e.loaded++}catch(w){var y=w;console.log(w),e.errors[t]="Couldn't load texture atlas ".concat(t,": ").concat(y.message),n&&n(t,"Couldn't load texture atlas ".concat(t,": ").concat(y.message)),e.onLoad(),e.loaded++}},function(g,m){v=!0,s.count++,s.count==u.length&&(console.log(4),e.errors[t]="Couldn't load texture atlas page ".concat(g,"} of atlas ").concat(t),n&&n(t,"Couldn't load texture atlas page ".concat(g," of atlas ").concat(t)),e.onLoad(),e.loaded++)})},i=0,d=u;i<d.length;i++)l()},function(o,s){e.errors[t]="Couldn't load texture atlas ".concat(t,": status ").concat(status,", ").concat(s),n&&n(t,"Couldn't load texture atlas ".concat(t,": status ").concat(status,", ").concat(s)),e.onLoad(),e.loaded++})}},{key:"get",value:function(t){return t=this.pathPrefix+t,this.assets[t]}},{key:"remove",value:function(t){t=this.pathPrefix+t;var e=this.assets[t];e.dispose&&e.dispose(),this.assets[t]=null}},{key:"removeAll",value:function(){for(var t in this.assets){var e=this.assets[t];e.dispose&&e.dispose()}this.assets={}}},{key:"isLoadingComplete",value:function(){return this.toLoad==0}},{key:"onLoad",value:function(){this.toLoad--,this.toLoad===0&&this.onLoadComplete()}},{key:"getToLoad",value:function(){return this.toLoad}},{key:"getLoaded",value:function(){return this.loaded}},{key:"dispose",value:function(){this.removeAll()}},{key:"hasErrors",value:function(){return Object.keys(this.errors).length>0}},{key:"getErrors",value:function(){return this.errors}}]),h}(),yn=function(h){vt(e,Me);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a)).color=new nt(1,1,1,1),n}return U(e,[{key:"copy",value:function(){var a=new e(this.name);return this.copyTo(a),a.color.setFromColor(this.color),a}}]),e}(),kn=function(h){vt(e,Me);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a)).x=void 0,n.y=void 0,n.rotation=void 0,n.color=new nt(.38,.94,0,1),n.name=a,n}return U(e,[{key:"computeWorldPosition",value:function(a,n){return n.x=this.x*a.a+this.y*a.b+a.worldX,n.y=this.x*a.c+this.y*a.d+a.worldY,n}},{key:"computeWorldRotation",value:function(a){var n=P.cosDeg(this.rotation),r=P.sinDeg(this.rotation),o=n*a.a+r*a.b,s=n*a.c+r*a.d;return Math.atan2(s,o)*P.radDeg}},{key:"copy",value:function(){var a=new e(this.name);return a.x=this.x,a.y=this.y,a.rotation=this.rotation,a.color.setFromColor(this.color),a}}]),e}(),wn=function(){function h(t){D(this,h),this.atlas=void 0,this.atlas=t}return U(h,[{key:"newRegionAttachment",value:function(t,e,a){var n=this.atlas.findRegion(a);if(n==null)throw new Error("Region not found in atlas: "+a+" (region attachment: "+e+")");n.renderObject=n;var r=new at(e);return r.setRegion(n),r}},{key:"newMeshAttachment",value:function(t,e,a){var n=this.atlas.findRegion(a);if(n==null)throw new Error("Region not found in atlas: "+a+" (mesh attachment: "+e+")");n.renderObject=n;var r=new Ue(e);return r.region=n,r}},{key:"newBoundingBoxAttachment",value:function(t,e){return new yn(e)}},{key:"newPathAttachment",value:function(t,e){return new Ke(e)}},{key:"newPointAttachment",value:function(t,e){return new kn(e)}},{key:"newClippingAttachment",value:function(t,e){return new Xa(e)}}]),h}(),Ba=function(){function h(){D(this,h),this.name=void 0,this.bones=new Array,this.slots=new Array,this.skins=new Array,this.defaultSkin=void 0,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.version=void 0,this.hash=void 0,this.fps=0,this.imagesPath=void 0,this.audioPath=void 0}return U(h,[{key:"findBone",value:function(t){if(t==null)throw new Error("boneName cannot be null.");for(var e=this.bones,a=0,n=e.length;a<n;a++){var r=e[a];if(r.name==t)return r}return null}},{key:"findBoneIndex",value:function(t){if(t==null)throw new Error("boneName cannot be null.");for(var e=this.bones,a=0,n=e.length;a<n;a++)if(e[a].name==t)return a;return-1}},{key:"findSlot",value:function(t){if(t==null)throw new Error("slotName cannot be null.");for(var e=this.slots,a=0,n=e.length;a<n;a++){var r=e[a];if(r.name==t)return r}return null}},{key:"findSlotIndex",value:function(t){if(t==null)throw new Error("slotName cannot be null.");for(var e=this.slots,a=0,n=e.length;a<n;a++)if(e[a].name==t)return a;return-1}},{key:"findSkin",value:function(t){if(t==null)throw new Error("skinName cannot be null.");for(var e=this.skins,a=0,n=e.length;a<n;a++){var r=e[a];if(r.name==t)return r}return null}},{key:"findEvent",value:function(t){if(t==null)throw new Error("eventDataName cannot be null.");for(var e=this.events,a=0,n=e.length;a<n;a++){var r=e[a];if(r.name==t)return r}return null}},{key:"findAnimation",value:function(t){if(t==null)throw new Error("animationName cannot be null.");for(var e=this.animations,a=0,n=e.length;a<n;a++){var r=e[a];if(r.name==t)return r}return null}},{key:"findIkConstraint",value:function(t){if(t==null)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,a=0,n=e.length;a<n;a++){var r=e[a];if(r.name==t)return r}return null}},{key:"findTransformConstraint",value:function(t){if(t==null)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,a=0,n=e.length;a<n;a++){var r=e[a];if(r.name==t)return r}return null}},{key:"findPathConstraint",value:function(t){if(t==null)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,a=0,n=e.length;a<n;a++){var r=e[a];if(r.name==t)return r}return null}},{key:"findPathConstraintIndex",value:function(t){if(t==null)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,a=0,n=e.length;a<n;a++)if(e[a].name==t)return a;return-1}}]),h}(),Oa=U(function h(t,e,a){if(D(this,h),this.index=void 0,this.name=void 0,this.boneData=void 0,this.color=new nt(1,1,1,1),this.darkColor=void 0,this.attachmentName=void 0,this.blendMode=void 0,t<0)throw new Error("index must be >= 0.");if(e==null)throw new Error("name cannot be null.");if(a==null)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=a}),Ya=function(h){vt(e,da);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a,0,!1)).bones=new Array,n.target=void 0,n.bendDirection=1,n.compress=!1,n.stretch=!1,n.uniform=!1,n.mix=1,n.softness=0,n}return U(e)}(),Da=function(h){vt(e,da);var t=gt(e);function e(a){var n;return D(this,e),(n=t.call(this,a,0,!1)).bones=new Array,n.target=void 0,n.rotateMix=0,n.translateMix=0,n.scaleMix=0,n.shearMix=0,n.offsetRotation=0,n.offsetX=0,n.offsetY=0,n.offsetScaleX=0,n.offsetScaleY=0,n.offsetShearY=0,n.relative=!1,n.local=!1,n}return U(e)}(),Ia=U(function h(t,e,a){D(this,h),this.slotIndex=t,this.name=e,this.attachment=a}),ua=function(){function h(t){if(D(this,h),this.name=void 0,this.attachments=new Array,this.bones=Array(),this.constraints=new Array,t==null)throw new Error("name cannot be null.");this.name=t}return U(h,[{key:"setAttachment",value:function(t,e,a){if(a==null)throw new Error("attachment cannot be null.");var n=this.attachments;t>=n.length&&(n.length=t+1),n[t]||(n[t]={}),n[t][e]=a}},{key:"addSkin",value:function(t){for(var e=0;e<t.bones.length;e++){for(var a=t.bones[e],n=!1,r=0;r<this.bones.length;r++)if(this.bones[r]==a){n=!0;break}n||this.bones.push(a)}for(var o=0;o<t.constraints.length;o++){for(var s=t.constraints[o],u=!1,c=0;c<this.constraints.length;c++)if(this.constraints[c]==s){u=!0;break}u||this.constraints.push(s)}for(var l=t.getAttachments(),i=0;i<l.length;i++){var d=l[i];this.setAttachment(d.slotIndex,d.name,d.attachment)}}},{key:"copySkin",value:function(t){for(var e=0;e<t.bones.length;e++){for(var a=t.bones[e],n=!1,r=0;r<this.bones.length;r++)if(this.bones[r]==a){n=!0;break}n||this.bones.push(a)}for(var o=0;o<t.constraints.length;o++){for(var s=t.constraints[o],u=!1,c=0;c<this.constraints.length;c++)if(this.constraints[c]==s){u=!0;break}u||this.constraints.push(s)}for(var l=t.getAttachments(),i=0;i<l.length;i++){var d=l[i];d.attachment!=null&&(d.attachment instanceof Ue?(d.attachment=d.attachment.newLinkedMesh(),this.setAttachment(d.slotIndex,d.name,d.attachment)):(d.attachment=d.attachment.copy(),this.setAttachment(d.slotIndex,d.name,d.attachment)))}}},{key:"getAttachment",value:function(t,e){var a=this.attachments[t];return a?a[e]:null}},{key:"removeAttachment",value:function(t,e){var a=this.attachments[t];a&&(a[e]=null)}},{key:"getAttachments",value:function(){for(var t=new Array,e=0;e<this.attachments.length;e++){var a=this.attachments[e];if(a)for(var n in a){var r=a[n];r&&t.push(new Ia(e,n,r))}}return t}},{key:"getAttachmentsForSlot",value:function(t,e){var a=this.attachments[t];if(a)for(var n in a){var r=a[n];r&&e.push(new Ia(t,n,r))}}},{key:"clear",value:function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}},{key:"attachAll",value:function(t,e){for(var a=0,n=0;n<t.slots.length;n++){var r=t.slots[n],o=r.getAttachment();if(o&&a<e.attachments.length){var s=e.attachments[a];for(var u in s)if(o==s[u]){var c=this.getAttachment(a,u);c!=null&&r.setAttachment(c);break}}a++}}}]),h}(),Ua=U(function h(t){D(this,h),this.name=void 0,this.intValue=void 0,this.floatValue=void 0,this.stringValue=void 0,this.audioPath=void 0,this.volume=void 0,this.balance=void 0,this.name=t});(function(h){h[h.Normal=0]="Normal",h[h.Additive=1]="Additive",h[h.Multiply=2]="Multiply",h[h.Screen=3]="Screen"})(zt||(zt={}));var $t,Wa=U(function h(t,e){if(D(this,h),this.data=void 0,this.intValue=void 0,this.floatValue=void 0,this.stringValue=void 0,this.time=void 0,this.volume=void 0,this.balance=void 0,e==null)throw new Error("data cannot be null.");this.time=t,this.data=e}),xn=function(){function h(t){D(this,h),this.attachmentLoader=void 0,this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return U(h,[{key:"readSkeletonData",value:function(t){var e=this.scale,a=new Ba,n=typeof t=="string"?JSON.parse(t):t,r=n.skeleton;if(r!=null){if(a.hash=r.hash,a.version=r.spine,a.version=="3.8.75")throw new Error("Unsupported skeleton data, please export with a newer version of Spine.");a.x=r.x,a.y=r.y,a.width=r.width,a.height=r.height,a.fps=r.fps,a.imagesPath=r.images}if(n.bones)for(var o=0;o<n.bones.length;o++){var s=n.bones[o],u=null,c=this.getValue(s,"parent",null);if(c!=null&&(u=a.findBone(c))==null)throw new Error("Parent bone not found: "+c);var l=new Ta(a.bones.length,s.name,u);l.length=this.getValue(s,"length",0)*e,l.x=this.getValue(s,"x",0)*e,l.y=this.getValue(s,"y",0)*e,l.rotation=this.getValue(s,"rotation",0),l.scaleX=this.getValue(s,"scaleX",1),l.scaleY=this.getValue(s,"scaleY",1),l.shearX=this.getValue(s,"shearX",0),l.shearY=this.getValue(s,"shearY",0),l.transformMode=h.transformModeFromString(this.getValue(s,"transform","normal")),l.skinRequired=this.getValue(s,"skin",!1),a.bones.push(l)}if(n.slots)for(var i=0;i<n.slots.length;i++){var d=n.slots[i],f=d.name,v=d.bone,g=a.findBone(v);if(g==null)throw new Error("Slot bone not found: "+v);var m=new Oa(a.slots.length,f,g),p=this.getValue(d,"color",null);p!=null&&m.color.setFromString(p);var y=this.getValue(d,"dark",null);y!=null&&(m.darkColor=new nt(1,1,1,1),m.darkColor.setFromString(y)),m.attachmentName=this.getValue(d,"attachment",null),m.blendMode=h.blendModeFromString(this.getValue(d,"blend","normal")),a.slots.push(m)}if(n.ik)for(var w=0;w<n.ik.length;w++){var k=n.ik[w],M=new Ya(k.name);M.order=this.getValue(k,"order",0),M.skinRequired=this.getValue(k,"skin",!1);for(var E=0;E<k.bones.length;E++){var A=k.bones[E],S=a.findBone(A);if(S==null)throw new Error("IK bone not found: "+A);M.bones.push(S)}var C=k.target;if(M.target=a.findBone(C),M.target==null)throw new Error("IK target bone not found: "+C);M.mix=this.getValue(k,"mix",1),M.softness=this.getValue(k,"softness",0)*e,M.bendDirection=this.getValue(k,"bendPositive",!0)?1:-1,M.compress=this.getValue(k,"compress",!1),M.stretch=this.getValue(k,"stretch",!1),M.uniform=this.getValue(k,"uniform",!1),a.ikConstraints.push(M)}if(n.transform)for(var R=0;R<n.transform.length;R++){var I=n.transform[R],T=new Da(I.name);T.order=this.getValue(I,"order",0),T.skinRequired=this.getValue(I,"skin",!1);for(var B=0;B<I.bones.length;B++){var N=I.bones[B],x=a.findBone(N);if(x==null)throw new Error("Transform constraint bone not found: "+N);T.bones.push(x)}var b=I.target;if(T.target=a.findBone(b),T.target==null)throw new Error("Transform constraint target bone not found: "+b);T.local=this.getValue(I,"local",!1),T.relative=this.getValue(I,"relative",!1),T.offsetRotation=this.getValue(I,"rotation",0),T.offsetX=this.getValue(I,"x",0)*e,T.offsetY=this.getValue(I,"y",0)*e,T.offsetScaleX=this.getValue(I,"scaleX",0),T.offsetScaleY=this.getValue(I,"scaleY",0),T.offsetShearY=this.getValue(I,"shearY",0),T.rotateMix=this.getValue(I,"rotateMix",1),T.translateMix=this.getValue(I,"translateMix",1),T.scaleMix=this.getValue(I,"scaleMix",1),T.shearMix=this.getValue(I,"shearMix",1),a.transformConstraints.push(T)}if(n.path)for(var H=0;H<n.path.length;H++){var V=n.path[H],F=new Pa(V.name);F.order=this.getValue(V,"order",0),F.skinRequired=this.getValue(V,"skin",!1);for(var L=0;L<V.bones.length;L++){var G=V.bones[L],j=a.findBone(G);if(j==null)throw new Error("Transform constraint bone not found: "+G);F.bones.push(j)}var z=V.target;if(F.target=a.findSlot(z),F.target==null)throw new Error("Path target slot not found: "+z);F.positionMode=h.positionModeFromString(this.getValue(V,"positionMode","percent")),F.spacingMode=h.spacingModeFromString(this.getValue(V,"spacingMode","length")),F.rotateMode=h.rotateModeFromString(this.getValue(V,"rotateMode","tangent")),F.offsetRotation=this.getValue(V,"rotation",0),F.position=this.getValue(V,"position",0),F.positionMode==Xt.Fixed&&(F.position*=e),F.spacing=this.getValue(V,"spacing",0),F.spacingMode!=bt.Length&&F.spacingMode!=bt.Fixed||(F.spacing*=e),F.rotateMix=this.getValue(V,"rotateMix",1),F.translateMix=this.getValue(V,"translateMix",1),a.pathConstraints.push(F)}if(n.skins)for(var q=0;q<n.skins.length;q++){var O=n.skins[q],X=new ua(O.name);if(O.bones)for(var Q=0;Q<O.bones.length;Q++){var rt=a.findBone(O.bones[Q]);if(rt==null)throw new Error("Skin bone not found: "+O.bones[q]);X.bones.push(rt)}if(O.ik)for(var J=0;J<O.ik.length;J++){var tt=a.findIkConstraint(O.ik[J]);if(tt==null)throw new Error("Skin IK constraint not found: "+O.ik[q]);X.constraints.push(tt)}if(O.transform)for(var W=0;W<O.transform.length;W++){var K=a.findTransformConstraint(O.transform[W]);if(K==null)throw new Error("Skin transform constraint not found: "+O.transform[q]);X.constraints.push(K)}if(O.path)for(var Z=0;Z<O.path.length;Z++){var it=a.findPathConstraint(O.path[Z]);if(it==null)throw new Error("Skin path constraint not found: "+O.path[q]);X.constraints.push(it)}for(var et in O.attachments){var ht=a.findSlot(et);if(ht==null)throw new Error("Slot not found: "+et);var ot=O.attachments[et];for(var lt in ot){var ut=this.readAttachment(ot[lt],X,ht.index,lt,a);ut!=null&&X.setAttachment(ht.index,lt,ut)}}a.skins.push(X),X.name=="default"&&(a.defaultSkin=X)}for(var $=0,ft=this.linkedMeshes.length;$<ft;$++){var st=this.linkedMeshes[$],yt=st.skin==null?a.defaultSkin:a.findSkin(st.skin);if(yt==null)throw new Error("Skin not found: "+st.skin);var dt=yt.getAttachment(st.slotIndex,st.parent);if(dt==null)throw new Error("Parent mesh not found: "+st.parent);st.mesh.deformAttachment=st.inheritDeform?dt:st.mesh,st.mesh.setParentMesh(dt),st.mesh.updateUVs()}if(this.linkedMeshes.length=0,n.events)for(var mt in n.events){var ct=n.events[mt],kt=new Ua(mt);kt.intValue=this.getValue(ct,"int",0),kt.floatValue=this.getValue(ct,"float",0),kt.stringValue=this.getValue(ct,"string",""),kt.audioPath=this.getValue(ct,"audio",null),kt.audioPath!=null&&(kt.volume=this.getValue(ct,"volume",1),kt.balance=this.getValue(ct,"balance",0)),a.events.push(kt)}if(n.animations)for(var Rt in n.animations){var me=n.animations[Rt];this.readAnimation(me,Rt,a)}return a}},{key:"readAttachment",value:function(t,e,a,n,r){var o=this.scale;switch(n=this.getValue(t,"name",n),this.getValue(t,"type","region")){case"region":var s=this.getValue(t,"path",n),u=this.attachmentLoader.newRegionAttachment(e,n,s);if(u==null)return null;u.path=s,u.x=this.getValue(t,"x",0)*o,u.y=this.getValue(t,"y",0)*o,u.scaleX=this.getValue(t,"scaleX",1),u.scaleY=this.getValue(t,"scaleY",1),u.rotation=this.getValue(t,"rotation",0),u.width=t.width*o,u.height=t.height*o;var c=this.getValue(t,"color",null);return c!=null&&u.color.setFromString(c),u.updateOffset(),u;case"boundingbox":var l=this.attachmentLoader.newBoundingBoxAttachment(e,n);if(l==null)return null;this.readVertices(t,l,t.vertexCount<<1);var i=this.getValue(t,"color",null);return i!=null&&l.color.setFromString(i),l;case"mesh":case"linkedmesh":var d=this.getValue(t,"path",n),f=this.attachmentLoader.newMeshAttachment(e,n,d);if(f==null)return null;f.path=d;var v=this.getValue(t,"color",null);v!=null&&f.color.setFromString(v),f.width=this.getValue(t,"width",0)*o,f.height=this.getValue(t,"height",0)*o;var g=this.getValue(t,"parent",null);if(g!=null)return this.linkedMeshes.push(new En(f,this.getValue(t,"skin",null),a,g,this.getValue(t,"deform",!0))),f;var m=t.uvs;return this.readVertices(t,f,m.length),f.triangles=t.triangles,f.regionUVs=m,f.updateUVs(),f.edges=this.getValue(t,"edges",null),f.hullLength=2*this.getValue(t,"hull",0),f;case"path":var p=this.attachmentLoader.newPathAttachment(e,n);if(p==null)return null;p.closed=this.getValue(t,"closed",!1),p.constantSpeed=this.getValue(t,"constantSpeed",!0);var y=t.vertexCount;this.readVertices(t,p,y<<1);for(var w=Y.newArray(y/3,0),k=0;k<t.lengths.length;k++)w[k]=t.lengths[k]*o;p.lengths=w;var M=this.getValue(t,"color",null);return M!=null&&p.color.setFromString(M),p;case"point":var E=this.attachmentLoader.newPointAttachment(e,n);if(E==null)return null;E.x=this.getValue(t,"x",0)*o,E.y=this.getValue(t,"y",0)*o,E.rotation=this.getValue(t,"rotation",0);var A=this.getValue(t,"color",null);return A!=null&&E.color.setFromString(A),E;case"clipping":var S=this.attachmentLoader.newClippingAttachment(e,n);if(S==null)return null;var C=this.getValue(t,"end",null);if(C!=null){var R=r.findSlot(C);if(R==null)throw new Error("Clipping end slot not found: "+C);S.endSlot=R}var I=t.vertexCount;this.readVertices(t,S,I<<1);var T=this.getValue(t,"color",null);return T!=null&&S.color.setFromString(T),S}return null}},{key:"readVertices",value:function(t,e,a){var n=this.scale;e.worldVerticesLength=a;var r=t.vertices;if(a!=r.length){for(var o=new Array,s=new Array,u=0,c=r.length;u<c;){var l=r[u++];s.push(l);for(var i=u+4*l;u<i;u+=4)s.push(r[u]),o.push(r[u+1]*n),o.push(r[u+2]*n),o.push(r[u+3])}e.bones=s,e.vertices=Y.toFloatArray(o)}else{var d=Y.toFloatArray(r);if(n!=1)for(var f=0,v=r.length;f<v;f++)d[f]*=n;e.vertices=d}}},{key:"readAnimation",value:function(t,e,a){var n=this.scale,r=new Array,o=0;if(t.slots)for(var s in t.slots){var u=t.slots[s],c=a.findSlotIndex(s);if(c==-1)throw new Error("Slot not found: "+s);for(var l in u){var i=u[l];if(l=="attachment"){var d=new Le(i.length);d.slotIndex=c;for(var f=0,v=0;v<i.length;v++){var g=i[v];d.setFrame(f++,this.getValue(g,"time",0),g.name)}r.push(d),o=Math.max(o,d.frames[d.getFrameCount()-1])}else if(l=="color"){var m=new Pt(i.length);m.slotIndex=c;for(var p=0,y=0;y<i.length;y++){var w=i[y],k=new nt;k.setFromString(w.color),m.setFrame(p,this.getValue(w,"time",0),k.r,k.g,k.b,k.a),this.readCurve(w,m,p),p++}r.push(m),o=Math.max(o,m.frames[(m.getFrameCount()-1)*Pt.ENTRIES])}else{if(l!="twoColor")throw new Error("Invalid timeline type for a slot: "+l+" ("+s+")");var M=new xt(i.length);M.slotIndex=c;for(var E=0,A=0;A<i.length;A++){var S=i[A],C=new nt,R=new nt;C.setFromString(S.light),R.setFromString(S.dark),M.setFrame(E,this.getValue(S,"time",0),C.r,C.g,C.b,C.a,R.r,R.g,R.b),this.readCurve(S,M,E),E++}r.push(M),o=Math.max(o,M.frames[(M.getFrameCount()-1)*xt.ENTRIES])}}}if(t.bones)for(var I in t.bones){var T=t.bones[I],B=a.findBoneIndex(I);if(B==-1)throw new Error("Bone not found: "+I);for(var N in T){var x=T[N];if(N==="rotate"){var b=new At(x.length);b.boneIndex=B;for(var H=0,V=0;V<x.length;V++){var F=x[V];b.setFrame(H,this.getValue(F,"time",0),this.getValue(F,"angle",0)),this.readCurve(F,b,H),H++}r.push(b),o=Math.max(o,b.frames[(b.getFrameCount()-1)*At.ENTRIES])}else{if(N!=="translate"&&N!=="scale"&&N!=="shear")throw new Error("Invalid timeline type for a bone: "+N+" ("+I+")");var L=null,G=1,j=0;N==="scale"?(L=new _a(x.length),j=1):N==="shear"?L=new Va(x.length):(L=new _t(x.length),G=n),L.boneIndex=B;for(var z=0,q=0;q<x.length;q++){var O=x[q],X=this.getValue(O,"x",j),Q=this.getValue(O,"y",j);L.setFrame(z,this.getValue(O,"time",0),X*G,Q*G),this.readCurve(O,L,z),z++}r.push(L),o=Math.max(o,L.frames[(L.getFrameCount()-1)*_t.ENTRIES])}}}if(t.ik)for(var rt in t.ik){var J=t.ik[rt],tt=a.findIkConstraint(rt),W=new Mt(J.length);W.ikConstraintIndex=a.ikConstraints.indexOf(tt);for(var K=0,Z=0;Z<J.length;Z++){var it=J[Z];W.setFrame(K,this.getValue(it,"time",0),this.getValue(it,"mix",1),this.getValue(it,"softness",0)*n,this.getValue(it,"bendPositive",!0)?1:-1,this.getValue(it,"compress",!1),this.getValue(it,"stretch",!1)),this.readCurve(it,W,K),K++}r.push(W),o=Math.max(o,W.frames[(W.getFrameCount()-1)*Mt.ENTRIES])}if(t.transform)for(var et in t.transform){var ht=t.transform[et],ot=a.findTransformConstraint(et),lt=new Ft(ht.length);lt.transformConstraintIndex=a.transformConstraints.indexOf(ot);for(var ut=0,$=0;$<ht.length;$++){var ft=ht[$];lt.setFrame(ut,this.getValue(ft,"time",0),this.getValue(ft,"rotateMix",1),this.getValue(ft,"translateMix",1),this.getValue(ft,"scaleMix",1),this.getValue(ft,"shearMix",1)),this.readCurve(ft,lt,ut),ut++}r.push(lt),o=Math.max(o,lt.frames[(lt.getFrameCount()-1)*Ft.ENTRIES])}if(t.path)for(var st in t.path){var yt=t.path[st],dt=a.findPathConstraintIndex(st);if(dt==-1)throw new Error("Path constraint not found: "+st);var mt=a.pathConstraints[dt];for(var ct in yt){var kt=yt[ct];if(ct==="position"||ct==="spacing"){var Rt=null,me=1;ct==="spacing"?(Rt=new La(kt.length),mt.spacingMode!=bt.Length&&mt.spacingMode!=bt.Fixed||(me=n)):(Rt=new te(kt.length),mt.positionMode==Xt.Fixed&&(me=n)),Rt.pathConstraintIndex=dt;for(var Ae=0,Ie=0;Ie<kt.length;Ie++){var Xe=kt[Ie];Rt.setFrame(Ae,this.getValue(Xe,"time",0),this.getValue(Xe,ct,0)*me),this.readCurve(Xe,Rt,Ae),Ae++}r.push(Rt),o=Math.max(o,Rt.frames[(Rt.getFrameCount()-1)*te.ENTRIES])}else if(ct==="mix"){var Ot=new Wt(kt.length);Ot.pathConstraintIndex=dt;for(var pe=0,ee=0;ee<kt.length;ee++){var ye=kt[ee];Ot.setFrame(pe,this.getValue(ye,"time",0),this.getValue(ye,"rotateMix",1),this.getValue(ye,"translateMix",1)),this.readCurve(ye,Ot,pe),pe++}r.push(Ot),o=Math.max(o,Ot.frames[(Ot.getFrameCount()-1)*Wt.ENTRIES])}}}if(t.deform)for(var ae in t.deform){var Ht=t.deform[ae],ne=a.findSkin(ae);if(ne==null)throw new Error("Skin not found: "+ae);for(var We in Ht){var Vt=Ht[We],re=a.findSlotIndex(We);if(re==-1)throw new Error("Slot not found: "+Vt.name);for(var Re in Vt){var ie=Vt[Re],se=ne.getAttachment(re,Re);if(se==null)throw new Error("Deform attachment not found: "+ie.name);var oe=se.bones!=null,Te=se.vertices,le=oe?Te.length/3*2:Te.length,Nt=new Na(ie.length);Nt.slotIndex=re,Nt.attachment=se;for(var Gt=0,ke=0;ke<ie.length;ke++){var Pe=ie[ke],jt=void 0,Yt=this.getValue(Pe,"vertices",null);if(Yt==null)jt=oe?Y.newFloatArray(le):Te;else{jt=Y.newFloatArray(le);var Fe=this.getValue(Pe,"offset",0);if(Y.arrayCopy(Yt,0,jt,Fe,Yt.length),n!=1)for(var he=Fe,ue=he+Yt.length;he<ue;he++)jt[he]*=n;if(!oe)for(var de=0;de<le;de++)jt[de]+=Te[de]}Nt.setFrame(Gt,this.getValue(Pe,"time",0),jt),this.readCurve(Pe,Nt,Gt),Gt++}r.push(Nt),o=Math.max(o,Nt.frames[Nt.getFrameCount()-1])}}}var Zt=t.drawOrder;if(Zt==null&&(Zt=t.draworder),Zt!=null){for(var Ce=new De(Zt.length),Kt=a.slots.length,_e=0,we=0;we<Zt.length;we++){var Ve=Zt[we],xe=null,Ee=this.getValue(Ve,"offsets",null);if(Ee!=null){xe=Y.newArray(Kt,-1);for(var Lt=Y.newArray(Kt-Ee.length,0),Ne=0,Qe=0,$e=0;$e<Ee.length;$e++){var ta=Ee[$e],fa=a.findSlotIndex(ta.slot);if(fa==-1)throw new Error("Slot not found: "+ta.slot);for(;Ne!=fa;)Lt[Qe++]=Ne++;xe[Ne+ta.offset]=Ne++}for(;Ne<Kt;)Lt[Qe++]=Ne++;for(var qe=Kt-1;qe>=0;qe--)xe[qe]==-1&&(xe[qe]=Lt[--Qe])}Ce.setFrame(_e++,this.getValue(Ve,"time",0),xe)}r.push(Ce),o=Math.max(o,Ce.frames[Ce.getFrameCount()-1])}if(t.events){for(var ze=new ca(t.events.length),qa=0,ea=0;ea<t.events.length;ea++){var ce=t.events[ea],Be=a.findEvent(ce.name);if(Be==null)throw new Error("Event not found: "+ce.name);var be=new Wa(Y.toSinglePrecision(this.getValue(ce,"time",0)),Be);be.intValue=this.getValue(ce,"int",Be.intValue),be.floatValue=this.getValue(ce,"float",Be.floatValue),be.stringValue=this.getValue(ce,"string",Be.stringValue),be.data.audioPath!=null&&(be.volume=this.getValue(ce,"volume",1),be.balance=this.getValue(ce,"balance",0)),ze.setFrame(qa++,be)}r.push(ze),o=Math.max(o,ze.frames[ze.getFrameCount()-1])}if(isNaN(o))throw new Error("Error while parsing animation, duration is NaN");a.animations.push(new Et(e,r,o))}},{key:"readCurve",value:function(t,e,a){if(t.hasOwnProperty("curve"))if(t.curve=="stepped")e.setStepped(a);else{var n=t.curve;e.setCurve(a,n,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1))}}},{key:"getValue",value:function(t,e,a){return t[e]!==void 0?t[e]:a}}],[{key:"blendModeFromString",value:function(t){if((t=t.toLowerCase())=="normal")return zt.Normal;if(t=="additive")return zt.Additive;if(t=="multiply")return zt.Multiply;if(t=="screen")return zt.Screen;throw new Error("Unknown blend mode: ".concat(t))}},{key:"positionModeFromString",value:function(t){if((t=t.toLowerCase())=="fixed")return Xt.Fixed;if(t=="percent")return Xt.Percent;throw new Error("Unknown position mode: ".concat(t))}},{key:"spacingModeFromString",value:function(t){if((t=t.toLowerCase())=="length")return bt.Length;if(t=="fixed")return bt.Fixed;if(t=="percent")return bt.Percent;throw new Error("Unknown position mode: ".concat(t))}},{key:"rotateModeFromString",value:function(t){if((t=t.toLowerCase())=="tangent")return Bt.Tangent;if(t=="chain")return Bt.Chain;if(t=="chainscale")return Bt.ChainScale;throw new Error("Unknown rotate mode: ".concat(t))}},{key:"transformModeFromString",value:function(t){if((t=t.toLowerCase())=="normal")return pt.Normal;if(t=="onlytranslation")return pt.OnlyTranslation;if(t=="norotationorreflection")return pt.NoRotationOrReflection;if(t=="noscale")return pt.NoScale;if(t=="noscaleorreflection")return pt.NoScaleOrReflection;throw new Error("Unknown transform mode: ".concat(t))}}]),h}(),En=U(function h(t,e,a,n,r){D(this,h),this.parent=void 0,this.skin=void 0,this.slotIndex=void 0,this.mesh=void 0,this.inheritDeform=void 0,this.mesh=t,this.skin=e,this.slotIndex=a,this.parent=n,this.inheritDeform=r});(function(h){h[h.Region=0]="Region",h[h.BoundingBox=1]="BoundingBox",h[h.Mesh=2]="Mesh",h[h.LinkedMesh=3]="LinkedMesh",h[h.Path=4]="Path",h[h.Point=5]="Point",h[h.Clipping=6]="Clipping"})($t||($t={}));var wt=function(){function h(t){D(this,h),this.scale=1,this.attachmentLoader=void 0,this.linkedMeshes=new Array,this.attachmentLoader=t}return U(h,[{key:"readSkeletonData",value:function(t){var e=this.scale,a=new Ba;a.name="";var n=new bn(t);if(a.hash=n.readString(),a.version=n.readString(),a.version=="3.8.75")throw new Error("Unsupported skeleton data, please export with a newer version of Spine.");a.x=n.readFloat(),a.y=n.readFloat(),a.width=n.readFloat(),a.height=n.readFloat();var r=n.readBoolean();r&&(a.fps=n.readFloat(),a.imagesPath=n.readString(),a.audioPath=n.readString());var o=0;o=n.readInt(!0);for(var s=0;s<o;s++)n.strings.push(n.readString());o=n.readInt(!0);for(var u=0;u<o;u++){var c=n.readString(),l=u==0?null:a.bones[n.readInt(!0)],i=new Ta(u,c,l);i.rotation=n.readFloat(),i.x=n.readFloat()*e,i.y=n.readFloat()*e,i.scaleX=n.readFloat(),i.scaleY=n.readFloat(),i.shearX=n.readFloat(),i.shearY=n.readFloat(),i.length=n.readFloat()*e,i.transformMode=h.TransformModeValues[n.readInt(!0)],i.skinRequired=n.readBoolean(),r&&nt.rgba8888ToColor(i.color,n.readInt32()),a.bones.push(i)}o=n.readInt(!0);for(var d=0;d<o;d++){var f=n.readString(),v=a.bones[n.readInt(!0)],g=new Oa(d,f,v);nt.rgba8888ToColor(g.color,n.readInt32());var m=n.readInt32();m!=-1&&nt.rgb888ToColor(g.darkColor=new nt,m),g.attachmentName=n.readStringRef(),g.blendMode=h.BlendModeValues[n.readInt(!0)],a.slots.push(g)}o=n.readInt(!0);for(var p,y=0;y<o;y++){var w=new Ya(n.readString());w.order=n.readInt(!0),w.skinRequired=n.readBoolean(),p=n.readInt(!0);for(var k=0;k<p;k++)w.bones.push(a.bones[n.readInt(!0)]);w.target=a.bones[n.readInt(!0)],w.mix=n.readFloat(),w.softness=n.readFloat()*e,w.bendDirection=n.readByte(),w.compress=n.readBoolean(),w.stretch=n.readBoolean(),w.uniform=n.readBoolean(),a.ikConstraints.push(w)}o=n.readInt(!0);for(var M,E=0;E<o;E++){var A=new Da(n.readString());A.order=n.readInt(!0),A.skinRequired=n.readBoolean(),M=n.readInt(!0);for(var S=0;S<M;S++)A.bones.push(a.bones[n.readInt(!0)]);A.target=a.bones[n.readInt(!0)],A.local=n.readBoolean(),A.relative=n.readBoolean(),A.offsetRotation=n.readFloat(),A.offsetX=n.readFloat()*e,A.offsetY=n.readFloat()*e,A.offsetScaleX=n.readFloat(),A.offsetScaleY=n.readFloat(),A.offsetShearY=n.readFloat(),A.rotateMix=n.readFloat(),A.translateMix=n.readFloat(),A.scaleMix=n.readFloat(),A.shearMix=n.readFloat(),a.transformConstraints.push(A)}o=n.readInt(!0);for(var C,R=0;R<o;R++){var I=new Pa(n.readString());I.order=n.readInt(!0),I.skinRequired=n.readBoolean(),C=n.readInt(!0);for(var T=0;T<C;T++)I.bones.push(a.bones[n.readInt(!0)]);I.target=a.slots[n.readInt(!0)],I.positionMode=h.PositionModeValues[n.readInt(!0)],I.spacingMode=h.SpacingModeValues[n.readInt(!0)],I.rotateMode=h.RotateModeValues[n.readInt(!0)],I.offsetRotation=n.readFloat(),I.position=n.readFloat(),I.positionMode==Xt.Fixed&&(I.position*=e),I.spacing=n.readFloat(),I.spacingMode!=bt.Length&&I.spacingMode!=bt.Fixed||(I.spacing*=e),I.rotateMix=n.readFloat(),I.translateMix=n.readFloat(),a.pathConstraints.push(I)}var B=this.readSkin(n,a,!0,r);B!=null&&(a.defaultSkin=B,a.skins.push(B));var N=a.skins.length;for(Y.setArraySize(a.skins,o=N+n.readInt(!0));N<o;N++)a.skins[N]=this.readSkin(n,a,!1,r);o=this.linkedMeshes.length;for(var x=0;x<o;x++){var b=this.linkedMeshes[x],H=b.skin==null?a.defaultSkin:a.findSkin(b.skin);if(H==null)throw new Error("Skin not found: "+b.skin);var V=H.getAttachment(b.slotIndex,b.parent);if(V==null)throw new Error("Parent mesh not found: "+b.parent);b.mesh.deformAttachment=b.inheritDeform?V:b.mesh,b.mesh.setParentMesh(V),b.mesh.updateUVs()}this.linkedMeshes.length=0,o=n.readInt(!0);for(var F=0;F<o;F++){var L=new Ua(n.readStringRef());L.intValue=n.readInt(!1),L.floatValue=n.readFloat(),L.stringValue=n.readString(),L.audioPath=n.readString(),L.audioPath!=null&&(L.volume=n.readFloat(),L.balance=n.readFloat()),a.events.push(L)}o=n.readInt(!0);for(var G=0;G<o;G++)a.animations.push(this.readAnimation(n,n.readString(),a));return a}},{key:"readSkin",value:function(t,e,a,n){var r=null,o=0;if(a){if((o=t.readInt(!0))==0)return null;r=new ua("default")}else{(r=new ua(t.readStringRef())).bones.length=t.readInt(!0);for(var s=0,u=r.bones.length;s<u;s++)r.bones[s]=e.bones[t.readInt(!0)];for(var c=0,l=t.readInt(!0);c<l;c++)r.constraints.push(e.ikConstraints[t.readInt(!0)]);for(var i=0,d=t.readInt(!0);i<d;i++)r.constraints.push(e.transformConstraints[t.readInt(!0)]);for(var f=0,v=t.readInt(!0);f<v;f++)r.constraints.push(e.pathConstraints[t.readInt(!0)]);o=t.readInt(!0)}for(var g=0;g<o;g++)for(var m=t.readInt(!0),p=0,y=t.readInt(!0);p<y;p++){var w=t.readStringRef(),k=this.readAttachment(t,e,r,m,w,n);k!=null&&r.setAttachment(m,w,k)}return r}},{key:"readAttachment",value:function(t,e,a,n,r,o){var s=this.scale,u=t.readStringRef();u==null&&(u=r);var c=t.readByte();switch(h.AttachmentTypeValues[c]){case $t.Region:var l=t.readStringRef(),i=t.readFloat(),d=t.readFloat(),f=t.readFloat(),v=t.readFloat(),g=t.readFloat(),m=t.readFloat(),p=t.readFloat(),y=t.readInt32();l==null&&(l=u);var w=this.attachmentLoader.newRegionAttachment(a,u,l);return w==null?null:(w.path=l,w.x=d*s,w.y=f*s,w.scaleX=v,w.scaleY=g,w.rotation=i,w.width=m*s,w.height=p*s,nt.rgba8888ToColor(w.color,y),w.updateOffset(),w);case $t.BoundingBox:var k=t.readInt(!0),M=this.readVertices(t,k),E=o?t.readInt32():0,A=this.attachmentLoader.newBoundingBoxAttachment(a,u);return A==null?null:(A.worldVerticesLength=k<<1,A.vertices=M.vertices,A.bones=M.bones,o&&nt.rgba8888ToColor(A.color,E),A);case $t.Mesh:var S=t.readStringRef(),C=t.readInt32(),R=t.readInt(!0),I=this.readFloatArray(t,R<<1,1),T=this.readShortArray(t),B=this.readVertices(t,R),N=t.readInt(!0),x=null,b=0,H=0;o&&(x=this.readShortArray(t),b=t.readFloat(),H=t.readFloat()),S==null&&(S=u);var V=this.attachmentLoader.newMeshAttachment(a,u,S);return V==null?null:(V.path=S,nt.rgba8888ToColor(V.color,C),V.bones=B.bones,V.vertices=B.vertices,V.worldVerticesLength=R<<1,V.triangles=T,V.regionUVs=I,V.updateUVs(),V.hullLength=N<<1,o&&(V.edges=x,V.width=b*s,V.height=H*s),V);case $t.LinkedMesh:var F=t.readStringRef(),L=t.readInt32(),G=t.readStringRef(),j=t.readStringRef(),z=t.readBoolean(),q=0,O=0;o&&(q=t.readFloat(),O=t.readFloat()),F==null&&(F=u);var X=this.attachmentLoader.newMeshAttachment(a,u,F);return X==null?null:(X.path=F,nt.rgba8888ToColor(X.color,L),o&&(X.width=q*s,X.height=O*s),this.linkedMeshes.push(new Sn(X,G,n,j,z)),X);case $t.Path:for(var Q=t.readBoolean(),rt=t.readBoolean(),J=t.readInt(!0),tt=this.readVertices(t,J),W=Y.newArray(J/3,0),K=0,Z=W.length;K<Z;K++)W[K]=t.readFloat()*s;var it=o?t.readInt32():0,et=this.attachmentLoader.newPathAttachment(a,u);return et==null?null:(et.closed=Q,et.constantSpeed=rt,et.worldVerticesLength=J<<1,et.vertices=tt.vertices,et.bones=tt.bones,et.lengths=W,o&&nt.rgba8888ToColor(et.color,it),et);case $t.Point:var ht=t.readFloat(),ot=t.readFloat(),lt=t.readFloat(),ut=o?t.readInt32():0,$=this.attachmentLoader.newPointAttachment(a,u);return $==null?null:($.x=ot*s,$.y=lt*s,$.rotation=ht,o&&nt.rgba8888ToColor($.color,ut),$);case $t.Clipping:var ft=t.readInt(!0),st=t.readInt(!0),yt=this.readVertices(t,st),dt=o?t.readInt32():0,mt=this.attachmentLoader.newClippingAttachment(a,u);return mt==null?null:(mt.endSlot=e.slots[ft],mt.worldVerticesLength=st<<1,mt.vertices=yt.vertices,mt.bones=yt.bones,o&&nt.rgba8888ToColor(mt.color,dt),mt)}return null}},{key:"readVertices",value:function(t,e){var a=e<<1,n=new Mn,r=this.scale;if(!t.readBoolean())return n.vertices=this.readFloatArray(t,a,r),n;for(var o=new Array,s=new Array,u=0;u<e;u++){var c=t.readInt(!0);s.push(c);for(var l=0;l<c;l++)s.push(t.readInt(!0)),o.push(t.readFloat()*r),o.push(t.readFloat()*r),o.push(t.readFloat())}return n.vertices=Y.toFloatArray(o),n.bones=s,n}},{key:"readFloatArray",value:function(t,e,a){var n=new Array(e);if(a==1)for(var r=0;r<e;r++)n[r]=t.readFloat();else for(var o=0;o<e;o++)n[o]=t.readFloat()*a;return n}},{key:"readShortArray",value:function(t){for(var e=t.readInt(!0),a=new Array(e),n=0;n<e;n++)a[n]=t.readShort();return a}},{key:"readAnimation",value:function(t,e,a){for(var n=new Array,r=this.scale,o=0,s=new nt,u=new nt,c=0,l=t.readInt(!0);c<l;c++)for(var i=t.readInt(!0),d=0,f=t.readInt(!0);d<f;d++){var v=t.readByte(),g=t.readInt(!0);switch(v){case h.SLOT_ATTACHMENT:var m=new Le(g);m.slotIndex=i;for(var p=0;p<g;p++)m.setFrame(p,t.readFloat(),t.readStringRef());n.push(m),o=Math.max(o,m.frames[g-1]);break;case h.SLOT_COLOR:var y=new Pt(g);y.slotIndex=i;for(var w=0;w<g;w++){var k=t.readFloat();nt.rgba8888ToColor(s,t.readInt32()),y.setFrame(w,k,s.r,s.g,s.b,s.a),w<g-1&&this.readCurve(t,w,y)}n.push(y),o=Math.max(o,y.frames[(g-1)*Pt.ENTRIES]);break;case h.SLOT_TWO_COLOR:var M=new xt(g);M.slotIndex=i;for(var E=0;E<g;E++){var A=t.readFloat();nt.rgba8888ToColor(s,t.readInt32()),nt.rgb888ToColor(u,t.readInt32()),M.setFrame(E,A,s.r,s.g,s.b,s.a,u.r,u.g,u.b),E<g-1&&this.readCurve(t,E,M)}n.push(M),o=Math.max(o,M.frames[(g-1)*xt.ENTRIES])}}for(var S=0,C=t.readInt(!0);S<C;S++)for(var R=t.readInt(!0),I=0,T=t.readInt(!0);I<T;I++){var B=t.readByte(),N=t.readInt(!0);switch(B){case h.BONE_ROTATE:var x=new At(N);x.boneIndex=R;for(var b=0;b<N;b++)x.setFrame(b,t.readFloat(),t.readFloat()),b<N-1&&this.readCurve(t,b,x);n.push(x),o=Math.max(o,x.frames[(N-1)*At.ENTRIES]);break;case h.BONE_TRANSLATE:case h.BONE_SCALE:case h.BONE_SHEAR:var H=void 0,V=1;B==h.BONE_SCALE?H=new _a(N):B==h.BONE_SHEAR?H=new Va(N):(H=new _t(N),V=r),H.boneIndex=R;for(var F=0;F<N;F++)H.setFrame(F,t.readFloat(),t.readFloat()*V,t.readFloat()*V),F<N-1&&this.readCurve(t,F,H);n.push(H),o=Math.max(o,H.frames[(N-1)*_t.ENTRIES])}}for(var L=0,G=t.readInt(!0);L<G;L++){var j=t.readInt(!0),z=t.readInt(!0),q=new Mt(z);q.ikConstraintIndex=j;for(var O=0;O<z;O++)q.setFrame(O,t.readFloat(),t.readFloat(),t.readFloat()*r,t.readByte(),t.readBoolean(),t.readBoolean()),O<z-1&&this.readCurve(t,O,q);n.push(q),o=Math.max(o,q.frames[(z-1)*Mt.ENTRIES])}for(var X=0,Q=t.readInt(!0);X<Q;X++){var rt=t.readInt(!0),J=t.readInt(!0),tt=new Ft(J);tt.transformConstraintIndex=rt;for(var W=0;W<J;W++)tt.setFrame(W,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()),W<J-1&&this.readCurve(t,W,tt);n.push(tt),o=Math.max(o,tt.frames[(J-1)*Ft.ENTRIES])}for(var K=0,Z=t.readInt(!0);K<Z;K++)for(var it=t.readInt(!0),et=a.pathConstraints[it],ht=0,ot=t.readInt(!0);ht<ot;ht++){var lt=t.readByte(),ut=t.readInt(!0);switch(lt){case h.PATH_POSITION:case h.PATH_SPACING:var $=void 0,ft=1;lt==h.PATH_SPACING?($=new La(ut),et.spacingMode!=bt.Length&&et.spacingMode!=bt.Fixed||(ft=r)):($=new te(ut),et.positionMode==Xt.Fixed&&(ft=r)),$.pathConstraintIndex=it;for(var st=0;st<ut;st++)$.setFrame(st,t.readFloat(),t.readFloat()*ft),st<ut-1&&this.readCurve(t,st,$);n.push($),o=Math.max(o,$.frames[(ut-1)*te.ENTRIES]);break;case h.PATH_MIX:var yt=new Wt(ut);yt.pathConstraintIndex=it;for(var dt=0;dt<ut;dt++)yt.setFrame(dt,t.readFloat(),t.readFloat(),t.readFloat()),dt<ut-1&&this.readCurve(t,dt,yt);n.push(yt),o=Math.max(o,yt.frames[(ut-1)*Wt.ENTRIES])}}for(var mt=0,ct=t.readInt(!0);mt<ct;mt++)for(var kt=a.skins[t.readInt(!0)],Rt=0,me=t.readInt(!0);Rt<me;Rt++)for(var Ae=t.readInt(!0),Ie=0,Xe=t.readInt(!0);Ie<Xe;Ie++){var Ot=kt.getAttachment(Ae,t.readStringRef()),pe=Ot.bones!=null,ee=Ot.vertices,ye=pe?ee.length/3*2:ee.length,ae=t.readInt(!0),Ht=new Na(ae);Ht.slotIndex=Ae,Ht.attachment=Ot;for(var ne=0;ne<ae;ne++){var We=t.readFloat(),Vt=void 0,re=t.readInt(!0);if(re==0)Vt=pe?Y.newFloatArray(ye):ee;else{Vt=Y.newFloatArray(ye);var Re=t.readInt(!0);if(re+=Re,r==1)for(var ie=Re;ie<re;ie++)Vt[ie]=t.readFloat();else for(var se=Re;se<re;se++)Vt[se]=t.readFloat()*r;if(!pe)for(var oe=0,Te=Vt.length;oe<Te;oe++)Vt[oe]+=ee[oe]}Ht.setFrame(ne,We,Vt),ne<ae-1&&this.readCurve(t,ne,Ht)}n.push(Ht),o=Math.max(o,Ht.frames[ae-1])}var le=t.readInt(!0);if(le>0){for(var Nt=new De(le),Gt=a.slots.length,ke=0;ke<le;ke++){for(var Pe=t.readFloat(),jt=t.readInt(!0),Yt=Y.newArray(Gt,0),Fe=Gt-1;Fe>=0;Fe--)Yt[Fe]=-1;for(var he=Y.newArray(Gt-jt,0),ue=0,de=0,Zt=0;Zt<jt;Zt++){for(var Ce=t.readInt(!0);ue!=Ce;)he[de++]=ue++;Yt[ue+t.readInt(!0)]=ue++}for(;ue<Gt;)he[de++]=ue++;for(var Kt=Gt-1;Kt>=0;Kt--)Yt[Kt]==-1&&(Yt[Kt]=he[--de]);Nt.setFrame(ke,Pe,Yt)}n.push(Nt),o=Math.max(o,Nt.frames[le-1])}var _e=t.readInt(!0);if(_e>0){for(var we=new ca(_e),Ve=0;Ve<_e;Ve++){var xe=t.readFloat(),Ee=a.events[t.readInt(!0)],Lt=new Wa(xe,Ee);Lt.intValue=t.readInt(!1),Lt.floatValue=t.readFloat(),Lt.stringValue=t.readBoolean()?t.readString():Ee.stringValue,Lt.data.audioPath!=null&&(Lt.volume=t.readFloat(),Lt.balance=t.readFloat()),we.setFrame(Ve,Lt)}n.push(we),o=Math.max(o,we.frames[_e-1])}return new Et(e,n,o)}},{key:"readCurve",value:function(t,e,a){switch(t.readByte()){case h.CURVE_STEPPED:a.setStepped(e);break;case h.CURVE_BEZIER:this.setCurve(a,e,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat())}}},{key:"setCurve",value:function(t,e,a,n,r,o){t.setCurve(e,a,n,r,o)}}]),h}();wt.AttachmentTypeValues=[0,1,2,3,4,5,6],wt.TransformModeValues=[pt.Normal,pt.OnlyTranslation,pt.NoRotationOrReflection,pt.NoScale,pt.NoScaleOrReflection],wt.PositionModeValues=[Xt.Fixed,Xt.Percent],wt.SpacingModeValues=[bt.Length,bt.Fixed,bt.Percent],wt.RotateModeValues=[Bt.Tangent,Bt.Chain,Bt.ChainScale],wt.BlendModeValues=[zt.Normal,zt.Additive,zt.Multiply,zt.Screen],wt.BONE_ROTATE=0,wt.BONE_TRANSLATE=1,wt.BONE_SCALE=2,wt.BONE_SHEAR=3,wt.SLOT_ATTACHMENT=0,wt.SLOT_COLOR=1,wt.SLOT_TWO_COLOR=2,wt.PATH_POSITION=0,wt.PATH_SPACING=1,wt.PATH_MIX=2,wt.CURVE_LINEAR=0,wt.CURVE_STEPPED=1,wt.CURVE_BEZIER=2;var bn=function(){function h(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new DataView(t.buffer);D(this,h),this.strings=e,this.index=a,this.buffer=n}return U(h,[{key:"readByte",value:function(){return this.buffer.getInt8(this.index++)}},{key:"readShort",value:function(){var t=this.buffer.getInt16(this.index);return this.index+=2,t}},{key:"readInt32",value:function(){var t=this.buffer.getInt32(this.index);return this.index+=4,t}},{key:"readInt",value:function(t){var e=this.readByte(),a=127&e;return(128&e)!=0&&(a|=(127&(e=this.readByte()))<<7,(128&e)!=0&&(a|=(127&(e=this.readByte()))<<14,(128&e)!=0&&(a|=(127&(e=this.readByte()))<<21,(128&e)!=0&&(a|=(127&(e=this.readByte()))<<28)))),t?a:a>>>1^-(1&a)}},{key:"readStringRef",value:function(){var t=this.readInt(!0);return t==0?null:this.strings[t-1]}},{key:"readString",value:function(){var t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;for(var e="",a=0;a<t;){var n=this.readByte();switch(n>>4){case 12:case 13:e+=String.fromCharCode((31&n)<<6|63&this.readByte()),a+=2;break;case 14:e+=String.fromCharCode((15&n)<<12|(63&this.readByte())<<6|63&this.readByte()),a+=3;break;default:e+=String.fromCharCode(n),a++}}return e}},{key:"readFloat",value:function(){var t=this.buffer.getFloat32(this.index);return this.index+=4,t}},{key:"readBoolean",value:function(){return this.readByte()!=0}}]),h}(),Sn=U(function h(t,e,a,n,r){D(this,h),this.parent=void 0,this.skin=void 0,this.slotIndex=void 0,this.mesh=void 0,this.inheritDeform=void 0,this.mesh=t,this.skin=e,this.slotIndex=a,this.parent=n,this.inheritDeform=r}),Mn=U(function h(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;D(this,h),this.bones=t,this.vertices=e});za("spine",["json","bin"])(function(h){vt(e,ja);var t=gt(e);function e(){return D(this,e),t.apply(this,arguments)}return U(e,[{key:"load",value:function(a,n){var r=this;return new Za(function(o,s){var u,c=n.engine;a.type!=="spine"&&s("Asset type must be spine."),!a.urls&&a.url&&r.checkUrl(a.url)&&(u=r.getResouceFromUrl(a.url)),a.urls&&r.checkUrls(a.urls)&&(u=r.getResouceFromUrls(a.urls));var l,i=!1;l=new pn(null,function(p){return r.createAdaptiveTexture(p,c)});var d=u,f=d.skeletonFile,v=d.atlasFile,g=d.textureFile;l.onLoadComplete=function(){var p;if(i)p=l.get(v);else{var y=l.get(v);p=new ha(y,r.textureAssetPicker.bind(r,l,g))}var w=new wn(p),k=(r.isBinFile(f)?new wt(w):new xn(w)).readSkeletonData(l.get(f)),M=new Ka(c),E=M.addComponent(Ye);E.shaderData.enableMacro("USE_MODEL_MATRIX"),E.shaderData.enableMacro("USE_CUSTOM_TEXTURE");var A=c._spriteDefaultMaterial.clone();E.setMaterial(A),M.addComponent(mn).setSkeletonData(k),o(M)};var m=r.isBinFile(f);f&&v&&g?(m?l.loadBinary(f):l.loadText(f),l.loadText(v),l.loadTexture(g)):f&&v&&!g?(i=!0,m?l.loadBinary(f):l.loadText(f),l.loadTextureAtlas(v)):s("Resouce param error")})}},{key:"textureAssetPicker",value:function(a,n){return a.get(n)}},{key:"createAdaptiveTexture",value:function(a,n){return new An(a,n)}},{key:"isBinFile",value:function(a){return this.getExtFromUrl(a)==="bin"}},{key:"checkUrl",value:function(a){var n=this.getExtFromUrl(a);return n==="json"||n==="bin"||(console.error("When use url as params, url must be json or bin file"),!1)}},{key:"getResouceFromUrl",value:function(a){var n=a,r=a,o=r.indexOf("?");return o>0&&(r=r.substr(0,o)),{skeletonFile:n,atlasFile:r=r.substr(0,r.lastIndexOf("."))+".atlas"}}},{key:"checkUrls",value:function(a){if(a.length<2)return console.error("When use urls as params, urls should at least contain: json/bin and atlas"),!1;if(a.length>3)return console.error("Spine runtime dont support multiple texture now"),!1;var n=this.getResouceFromUrls(a),r=n.skeletonFile,o=n.atlasFile;return n.textureFile,!(!r||!o)||(console.error("Lack ".concat(r?"":"skeletonFile").concat(o?" atlasFile":"")),!1)}},{key:"getResouceFromUrls",value:function(a){for(var n,r,o,s=0;s<a.length;s+=1){var u=a[s],c=this.getExtFromUrl(u);c!=="json"&&c!=="bin"||(n=u),c==="atlas"&&(r=u),["png","jpg","webp","jpeg"].includes(c)&&(o=u)}return{skeletonFile:n,atlasFile:r,textureFile:o}}},{key:"getExtFromUrl",value:function(a){return a.split(/[#?]/)[0].split(".").pop().trim()}}]),e}());var An=function(h){vt(e,Je);var t=gt(e);function e(a,n){var r;return D(this,e),(r=t.call(this,a)).texture=void 0,r.texture=new Ja(n,a.width,a.height),r.texture.setImageSource(a),r.texture.generateMipmaps(),r}return U(e,[{key:"setFilters",value:function(a,n){a===WebGLRenderingContext.NEAREST?this.texture.filterMode=ia.Point:n===WebGLRenderingContext.LINEAR_MIPMAP_LINEAR?this.texture.filterMode=ia.Trilinear:this.texture.filterMode=ia.Bilinear}},{key:"setWraps",value:function(a,n){this.texture.wrapModeU=a,this.texture.wrapModeV=n}},{key:"dispose",value:function(){}}]),e}();export{mn as K};
